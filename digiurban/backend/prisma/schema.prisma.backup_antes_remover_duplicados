generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ============================================
// CONFIGURAÇÃO DO MUNICÍPIO (SINGLETON)
// ============================================
model MunicipioConfig {
  id               String    @id @default("singleton")
  nome             String
  cnpj             String    @unique
  codigoIbge       String?
  nomeMunicipio    String
  ufMunicipio      String
  brasao           String?
  corPrimaria      String?
  configuracoes    Json?
  isActive         Boolean   @default(true)
  isSuspended      Boolean   @default(false)
  suspensionReason String?
  paymentStatus    String    @default("active") // active, pending, overdue, suspended
  subscriptionPlan String    @default("basic") // basic, professional, enterprise
  subscriptionEnds DateTime?
  maxUsers         Int       @default(10)
  maxCitizens      Int       @default(10000)
  features         Json? // Features habilitadas
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  @@map("municipio_config")
}

model User {
  id                            String                       @id @default(cuid())
  email                         String                       @unique
  name                          String
  password                      String
  role                          UserRole                     @default(USER)
  isActive                      Boolean                      @default(true)
  departmentId                  String?
  failedLoginAttempts           Int                          @default(0)
  lockedUntil                   DateTime?
  mustChangePassword            Boolean                      @default(false)
  createdAt                     DateTime                     @default(now())
  updatedAt                     DateTime                     @updatedAt
  lastLogin                     DateTime?
  agendaEvents                  AgendaEvent[]                @relation("AgendaEventCreator")
  auditLogs                     AuditLog[]
  reviewedTransferRequests      CitizenTransferRequest[]
  homeVisitsAsSocialWorker      HomeVisit[]                  @relation("HomeVisitSocialWorker")
  createdProtocolsSimplified    ProtocolSimplified[]         @relation("CreatedByUserSimplified")
  assignedProtocolsSimplified   ProtocolSimplified[]         @relation("AssignedUserSimplified")
  socialAssistanceAsWorker      SocialAssistanceAttendance[] @relation("SocialAssistanceWorker")
  socialAppointmentsAsWorker    SocialAppointment[]          @relation("SocialAppointmentWorker")
  socialEquipmentsAsCoordinator SocialEquipment[]            @relation("SocialEquipmentCoordinator")
  department                    Department?                  @relation(fields: [departmentId], references: [id])

  @@map("users")
}

model Department {
  id                  String               @id @default(cuid())
  name                String               @unique // ✅ GLOBAL: nome único
  code                String?              @unique // ✅ GLOBAL: código único
  description         String?
  isActive            Boolean              @default(true)
  // ✅ REMOVIDO: tenantId (departamentos são globais)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  protocolsSimplified ProtocolSimplified[]
  servicesSimplified  ServiceSimplified[]
  users               User[]

  @@map("departments")
}

model Citizen {
  id                          String                       @id @default(cuid())
  cpf                         String
  name                        String
  email                       String
  phone                       String?
  birthDate                   DateTime?
  address                     Json?
  municipioId                 String?
  isActive                    Boolean                      @default(true)
  password                    String
  failedLoginAttempts         Int                          @default(0)
  lockedUntil                 DateTime?
  verificationStatus          VerificationStatus           @default(PENDING)
  verifiedAt                  DateTime?
  verifiedBy                  String?
  verificationNotes           String?
  registrationSource          String                       @default("SELF")
  createdAt                   DateTime                     @default(now())
  updatedAt                   DateTime                     @updatedAt
  lastLogin                   DateTime?
  auditLogs                   AuditLog[]
  transferRequests            CitizenTransferRequest[]
  emergencyDeliveries         EmergencyDelivery[]          @relation("EmergencyDeliveryCitizen")
  environmentalAttendances    EnvironmentalAttendance[]    @relation("EnvironmentalAttendanceCitizen")
  familyAsMember              FamilyComposition[]          @relation("FamilyMember")
  familyAsHead                FamilyComposition[]          @relation("FamilyHead")
  housingAttendances          HousingAttendance[]          @relation("HousingAttendanceCitizen")
  medicationDispensings       MedicationDispensing[]
  notifications               Notification[]
  protocolsSimplified         ProtocolSimplified[]
  publicProblemReports        PublicProblemReport[]        @relation("PublicProblemReportCitizen")
  specialCollections          SpecialCollection[]          @relation("SpecialCollectionCitizen")
  tourismAttendances          TourismAttendance[]          @relation("TourismAttendanceCitizen")
  urbanPlanningAttendances    UrbanPlanningAttendance[]    @relation("UrbanPlanningAttendanceCitizen")
  vaccinations                Vaccination[]
  vulnerableFamilyData        VulnerableFamily?
  socialGroupEnrollments      SocialGroupEnrollment[]      @relation("SocialGroupCitizen")
  weedingRequests             WeedingRequest[]             @relation("WeedingRequestCitizen")
  drainageRequests            DrainageRequest[]            @relation("DrainageRequestCitizen")
  treePruningRequests         TreePruningRequest[]         @relation("TreePruningRequestCitizen")
  publicServiceAttendances    PublicServiceAttendance[]    @relation("PublicServiceAttendanceCitizen")
  ruralProducers              RuralProducer[]              @relation("RuralProducerCitizen")
  ruralProperties             RuralProperty[]              @relation("RuralPropertyCitizen")
  ruralProgramEnrollments     RuralProgramEnrollment[]     @relation("RuralProgramEnrollmentCitizen")
  ruralTrainingEnrollments    RuralTrainingEnrollment[]    @relation("RuralTrainingEnrollmentCitizen")
  culturalWorkshopEnrollments CulturalWorkshopEnrollment[] @relation("CulturalWorkshopEnrollmentCitizen")
  technicalAssistances        TechnicalAssistance[]        @relation("TechnicalAssistanceCitizen")
  agricultureAttendances      AgricultureAttendance[]      @relation("AgricultureAttendanceCitizen")

  // Fase 2 - Educação
  educationAttendances        EducationAttendance[]        @relation("EducationAttendanceCitizen")
  schoolDocuments             SchoolDocument[]             @relation("SchoolDocumentCitizen")
  attendanceRecords           AttendanceRecord[]           @relation("AttendanceRecordCitizen")
  gradeRecords                GradeRecord[]                @relation("GradeRecordCitizen")
  disciplinaryRecords         DisciplinaryRecord[]         @relation("DisciplinaryRecordCitizen")
  schoolManagement            SchoolManagement[]           @relation("SchoolManagementCitizen")

  // Fase 2 - Saúde
  healthAttendances           HealthAttendance[]           @relation("HealthAttendanceCitizen")
  medicalAppointments         MedicalAppointment[]         @relation("MedicalAppointmentCitizen")
  vaccinationRecords          VaccinationRecord[]          @relation("VaccinationRecordCitizen")
  medicationDispenses         MedicationDispense[]         @relation("MedicationDispenseCitizen")
  medicalExams                MedicalExam[]                @relation("MedicalExamCitizen")
  campaignEnrollments         CampaignEnrollment[]         @relation("CampaignEnrollmentCitizen")
  homeCares                   HomeCare[]                   @relation("HomeCareCitizen")
  patientRecords              Patient[]                    @relation("PatientCitizen")
  studentEnrollmentRequests   StudentEnrollmentRequest[]   @relation("StudentEnrollmentCitizen")
  schoolTransportRequests     SchoolTransportRequest[]     @relation("SchoolTransportRequestCitizen")
  schoolMealRequests          SchoolMealRequest[]          @relation("SchoolMealRequestCitizen")
  schoolTransferRequests      SchoolTransferRequest[]      @relation("SchoolTransferRequestCitizen")
  schoolMaterialRequests      SchoolMaterialRequest[]      @relation("SchoolMaterialRequestCitizen")
  healthTransports            HealthTransport[]            @relation("HealthTransportCitizen")
  healthTransportRequests     HealthTransportRequest[]     @relation("HealthTransportRequestCitizen")
  acsRecords                  CommunityHealthAgent[]       @relation("ACSCitizen")

  // Fase 2 - Assistência Social (atualizado)
  socialAttendances           SocialAssistanceAttendance[] @relation("SocialAttendanceCitizen")
  socialAppointments          SocialAppointment[]          @relation("SocialAppointmentCitizen")
  socialEquipments            SocialEquipment[]            @relation("SocialEquipmentCitizen")
  socialProgramEnrollments    SocialProgramEnrollment[]    @relation("SocialProgramCitizen")
  socialBenefitRequests       SocialBenefitRequest[]       @relation("SocialBenefitRequestCitizen")
  documentRequests            DocumentRequest[]            @relation("DocumentRequestCitizen")
  familyRegistrations         FamilyRegistration[]         @relation("FamilyRegistrationCitizen")
  socialHomeVisits            SocialHomeVisit[]            @relation("SocialHomeVisitCitizen")

  @@unique([cpf])
  @@map("citizens")
}

model Invoice {
  id          String        @id @default(cuid())
  number      String        @unique
  amount      Float
  plan        Plan
  period      String
  status      InvoiceStatus @default(PENDING)
  dueDate     DateTime
  paidAt      DateTime?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  description String?
  paymentUrl  String?
  metadata    Json?

  @@map("invoices")
}

model Lead {
  id        String     @id @default(cuid())
  name      String
  email     String
  phone     String?
  company   String?
  position  String?
  source    LeadSource
  status    String     @default("NEW")
  message   String?
  metadata  Json?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  @@map("leads")
}

model FamilyComposition {
  id           String   @id @default(cuid())
  headId       String
  memberId     String
  relationship String
  isDependent  Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  member       Citizen  @relation("FamilyMember", fields: [memberId], references: [id], onDelete: Cascade)
  head         Citizen  @relation("FamilyHead", fields: [headId], references: [id], onDelete: Cascade)

  @@unique([headId, memberId])
  @@map("family_compositions")
}

// ========================================
// SISTEMA SIMPLIFICADO DE PROTOCOLOS
// ========================================

model ServiceSimplified {
  id           String  @id @default(cuid())
  name         String
  description  String?
  departmentId String

  // SIMPLIFICAÇÃO: 1 enum ao invés de 8 flags
  serviceType ServiceType

  // Para serviços COM_DADOS
  moduleType String? // "ATENDIMENTOS_SAUDE", "MATRICULA_ALUNO", etc
  formSchema Json? // Schema do formulário

  // Campos básicos
  isActive          Boolean @default(true)
  requiresDocuments Boolean @default(false)
  requiredDocuments Json?
  estimatedDays     Int?
  priority          Int     @default(1)
  category          String?
  icon              String?
  color             String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  department Department           @relation(fields: [departmentId], references: [id])
  protocols  ProtocolSimplified[]

  @@map("services_simplified")
}

model ProtocolSimplified {
  id          String         @id @default(cuid())
  number      String         @unique
  title       String
  description String?
  status      ProtocolStatus @default(VINCULADO)
  priority    Int            @default(3)

  // Relacionamentos principais
  citizenId    String
  serviceId    String
  departmentId String

  // Dados capturados (se COM_DADOS)
  customData Json?
  moduleType String? // Para roteamento

  // Geolocalização
  latitude  Float?
  longitude Float?
  address   String?

  // Documentos
  documents   Json?
  attachments String?

  // Gestão
  assignedUserId String?
  createdById    String?

  // Timestamps
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  dueDate     DateTime?
  concludedAt DateTime?

  // Relacionamentos
  citizen      Citizen           @relation(fields: [citizenId], references: [id])
  service      ServiceSimplified @relation(fields: [serviceId], references: [id])
  department   Department        @relation(fields: [departmentId], references: [id])
  assignedUser User?             @relation("AssignedUserSimplified", fields: [assignedUserId], references: [id])
  createdBy    User?             @relation("CreatedByUserSimplified", fields: [createdById], references: [id])

  history       ProtocolHistorySimplified[]
  evaluations   ProtocolEvaluationSimplified[]
  interactions  ProtocolInteraction[]
  documentFiles ProtocolDocument[]
  pendings      ProtocolPending[]
  stages        ProtocolStage[]
  sla           ProtocolSLA?

  // Módulos de Agricultura
  ruralProducers           RuralProducer[]           @relation("RuralProducerProtocol")
  ruralProperties          RuralProperty[]           @relation("RuralPropertyProtocol")
  ruralPrograms            RuralProgram[]            @relation("RuralProgramProtocol")
  ruralProgramEnrollments  RuralProgramEnrollment[]  @relation("RuralProgramEnrollmentProtocol")
  ruralTrainings           RuralTraining[]           @relation("RuralTrainingProtocol")
  ruralTrainingEnrollments RuralTrainingEnrollment[] @relation("RuralTrainingEnrollmentProtocol")

  // Módulos de Saúde
  healthAttendances       HealthAttendance[]       @relation("HealthAttendanceProtocol")
  healthAppointments      HealthAppointment[]      @relation("HealthAppointmentProtocol")
  medicationDispenses     MedicationDispense[]     @relation("MedicationDispenseProtocol")
  healthCampaigns         HealthCampaign[]         @relation("HealthCampaignProtocol")
  healthPrograms          HealthProgram[]          @relation("HealthProgramProtocol")
  healthTransports        HealthTransport[]        @relation("HealthTransportProtocol")
  healthExams             HealthExam[]             @relation("HealthExamProtocol")
  healthTransportRequests HealthTransportRequest[] @relation("HealthTransportRequestProtocol")
  vaccinations            Vaccination[]            @relation("VaccinationProtocol")
  patients                Patient[]                @relation("PatientProtocol")
  communityHealthAgents   CommunityHealthAgent[]   @relation("CommunityHealthAgentProtocol")
  medicalAppointments     MedicalAppointment[]     @relation("MedicalAppointmentProtocol")
  vaccinationRecords      VaccinationRecord[]      @relation("VaccinationRecordProtocol")
  campaignEnrollments     CampaignEnrollment[]     @relation("CampaignEnrollmentProtocol")
  homeCares               HomeCare[]               @relation("HomeCareProtocol")
  medicalExams            MedicalExam[]            @relation("MedicalExamProtocol")

  // Módulos de Educação
  educationAttendances      EducationAttendance[]      @relation("EducationAttendanceProtocol")
  students                  Student[]                  @relation("StudentProtocol")
  schoolTransports          SchoolTransport[]          @relation("SchoolTransportProtocol")
  disciplinaryRecords       DisciplinaryRecord[]       @relation("DisciplinaryRecordProtocol")
  schoolDocuments           SchoolDocument[]           @relation("SchoolDocumentProtocol")
  studentTransfers          StudentTransfer[]          @relation("StudentTransferProtocol")
  attendanceRecords         AttendanceRecord[]         @relation("AttendanceRecordProtocol")
  gradeRecords              GradeRecord[]              @relation("GradeRecordProtocol")
  schoolManagements         SchoolManagement[]         @relation("SchoolManagementProtocol")
  schoolMeals               SchoolMeal[]               @relation("SchoolMealProtocol")
  studentEnrollmentRequests StudentEnrollmentRequest[] @relation("StudentEnrollmentRequestProtocol")
  schoolTransportRequests   SchoolTransportRequest[]   @relation("SchoolTransportRequestProtocol")
  schoolMealRequests        SchoolMealRequest[]        @relation("SchoolMealRequestProtocol")
  schoolTransferRequests    SchoolTransferRequest[]    @relation("SchoolTransferRequestProtocol")
  schoolMaterialRequests    SchoolMaterialRequest[]    @relation("SchoolMaterialRequestProtocol")

  // Módulos de Assistência Social
  socialAssistanceAttendances SocialAssistanceAttendance[] @relation("SocialAssistanceAttendanceProtocol")
  vulnerableFamilies          VulnerableFamily[]           @relation("VulnerableFamilyProtocol")
  benefitRequests             BenefitRequest[]             @relation("BenefitRequestProtocol")
  emergencyDeliveries         EmergencyDelivery[]          @relation("EmergencyDeliveryProtocol")
  socialGroupEnrollments      SocialGroupEnrollment[]      @relation("SocialGroupEnrollmentProtocol")
  homeVisits                  HomeVisit[]                  @relation("HomeVisitProtocol")
  socialProgramEnrollments    SocialProgramEnrollment[]    @relation("SocialProgramEnrollmentProtocol")
  socialBenefitRequests       SocialBenefitRequest[]       @relation("SocialBenefitRequestProtocol")
  documentRequests            DocumentRequest[]            @relation("DocumentRequestProtocol")
  familyRegistrations         FamilyRegistration[]         @relation("FamilyRegistrationProtocol")
  socialHomeVisits            SocialHomeVisit[]            @relation("SocialHomeVisitProtocol")
  socialAppointments          SocialAppointment[]          @relation("SocialAppointmentProtocol")
  socialEquipments            SocialEquipment[]            @relation("SocialEquipmentProtocol")

  // Módulos de Segurança Pública
  securityAttendances SecurityAttendance[] @relation("SecurityAttendanceProtocol")
  securityOccurrences SecurityOccurrence[] @relation("SecurityOccurrenceProtocol")
  patrolRequests      PatrolRequest[]      @relation("PatrolRequestProtocol")
  cameraRequests      CameraRequest[]      @relation("CameraRequestProtocol")
  anonymousTips       AnonymousTip[]       @relation("AnonymousTipProtocol")
  criticalPoints      CriticalPoint[]      @relation("CriticalPointProtocol")
  securityAlerts      SecurityAlert[]      @relation("SecurityAlertProtocol")
  securityPatrols     SecurityPatrol[]     @relation("SecurityPatrolProtocol")
  municipalGuards     MunicipalGuard[]     @relation("MunicipalGuardProtocol")
  surveillanceSystems SurveillanceSystem[] @relation("SurveillanceSystemProtocol")

  // Módulos de Esportes
  sportsAttendances                SportsAttendance[]                @relation("SportsAttendanceProtocol")
  athletes                         Athlete[]                         @relation("AthleteProtocol")
  sportsTeams                      SportsTeam[]                      @relation("SportsTeamProtocol")
  competitions                     Competition[]                     @relation("CompetitionProtocol")
  sportsInfrastructures            SportsInfrastructure[]            @relation("SportsInfrastructureProtocol")
  sportsSchools                    SportsSchool[]                    @relation("SportsSchoolProtocol")
  sportsModalities                 SportsModality[]                  @relation("SportsModalityProtocol")
  sportsSchoolEnrollments          SportsSchoolEnrollment[]          @relation("SportsSchoolEnrollmentProtocol")
  sportsInfrastructureReservations SportsInfrastructureReservation[] @relation("SportsInfrastructureReservationProtocol")
  competitionEnrollments           CompetitionEnrollment[]           @relation("CompetitionEnrollmentProtocol")
  tournamentEnrollments            TournamentEnrollment[]            @relation("TournamentEnrollmentProtocol")

  // Módulos de Cultura
  culturalAttendances         CulturalAttendance[]         @relation("CulturalAttendanceProtocol")
  culturalSpaceReservations   CulturalSpaceReservation[]   @relation("CulturalSpaceReservationProtocol")
  culturalWorkshopEnrollments CulturalWorkshopEnrollment[] @relation("CulturalWorkshopEnrollmentProtocol")
  artisticGroups              ArtisticGroup[]              @relation("ArtisticGroupProtocol")
  culturalProjects            CulturalProject[]            @relation("CulturalProjectProtocol")
  culturalProjectSubmissions  CulturalProjectSubmission[]  @relation("CulturalProjectSubmissionProtocol")
  culturalEvents              CulturalEvent[]              @relation("CulturalEventProtocol")
  culturalManifestations      CulturalManifestation[]      @relation("CulturalManifestationProtocol")

  // Módulos de Habitação
  housingAttendances   HousingAttendance[]   @relation("HousingAttendanceProtocol")
  housingApplications  HousingApplication[]  @relation("HousingApplicationProtocol")
  landRegularizations  LandRegularization[]  @relation("LandRegularizationProtocol")
  rentAssistances      RentAssistance[]      @relation("RentAssistanceProtocol")
  housingUnits         HousingUnit[]         @relation("HousingUnitProtocol")
  housingRegistrations HousingRegistration[] @relation("HousingRegistrationProtocol")

  // Módulos de Meio Ambiente
  environmentalAttendances  EnvironmentalAttendance[]  @relation("EnvironmentalAttendanceProtocol")
  environmentalLicenses     EnvironmentalLicense[]     @relation("EnvironmentalLicenseProtocol")
  environmentalComplaints   EnvironmentalComplaint[]   @relation("EnvironmentalComplaintProtocol")
  environmentalPrograms     EnvironmentalProgram[]     @relation("EnvironmentalProgramProtocol")
  treeCuttingAuthorizations TreeCuttingAuthorization[] @relation("TreeCuttingAuthorizationProtocol")
  environmentalInspections  EnvironmentalInspection[]  @relation("EnvironmentalInspectionProtocol")
  protectedAreas            ProtectedArea[]            @relation("ProtectedAreaProtocol")

  // Módulos de Obras Públicas
  publicWorksAttendances PublicWorksAttendance[] @relation("PublicWorksAttendanceProtocol")
  roadRepairRequests     RoadRepairRequest[]     @relation("RoadRepairRequestProtocol")
  technicalInspections   TechnicalInspection[]   @relation("TechnicalInspectionProtocol")
  publicWorks            PublicWork[]            @relation("PublicWorkProtocol")
  workInspections        WorkInspection[]        @relation("WorkInspectionProtocol")

  // Módulos de Planejamento Urbano
  projectApprovals         ProjectApproval[]         @relation("ProjectApprovalProtocol")
  buildingPermits          BuildingPermit[]          @relation("BuildingPermitProtocol")
  businessLicenses         BusinessLicense[]         @relation("BusinessLicenseProtocol")
  certificateRequests      CertificateRequest[]      @relation("CertificateRequestProtocol")
  urbanInfractions         UrbanInfraction[]         @relation("UrbanInfractionProtocol")
  urbanZonings             UrbanZoning[]             @relation("UrbanZoningProtocol")
  urbanPlanningAttendances UrbanPlanningAttendance[] @relation("UrbanPlanningAttendanceProtocol")

  // Módulos de Serviços Públicos
  publicServiceAttendances PublicServiceAttendance[] @relation("PublicServiceAttendanceProtocol")
  streetLightings          StreetLighting[]          @relation("StreetLightingProtocol")
  urbanCleanings           UrbanCleaning[]           @relation("UrbanCleaningProtocol")
  specialCollections       SpecialCollection[]       @relation("SpecialCollectionProtocol")
  weedingRequests          WeedingRequest[]          @relation("WeedingRequestProtocol")
  drainageRequests         DrainageRequest[]         @relation("DrainageRequestProtocol")
  treePruningRequests      TreePruningRequest[]      @relation("TreePruningRequestProtocol")
  serviceTeams             ServiceTeam[]             @relation("ServiceTeamProtocol")
  publicServiceRequests    PublicServiceRequest[]    @relation("PublicServiceRequestProtocol")
  cleaningSchedules        CleaningSchedule[]        @relation("CleaningScheduleProtocol")
  teamSchedules            TeamSchedule[]            @relation("TeamScheduleProtocol")
  publicProblemReports     PublicProblemReport[]     @relation("PublicProblemReportProtocol")

  // Módulos de Turismo
  tourismAttendances     TourismAttendance[]     @relation("TourismAttendanceProtocol")
  touristAttractions     TouristAttraction[]     @relation("TouristAttractionProtocol")
  localBusinesses        LocalBusiness[]         @relation("LocalBusinessProtocol")
  tourismPrograms        TourismProgram[]        @relation("TourismProgramProtocol")
  tourismGuides          TourismGuide[]          @relation("TourismGuideProtocol")
  tourismRoutes          TourismRoute[]          @relation("TourismRouteProtocol")
  tourismEvents          TourismEvent[]          @relation("TourismEventProtocol")
  technicalAssistances   TechnicalAssistance[]   @relation("TechnicalAssistanceProtocol")
  agricultureAttendances AgricultureAttendance[] @relation("AgricultureAttendanceProtocol")

  @@index([status])
  @@index([createdAt])
  @@index([moduleType, status])
  @@map("protocols_simplified")
}

model ProtocolHistorySimplified {
  id         String   @id @default(cuid())
  action     String
  comment    String?
  oldStatus  String?
  newStatus  String?
  metadata   Json?
  timestamp  DateTime @default(now())
  userId     String?
  protocolId String

  protocol ProtocolSimplified @relation(fields: [protocolId], references: [id], onDelete: Cascade)

  @@map("protocol_history_simplified")
}

model ProtocolEvaluationSimplified {
  id             String   @id @default(cuid())
  protocolId     String
  rating         Int
  comment        String?
  wouldRecommend Boolean  @default(true)
  createdAt      DateTime @default(now())

  protocol ProtocolSimplified @relation(fields: [protocolId], references: [id], onDelete: Cascade)

  @@map("protocol_evaluations_simplified")
}

// ========================================
// SISTEMA DE INTERAÇÕES
// ========================================

model ProtocolInteraction {
  id         String          @id @default(cuid())
  protocolId String
  type       InteractionType

  // Autor
  authorType String // CITIZEN, SERVER, SYSTEM
  authorId   String?
  authorName String

  // Conteúdo
  message  String?
  metadata Json?

  // Visibilidade
  isInternal Boolean   @default(false)
  isRead     Boolean   @default(false)
  readAt     DateTime?

  // Anexos
  attachments Json?

  createdAt DateTime @default(now())

  protocol ProtocolSimplified @relation(fields: [protocolId], references: [id], onDelete: Cascade)

  @@index([protocolId, createdAt])
  @@index([protocolId])
  @@map("protocol_interactions")
}

enum InteractionType {
  MESSAGE
  DOCUMENT_REQUEST
  DOCUMENT_UPLOAD
  PENDING_CREATED
  PENDING_RESOLVED
  STATUS_CHANGED
  ASSIGNED
  INSPECTION_SCHEDULED
  INSPECTION_COMPLETED
  APPROVAL
  REJECTION
  CANCELLATION
  NOTE
}

// ========================================
// SISTEMA DE DOCUMENTOS
// ========================================

model ProtocolDocument {
  id         String @id @default(cuid())
  protocolId String

  // Tipo de documento
  documentType String
  isRequired   Boolean

  // Status do documento
  status DocumentStatus @default(PENDING)

  // Arquivo
  fileName String?
  fileUrl  String?
  fileSize Int?
  mimeType String?

  // Validação
  uploadedAt      DateTime?
  uploadedBy      String?
  validatedAt     DateTime?
  validatedBy     String?
  rejectedAt      DateTime?
  rejectionReason String?

  // Versionamento
  version       Int     @default(1)
  previousDocId String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  protocol ProtocolSimplified @relation(fields: [protocolId], references: [id], onDelete: Cascade)

  @@index([protocolId, documentType])
  @@index([protocolId])
  @@map("protocol_documents")
}

enum DocumentStatus {
  PENDING
  UPLOADED
  UNDER_REVIEW
  APPROVED
  REJECTED
  EXPIRED
}

// ========================================
// SISTEMA DE PENDÊNCIAS
// ========================================

model ProtocolPending {
  id         String @id @default(cuid())
  protocolId String

  // Tipo e descrição
  type        PendingType
  title       String
  description String

  // Prazo
  dueDate DateTime?

  // Status
  status     PendingStatus @default(OPEN)
  resolvedAt DateTime?
  resolvedBy String?
  resolution String?

  // Bloqueio
  blocksProgress Boolean @default(true)

  // Metadados
  metadata Json?

  // Criação
  createdBy String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  protocol ProtocolSimplified @relation(fields: [protocolId], references: [id], onDelete: Cascade)

  @@index([protocolId, status])
  @@index([protocolId])
  @@map("protocol_pendings")
}

enum PendingType {
  DOCUMENT
  INFORMATION
  CORRECTION
  VALIDATION
  PAYMENT
  INSPECTION
  APPROVAL
  OTHER
}

enum PendingStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  EXPIRED
  CANCELLED
}

// ========================================
// WORKFLOW ESPECÍFICO POR MÓDULO
// ========================================

model ModuleWorkflow {
  id          String  @id @default(cuid())
  moduleType  String  @unique
  name        String
  description String?

  // Etapas estruturadas
  stages Json // Array de etapas do workflow

  // SLA padrão
  defaultSLA Int? // Dias úteis

  // Regras de transição
  rules Json? // Regras de validação e transição

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("module_workflows")
}

model ProtocolStage {
  id         String @id @default(cuid())
  protocolId String

  // Etapa
  stageName  String
  stageOrder Int

  // Status
  status StageStatus @default(PENDING)

  // Timestamps
  startedAt   DateTime?
  completedAt DateTime?
  dueDate     DateTime?

  // Responsável
  assignedTo  String?
  completedBy String?

  // Resultado
  result   String?
  notes    String?
  metadata Json?

  protocol ProtocolSimplified @relation(fields: [protocolId], references: [id], onDelete: Cascade)

  @@index([protocolId, stageOrder])
  @@index([protocolId])
  @@map("protocol_stages")
}

enum StageStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  SKIPPED
  FAILED
}

// ========================================
// SLA E PRAZOS AUTOMÁTICOS
// ========================================

model ProtocolSLA {
  id         String @id @default(cuid())
  protocolId String @unique

  // Prazos
  startDate       DateTime
  expectedEndDate DateTime
  actualEndDate   DateTime?

  // Pausa (ex: aguardando cidadão)
  isPaused        Boolean   @default(false)
  pausedAt        DateTime?
  pausedReason    String?
  totalPausedDays Int       @default(0)

  // Status
  isOverdue   Boolean @default(false)
  daysOverdue Int     @default(0)

  // Cálculo
  workingDays  Int // Dias úteis
  calendarDays Int // Dias corridos

  updatedAt DateTime @updatedAt

  protocol ProtocolSimplified @relation(fields: [protocolId], references: [id], onDelete: Cascade)

  @@map("protocol_sla")
}

// ========================================
// FIM DO SISTEMA SIMPLIFICADO
// ========================================

model Notification {
  id         String    @id @default(cuid())
  citizenId  String
  title      String
  message    String
  type       String    @default("INFO")
  channel    String    @default("WEB")
  isRead     Boolean   @default(false)
  sentAt     DateTime?
  readAt     DateTime?
  protocolId String?
  metadata   Json?
  createdAt  DateTime  @default(now())
  citizen    Citizen   @relation(fields: [citizenId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model CitizenTransferRequest {
  id           String    @id @default(cuid())
  citizenId    String
  status       String    @default("PENDING")
  reason       String
  documents    Json?
  reviewedById String?
  reviewedAt   DateTime?
  reviewNotes  String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  reviewedBy   User?     @relation(fields: [reviewedById], references: [id])
  citizen      Citizen   @relation(fields: [citizenId], references: [id], onDelete: Cascade)

  @@map("citizen_transfer_requests")
}

model Analytics {
  id         String   @id @default(cuid())
  type       String
  entityId   String
  metric     String
  value      Float
  dimension  String?
  period     String
  periodType String
  metadata   Json?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([type, metric, period])
  @@index([entityId, metric])
  @@index([periodType, createdAt])
  @@map("analytics")
}

// ========================================
// ANALYTICS E RELATÓRIOS - FASE 4
// ========================================

model ProtocolMetrics {
  id String @id @default(cuid())

  // Período
  periodType String // DAILY, WEEKLY, MONTHLY, YEARLY
  periodDate DateTime // Data de referência do período

  // Métricas gerais
  totalProtocols     Int @default(0)
  newProtocols       Int @default(0)
  closedProtocols    Int @default(0)
  cancelledProtocols Int @default(0)
  overdueProtocols   Int @default(0)

  // Métricas de tempo
  avgCompletionTime Float? // Em horas
  avgFirstResponse  Float? // Tempo até primeira interação
  avgResolutionTime Float? // Tempo até resolução

  // Métricas de qualidade
  approvalRate      Float? // Taxa de aprovação (0-100)
  rejectionRate     Float? // Taxa de rejeição (0-100)
  satisfactionScore Float? // Nota média de avaliação

  // Métricas de SLA
  slaComplianceRate Float? // % de protocolos dentro do prazo
  avgSlaDeviation   Float? // Desvio médio do SLA em dias

  // Métricas de pendências
  totalPendings    Int    @default(0)
  resolvedPendings Int    @default(0)
  avgPendingTime   Float? // Tempo médio para resolver pendência

  // Métricas de documentos
  totalDocuments       Int    @default(0)
  approvedDocuments    Int    @default(0)
  rejectedDocuments    Int    @default(0)
  documentApprovalRate Float?

  metadata  Json?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([periodType, periodDate])
  @@index([periodType, periodDate])
  @@map("protocol_metrics")
}

model DepartmentMetrics {
  id           String @id @default(cuid())
  departmentId String

  // Período
  periodType String // DAILY, WEEKLY, MONTHLY, YEARLY
  periodDate DateTime

  // Volume
  totalProtocols     Int @default(0)
  activeProtocols    Int @default(0)
  completedProtocols Int @default(0)

  // Performance
  avgCompletionTime Float? // Em horas
  slaComplianceRate Float? // %
  satisfactionScore Float?

  // Produtividade
  protocolsPerServer Float? // Média de protocolos por servidor
  avgWorkload        Float? // Carga média de trabalho

  metadata  Json?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([departmentId, periodType, periodDate])
  @@index([departmentId, periodType])
  @@map("department_metrics")
}

model ServiceMetrics {
  id        String @id @default(cuid())
  serviceId String

  // Período
  periodType String
  periodDate DateTime

  // Volume
  totalRequests     Int @default(0)
  completedRequests Int @default(0)

  // Performance
  avgCompletionTime Float?
  approvalRate      Float?
  rejectionRate     Float?

  // Qualidade
  satisfactionScore Float?
  complaintRate     Float? // Taxa de reclamações

  // Gargalos
  avgDocumentTime Float? // Tempo médio em análise documental
  avgPendingTime  Float? // Tempo médio aguardando pendências

  metadata  Json?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([serviceId, periodType, periodDate])
  @@index([serviceId, periodType])
  @@map("service_metrics")
}

model ServerPerformance {
  id     String @id @default(cuid())
  userId String

  // Período
  periodType String
  periodDate DateTime

  // Produtividade
  protocolsAssigned  Int @default(0)
  protocolsCompleted Int @default(0)
  protocolsOnTime    Int @default(0)
  protocolsOverdue   Int @default(0)

  // Tempo
  avgCompletionTime Float?
  avgResponseTime   Float? // Tempo médio até primeira resposta
  totalWorkingHours Float? // Horas trabalhadas no período

  // Qualidade
  satisfactionScore Float?
  approvalRate      Float?
  pendingResolution Float? // Taxa de resolução de pendências

  // Interações
  totalInteractions          Int    @default(0)
  avgInteractionsPerProtocol Float?

  metadata  Json?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, periodType, periodDate])
  @@index([userId, periodType])
  @@map("server_performance")
}

model ProtocolBottleneck {
  id String @id @default(cuid())

  // Identificação do gargalo
  bottleneckType String // STAGE, DOCUMENT, PENDING, APPROVAL
  entityId       String // ID da etapa, tipo de documento, etc
  entityName     String // Nome legível

  // Período
  periodType String
  periodDate DateTime

  // Métricas
  affectedProtocols Int   @default(0)
  avgStuckTime      Float // Tempo médio parado neste gargalo (horas)
  maxStuckTime      Float // Tempo máximo
  totalDelayHours   Float // Soma total de horas de atraso

  // Impacto
  impactScore Float // Score de 0-100 de impacto
  priority    String @default("MEDIUM") // LOW, MEDIUM, HIGH, CRITICAL

  metadata  Json?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([bottleneckType, entityId, periodType, periodDate])
  @@index([periodType, impactScore])
  @@map("protocol_bottlenecks")
}

model KPI {
  id              String    @id @default(cuid())
  name            String
  description     String?
  category        String
  formula         String
  unit            String
  target          Float?
  warning         Float?
  critical        Float?
  currentValue    Float?
  lastCalculated  DateTime?
  isActive        Boolean   @default(true)
  updateFrequency String    @default("daily")
  createdBy       String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([category, isActive])
  @@index([updateFrequency])
  @@map("kpis")
}

model Report {
  id          String            @id @default(cuid())
  name        String
  description String?
  type        ReportType
  category    String
  config      Json
  template    String?
  schedule    Json?
  accessLevel Int
  departments Json?
  isActive    Boolean           @default(true)
  isPublic    Boolean           @default(false)
  createdBy   String
  lastRun     DateTime?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  executions  ReportExecution[]

  @@index([type, isActive])
  @@index([createdBy])
  @@map("reports")
}

model ReportExecution {
  id            String                @id @default(cuid())
  reportId      String
  parameters    Json?
  filters       Json?
  data          Json?
  format        ReportFormat
  fileUrl       String?
  fileSize      Int?
  status        ReportExecutionStatus
  startedAt     DateTime              @default(now())
  completedAt   DateTime?
  errorMessage  String?
  executedBy    String?
  expiresAt     DateTime?
  downloadCount Int                   @default(0)
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt
  report        Report                @relation(fields: [reportId], references: [id], onDelete: Cascade)

  @@index([reportId, status])
  @@index([executedBy, startedAt])
  @@map("report_executions")
}

model Dashboard {
  id          String   @id @default(cuid())
  name        String
  description String?
  layout      Json
  userLevel   Int
  department  String?
  isDefault   Boolean  @default(false)
  refreshRate Int      @default(300)
  isActive    Boolean  @default(true)
  createdBy   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userLevel, isActive])
  @@index([createdBy])
  @@map("dashboards")
}

model Alert {
  id            String         @id @default(cuid())
  name          String
  description   String?
  type          AlertType
  metric        String
  condition     String
  threshold     Float
  threshold2    Float?
  frequency     AlertFrequency
  isActive      Boolean        @default(true)
  cooldown      Int            @default(3600)
  recipients    Json?
  channels      Json?
  lastTriggered DateTime?
  triggerCount  Int            @default(0)
  createdBy     String
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  triggers      AlertTrigger[]

  @@index([type, isActive])
  @@index([metric, isActive])
  @@map("alerts")
}

model AlertTrigger {
  id          String    @id @default(cuid())
  alertId     String
  value       Float
  message     String
  data        Json?
  isResolved  Boolean   @default(false)
  resolvedAt  DateTime?
  resolvedBy  String?
  triggeredAt DateTime  @default(now())
  alert       Alert     @relation(fields: [alertId], references: [id], onDelete: Cascade)

  @@index([alertId, triggeredAt])
  @@index([isResolved, triggeredAt])
  @@map("alert_triggers")
}

model MetricCache {
  id        String   @id @default(cuid())
  cacheKey  String
  data      Json
  metadata  Json?
  expiresAt DateTime
  hitCount  Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([cacheKey])
  @@index([expiresAt])
  @@map("metric_cache")
}

model Benchmark {
  id         String   @id @default(cuid())
  metric     String
  category   String
  region     String
  population String
  p25        Float?
  p50        Float?
  p75        Float?
  average    Float?
  sampleSize Int
  period     String
  year       Int
  source     String?
  updatedAt  DateTime @updatedAt

  @@index([metric, region, population])
  @@index([category, year])
  @@map("benchmarks")
}

model Prediction {
  id          String    @id @default(cuid())
  model       String
  version     String
  algorithm   String
  input       Json
  prediction  Json
  confidence  Float
  entityType  String
  entityId    String?
  horizon     String
  actualValue Float?
  accuracy    Float?
  createdAt   DateTime  @default(now())
  validatedAt DateTime?

  @@index([model, entityType])
  @@index([createdAt])
  @@map("predictions")
}

model EmailServer {
  id                String        @id @default(cuid())
  hostname          String
  mxPort            Int           @default(25)
  submissionPort    Int           @default(587)
  isActive          Boolean       @default(false)
  isPremiumService  Boolean       @default(true)
  monthlyPrice      Decimal       @default(99.00)
  maxEmailsPerMonth Int           @default(10000)
  tlsEnabled        Boolean       @default(true)
  certPath          String?
  keyPath           String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  domains           EmailDomain[]
  logs              EmailLog[]
  statistics        EmailStats[]
  users             EmailUser[]
  emails            Email[]

  @@map("email_servers")
}

model EmailDomain {
  id                String      @id @default(cuid())
  emailServerId     String
  domainName        String
  isVerified        Boolean     @default(false)
  verificationToken String?
  dkimEnabled       Boolean     @default(true)
  dkimSelector      String      @default("default")
  dkimPrivateKey    String?
  dkimPublicKey     String?
  spfEnabled        Boolean     @default(true)
  spfRecord         String?
  dmarcEnabled      Boolean     @default(false)
  dmarcPolicy       String?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  emailServer       EmailServer @relation(fields: [emailServerId], references: [id])
  sentEmails        Email[]

  @@unique([emailServerId, domainName])
  @@map("email_domains")
}

model EmailUser {
  id            String             @id @default(cuid())
  emailServerId String
  email         String
  passwordHash  String
  name          String
  isActive      Boolean            @default(true)
  isAdmin       Boolean            @default(false)
  dailyLimit    Int                @default(1000)
  monthlyLimit  Int                @default(10000)
  sentToday     Int                @default(0)
  sentThisMonth Int                @default(0)
  lastLoginAt   DateTime?
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  authAttempts  EmailAuthAttempt[]
  emailServer   EmailServer        @relation(fields: [emailServerId], references: [id])
  sentEmails    Email[]

  @@unique([emailServerId, email])
  @@map("email_users")
}

model Email {
  id            String       @id @default(cuid())
  emailServerId String?
  domainId      String?
  userId        String?
  messageId     String       @unique
  fromEmail     String
  toEmail       String
  ccEmails      Json?
  bccEmails     Json?
  subject       String
  textContent   String?
  htmlContent   String?
  headers       Json?
  attachments   Json?
  status        EmailStatus  @default(QUEUED)
  priority      Int          @default(3)
  retryCount    Int          @default(0)
  maxRetries    Int          @default(3)
  scheduledFor  DateTime?
  sentAt        DateTime?
  deliveredAt   DateTime?
  failedAt      DateTime?
  errorMessage  String?
  opens         Int          @default(0)
  clicks        Int          @default(0)
  unsubscribed  Boolean      @default(false)
  complained    Boolean      @default(false)
  bounced       Boolean      @default(false)
  dkimSigned    Boolean      @default(false)
  dkimSignature String?
  campaignId    String?
  tags          Json?
  metadata      Json?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  events        EmailEvent[]
  user          EmailUser?   @relation(fields: [userId], references: [id])
  domain        EmailDomain? @relation(fields: [domainId], references: [id])
  emailServer   EmailServer? @relation(fields: [emailServerId], references: [id])

  @@map("emails")
}

model EmailEvent {
  id        String         @id @default(cuid())
  emailId   String
  type      EmailEventType
  data      Json?
  userAgent String?
  ipAddress String?
  timestamp DateTime       @default(now())
  email     Email          @relation(fields: [emailId], references: [id])

  @@map("email_events")
}

model EmailLog {
  id            String       @id @default(cuid())
  emailServerId String?
  from          String?
  to            String?
  subject       String?
  status        String?
  type          String?
  level         LogLevel     @default(INFO)
  message       String
  metadata      Json?
  data          Json?
  timestamp     DateTime     @default(now())
  emailServer   EmailServer? @relation(fields: [emailServerId], references: [id])

  @@map("email_logs")
}

model EmailStats {
  id              String      @id @default(cuid())
  emailServerId   String
  date            DateTime
  totalSent       Int         @default(0)
  totalDelivered  Int         @default(0)
  totalFailed     Int         @default(0)
  totalBounced    Int         @default(0)
  totalComplained Int         @default(0)
  totalOpens      Int         @default(0)
  totalClicks     Int         @default(0)
  uniqueOpens     Int         @default(0)
  uniqueClicks    Int         @default(0)
  emailServer     EmailServer @relation(fields: [emailServerId], references: [id])

  @@unique([emailServerId, date])
  @@map("email_stats")
}

model EmailAuthAttempt {
  id        String     @id @default(cuid())
  userId    String?
  email     String
  ipAddress String
  userAgent String?
  success   Boolean    @default(false)
  reason    String?
  timestamp DateTime   @default(now())
  user      EmailUser? @relation(fields: [userId], references: [id])

  @@map("email_auth_attempts")
}

model EmailTemplate {
  id          String   @id @default(cuid())
  name        String
  subject     String
  htmlContent String
  textContent String?
  variables   Json?
  category    String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([name])
  @@map("email_templates")
}

model Integration {
  id          String           @id @default(cuid())
  name        String
  type        String
  provider    String
  config      Json
  credentials Json
  isActive    Boolean          @default(true)
  status      String           @default("active")
  lastSync    DateTime?
  createdAt   DateTime         @default(now())
  logs        IntegrationLog[]

  @@unique([provider])
  @@map("integrations")
}

model IntegrationLog {
  id            String      @id @default(cuid())
  integrationId String
  entityType    String
  entityId      String
  action        String
  status        String
  request       Json?
  response      Json?
  error         String?
  createdAt     DateTime    @default(now())
  integration   Integration @relation(fields: [integrationId], references: [id])

  @@index([integrationId, status])
  @@index([entityType, entityId])
  @@map("integration_logs")
}

model CacheEntry {
  id        String   @id @default(cuid())
  key       String   @unique
  value     Json
  expiresAt DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([expiresAt])
  @@map("cache_entries")
}

model AuditLog {
  id           String   @id @default(cuid())
  userId       String?
  citizenId    String?
  action       String
  resource     String?
  method       String?
  details      Json?
  ip           String?
  userAgent    String?
  success      Boolean  @default(true)
  errorMessage String?
  createdAt    DateTime @default(now())
  citizen      Citizen? @relation(fields: [citizenId], references: [id])
  user         User?    @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([citizenId])
  @@index([action])
  @@index([createdAt])
  @@map("audit_logs")
}

model RuralProducer {
  id                  String                    @id @default(cuid())
  citizenId           String                    // ✅ OBRIGATÓRIO - vincula ao cidadão
  protocolId          String?

  // ✅ CAMPOS DE COMPATIBILIDADE (redundantes com Citizen, mas necessários para código legado)
  name                String?                   // Nome do produtor (idealmente usar citizen.name)
  producerName        String?                   // Alias para nome
  document            String?                   // CPF do produtor (idealmente usar citizen.cpf)
  email               String?                   // Email (idealmente usar citizen.email)
  phone               String?                   // Telefone (idealmente usar citizen.phone)
  address             String?                   // Endereço (idealmente usar citizen.address)

  // ✅ Campos ESPECÍFICOS do produtor rural
  productionType      String?                   // Tipo de produção (Agricultor Familiar, Produtor Rural, etc)
  mainCrop            String?                   // Cultura principal
  dap                 String?                   // DAP - Declaração de Aptidão ao PRONAF
  totalAreaHectares   Float?                    // Área total em hectares
  mainProductions     String?                   // Principais produções

  status              String                    @default("PENDING_APPROVAL")
  isActive            Boolean                   @default(false)
  approvedAt          DateTime?
  createdAt           DateTime                  @default(now())
  updatedAt           DateTime                  @updatedAt

  citizen             Citizen                   @relation("RuralProducerCitizen", fields: [citizenId], references: [id])
  protocol            ProtocolSimplified?       @relation("RuralProducerProtocol", fields: [protocolId], references: [id])
  properties          RuralProperty[]
  programEnrollments  RuralProgramEnrollment[]  @relation("RuralProgramEnrollmentProducer")
  trainingEnrollments RuralTrainingEnrollment[] @relation("RuralTrainingEnrollmentProducer")

  @@unique([citizenId])
  @@index([citizenId])
  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("rural_producers")
}

model RuralProperty {
  id             String              @id @default(cuid())
  citizenId      String              // ✅ OBRIGATÓRIO - vincula ao cidadão proprietário
  protocolId     String?
  producerId     String?             // ✅ Opcional - nem todo cidadão é produtor cadastrado

  // ✅ CAMPOS DE COMPATIBILIDADE (redundantes com Citizen, mas necessários para código legado)
  owner          String?             // Nome do proprietário (idealmente usar citizen.name)

  // ✅ Campos ESPECÍFICOS da propriedade rural
  name           String              // Nome da propriedade
  size           Float               // Tamanho (legado - usar totalArea)
  totalArea      Float?              // Área total em hectares
  cultivatedArea Float?              // Área cultivada em hectares
  plantedArea    Float?              // Área plantada em hectares
  location       String              // Localização/endereço
  coordinates    Json?               // Coordenadas GPS {lat, lng}
  mainCrops      Json?               // Culturas principais (array)
  documentType   String?             // Tipo de documento (Escritura, Posse, etc)
  documentNumber String?             // Número do documento

  status         String              @default("ACTIVE")
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt

  citizen        Citizen             @relation("RuralPropertyCitizen", fields: [citizenId], references: [id])
  protocol       ProtocolSimplified? @relation("RuralPropertyProtocol", fields: [protocolId], references: [id])
  producer       RuralProducer?      @relation(fields: [producerId], references: [id])

  @@index([citizenId])
  @@index([producerId])
  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("rural_properties")
}

model BuildingPermit {
  id                String              @id @default(cuid())
  protocolId        String?
  applicantName     String
  applicantCpf      String? // Campo adicionado
  applicantCpfCnpj  String?
  applicantPhone    String? // Campo adicionado
  propertyAddress   String
  property          Json?
  construction      Json?
  permitType        String
  requestedBy       String?
  observations      String?
  status            String              @default("PENDING")
  submissionDate    DateTime            @default(now())
  approvalDate      DateTime?
  description       String?
  documents         Json?
  technicalAnalysis Json? // Campo adicionado
  permitNumber      String? // Campo adicionado
  reviewedBy        String? // Campo adicionado
  applicantEmail    String? // Campo adicionado
  requirements      Json? // Campo adicionado
  issuedDate        DateTime? // Campo adicionado
  reviewedAt        DateTime? // Campo adicionado
  constructionType  String?
  validUntil        DateTime?
  propertyNumber    String?
  approvedBy        String?
  neighborhood      String?
  lotNumber         String? // Número do lote
  blockNumber       String? // Número da quadra
  totalArea         Float? // Área total do terreno/construção
  builtArea         Float? // Área construída
  floors            Int? // Número de andares
  projectValue      Float? // Valor do projeto
  approvedAt        DateTime?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  protocol          ProtocolSimplified? @relation("BuildingPermitProtocol", fields: [protocolId], references: [id])

  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("building_permits")
}

model PublicComplaint {
  id              String    @id @default(cuid())
  complainantName String?
  description     String
  location        String?
  status          String    @default("OPEN")
  priority        String    @default("MEDIUM")
  category        String?
  submissionDate  DateTime  @default(now())
  resolutionDate  DateTime?
  assignedTo      String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@map("public_complaints")
}

model PublicConsultation {
  id                 String   @id @default(cuid())
  title              String
  description        String
  startDate          DateTime
  endDate            DateTime
  status             String   @default("ACTIVE")
  participationCount Int      @default(0)
  documents          Json?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  @@map("public_consultations")
}

model UrbanZoning {
  id           String              @id @default(cuid())
  protocolId   String?
  name         String?
  zoneName     String
  code         String?
  type         String?
  zoneType     String
  description  String?
  regulations  Json?
  permitedUses Json?
  restrictions Json?
  coordinates  Json?
  boundaries   Json?
  isActive     Boolean             @default(true)
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  protocol     ProtocolSimplified? @relation("UrbanZoningProtocol", fields: [protocolId], references: [id])

  @@map("urban_zoning")
}

model ProjectApproval {
  id             String              @id @default(cuid())
  protocolId     String?
  projectName    String
  applicantName  String
  projectType    String
  status         String              @default("UNDER_REVIEW")
  submissionDate DateTime            @default(now())
  approvalDate   DateTime?
  description    String?
  documents      Json?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  protocol       ProtocolSimplified? @relation("ProjectApprovalProtocol", fields: [protocolId], references: [id])

  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("project_approvals")
}

model UrbanPlanningAttendance {
  id             String              @id @default(cuid())
  protocolId     String?
  citizenId      String?
  citizenName    String
  contactInfo    String?
  subject        String
  description    String
  status         String              @default("OPEN")
  attendanceDate DateTime            @default(now())
  resolvedDate   DateTime?
  assignedTo     String?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  protocol       ProtocolSimplified? @relation("UrbanPlanningAttendanceProtocol", fields: [protocolId], references: [id])
  citizen        Citizen?            @relation("UrbanPlanningAttendanceCitizen", fields: [citizenId], references: [id])

  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("urban_planning_attendances")
}

model UrbanProject {
  id          String    @id @default(cuid())
  name        String
  description String
  projectType String
  type        String
  status      String    @default("PLANNING")
  startDate   DateTime?
  endDate     DateTime?
  budget      Float?
  location    String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@map("urban_projects")
}

model BusinessLicense {
  id                String              @id @default(cuid())
  protocolId        String?
  applicantName     String
  applicantCpfCnpj  String
  applicantPhone    String?
  applicantEmail    String?
  businessName      String
  businessType      String
  businessActivity  String
  propertyAddress   String
  propertyNumber    String?
  neighborhood      String?
  licenseType       String
  status            String              @default("PENDING")
  submissionDate    DateTime            @default(now())
  approvalDate      DateTime?
  validUntil        DateTime?
  licenseNumber     String?
  observations      String?
  documents         Json?
  technicalAnalysis Json?
  reviewedBy        String?
  reviewedAt        DateTime?
  issuedDate        DateTime?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  protocol          ProtocolSimplified? @relation("BusinessLicenseProtocol", fields: [protocolId], references: [id])

  @@map("business_licenses")
}

model CertificateRequest {
  id                String              @id @default(cuid())
  protocolId        String?
  applicantName     String
  applicantCpfCnpj  String
  applicantPhone    String?
  applicantEmail    String?
  certificateType   String
  purpose           String?
  propertyAddress   String?
  propertyNumber    String?
  neighborhood      String?
  status            String              @default("PENDING")
  submissionDate    DateTime            @default(now())
  issuedDate        DateTime?
  validUntil        DateTime?
  certificateNumber String?
  observations      String?
  documents         Json?
  reviewedBy        String?
  reviewedAt        DateTime?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  protocol          ProtocolSimplified? @relation("CertificateRequestProtocol", fields: [protocolId], references: [id])

  @@map("certificate_requests")
}

model UrbanInfraction {
  id               String              @id @default(cuid())
  protocolId       String?
  complainantName  String?
  complainantPhone String?
  complainantEmail String?
  infractionType   String
  description      String
  propertyAddress  String
  propertyNumber   String?
  neighborhood     String?
  latitude         Float?
  longitude        Float?
  photos           Json?
  status           String              @default("OPEN")
  priority         String              @default("MEDIUM")
  submissionDate   DateTime            @default(now())
  inspectionDate   DateTime?
  resolutionDate   DateTime?
  assignedTo       String?
  observations     String?
  documents        Json?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  protocol         ProtocolSimplified? @relation("UrbanInfractionProtocol", fields: [protocolId], references: [id])

  @@map("urban_infractions")
}

model EmailSubscription {
  id             String    @id @default(cuid())
  email          String    @unique
  name           String?
  source         String?
  status         String    @default("ACTIVE")
  subscribedAt   DateTime  @default(now())
  unsubscribedAt DateTime?
  preferences    Json?
  metadata       Json?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@map("email_subscriptions")
}

model CulturalAttendance {
  id                String                   @id @default(cuid())
  protocolId        String?
  protocol          String                   @unique
  citizenId         String?
  citizenName       String
  contact           String
  phone             String?
  email             String?
  type              CulturalAttendanceType
  status            CulturalAttendanceStatus
  description       String
  observations      String?
  responsible       String?
  attachments       Json?
  subject           String?
  category          String?
  requestedLocation String?
  eventDate         DateTime?
  estimatedAudience Int?
  requestedBudget   Float?
  priority          String                   @default("MEDIUM")
  followUpDate      DateTime?
  serviceId         String?
  source            String                   @default("manual")
  createdAt         DateTime                 @default(now())
  updatedAt         DateTime                 @updatedAt

  protocolSimplified ProtocolSimplified? @relation("CulturalAttendanceProtocol", fields: [protocolId], references: [id])

  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("cultural_attendances")
}

model ArtisticGroup {
  id             String    @id @default(cuid())
  protocolId     String?
  name           String
  category       String
  foundationDate DateTime?
  responsible    String
  contact        String
  members        Json?
  status         String    @default("ACTIVE")
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  protocolSimplified ProtocolSimplified? @relation("ArtisticGroupProtocol", fields: [protocolId], references: [id])

  @@map("artistic_groups")
}

model CulturalManifestation {
  id               String   @id @default(cuid())
  protocolId       String?
  name             String
  type             String
  description      String
  currentSituation String
  knowledgeHolders Json?
  safeguardActions Json?
  status           String   @default("ACTIVE")
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  protocolSimplified ProtocolSimplified? @relation("CulturalManifestationProtocol", fields: [protocolId], references: [id])

  @@map("cultural_manifestations")
}

model CulturalWorkshop {
  id                  String   @id @default(cuid())
  name                String
  category            String
  description         String
  instructor          String
  startDate           DateTime
  endDate             DateTime
  schedule            String
  maxParticipants     Int
  currentParticipants Int      @default(0)
  isFree              Boolean  @default(true)
  status              String   @default("PLANNED")

  // Campos customizáveis para formulário de inscrição
  customFields       Json? // Array de campos adicionais
  requiredDocuments  Json? // Array de documentos necessários
  enrollmentSettings Json? // Configurações de inscrição

  createdAt   DateTime                     @default(now())
  updatedAt   DateTime                     @updatedAt
  enrollments CulturalWorkshopEnrollment[]

  @@map("cultural_workshops")
}

model CulturalWorkshopEnrollment {
  id            String    @id @default(cuid())
  protocolId    String?
  workshopId    String
  citizenId     String?
  citizenName   String
  cpf           String
  birthDate     DateTime?
  phone         String
  email         String?
  address       String?
  hasExperience Boolean   @default(false)
  experience    String?
  motivation    String
  status        String    @default("PENDING")
  enrolledAt    DateTime  @default(now())
  approvedAt    DateTime?

  // Dados customizados
  customData Json?
  documents  Json?

  // Observações
  adminNotes      String?
  rejectionReason String?

  // Metadados
  moduleType String   @default("INSCRICAO_OFICINA_CULTURAL")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  workshop           CulturalWorkshop    @relation(fields: [workshopId], references: [id])
  protocolSimplified ProtocolSimplified? @relation("CulturalWorkshopEnrollmentProtocol", fields: [protocolId], references: [id])
  citizen            Citizen?            @relation("CulturalWorkshopEnrollmentCitizen", fields: [citizenId], references: [id])

  @@index([workshopId])
  @@index([status])
  @@index([moduleType])
  @@index([protocolId])
  @@index([createdAt])
  @@map("cultural_workshop_enrollments")
}

model CulturalProject {
  id             String    @id @default(cuid())
  protocolId     String?
  name           String
  type           String
  description    String
  responsible    String
  startDate      DateTime?
  endDate        DateTime?
  budget         Float?
  currentStatus  String    @default("PLANNING")
  status         String    @default("ACTIVE")
  protocol       String? // Campo adicionado
  contact        Json? // Campo adicionado
  funding        Json? // Campo adicionado
  targetAudience String? // Público-alvo do projeto
  participants   Int? // Número de participantes esperados
  serviceId      String? // Campo adicionado
  source         String    @default("manual") // Origem do registro
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  protocolSimplified ProtocolSimplified? @relation("CulturalProjectProtocol", fields: [protocolId], references: [id])
  events             CulturalEvent[]

  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("cultural_projects")
}

model CulturalProjectSubmission {
  id             String    @id @default(cuid())
  protocolId     String?
  projectName    String
  projectType    String
  description    String
  responsible    String
  cpf            String
  phone          String
  email          String
  organization   String?
  budget         Float
  fundingSource  String?
  targetAudience String
  expectedImpact String
  startDate      DateTime?
  endDate        DateTime?
  attachments    Json?
  status         String    @default("UNDER_REVIEW")
  submittedAt    DateTime  @default(now())
  reviewedAt     DateTime?
  reviewComments String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  protocolSimplified ProtocolSimplified? @relation("CulturalProjectSubmissionProtocol", fields: [protocolId], references: [id])

  @@map("cultural_project_submissions")
}

model PublicSchool {
  id              String       @id @default(cuid())
  name            String
  code            String       @unique
  address         String
  principalName   String
  contact         String
  email           String?
  levels          Json?
  capacity        Int
  currentStudents Int          @default(0)
  status          String       @default("ACTIVE")
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  schoolCalls     SchoolCall[]

  @@map("public_schools")
}

model SchoolCall {
  id           String       @id @default(cuid())
  schoolId     String
  studentName  String
  parentName   String
  contact      String
  level        String
  reason       String
  status       String       @default("PENDING")
  callDate     DateTime     @default(now())
  resolvedDate DateTime?
  observations String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  school       PublicSchool @relation(fields: [schoolId], references: [id])

  @@map("school_calls")
}

model SportsAttendance {
  id                   String                 @id @default(cuid())
  protocolId           String?
  protocol             String                 @unique
  citizenId            String?
  citizenName          String
  contact              String
  type                 SportsAttendanceType
  serviceType          String?
  status               SportsAttendanceStatus @default(PENDING)
  description          String
  observations         String?
  responsible          String?
  referredTo           String?
  resolution           String?
  attachments          Json?
  sportType            String?
  sport                String?
  eventDate            DateTime?
  location             String?
  expectedParticipants Int?
  followUpNeeded       Boolean                @default(false)
  followUpDate         DateTime?
  priority             String                 @default("MEDIUM")
  serviceId            String? // Campo adicionado
  source               String                 @default("manual") // Campo adicionado
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt
  protocolSimplified   ProtocolSimplified?    @relation("SportsAttendanceProtocol", fields: [protocolId], references: [id])

  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("sports_attendances")
}

model SportsEvent {
  id                   String    @id @default(cuid())
  name                 String
  title                String?
  type                 String
  eventType            String?
  sport                String?
  description          String
  startDate            DateTime
  date                 DateTime?
  endDate              DateTime
  startTime            String?
  endTime              String?
  location             String
  capacity             Int?
  targetAudience       String?
  entryFee             Float?
  registrationRequired Boolean   @default(false)
  organizer            String?
  contact              Json?
  isPublic             Boolean   @default(true)
  responsible          String
  maxParticipants      Int
  currentParticipants  Int       @default(0)
  registrationFee      Float?    @default(0)
  status               String    @default("PLANNED")
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt

  @@map("sports_events")
}

model SportsClub {
  id             String    @id @default(cuid())
  name           String
  sport          String
  foundationDate DateTime?
  president      String
  contact        String
  address        String
  members        Json?
  status         String    @default("ACTIVE")
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@map("sports_clubs")
}

model HealthAttendance {
  id              String                 @id @default(cuid())
  protocolId      String?
  protocol        String                 @unique

  // ✅ REFATORADO - Vincula ao cidadão sem duplicação
  citizenId       String
  citizen         Citizen                @relation("HealthAttendanceCitizen", fields: [citizenId], references: [id])

  type            HealthAttendanceType
  status          HealthAttendanceStatus @default(PENDING)
  description     String
  observations    String?
  responsible     String?
  attachments     Json?
  urgency         String                 @default("NORMAL")
  medicalUnit     String?
  appointmentDate DateTime?
  symptoms        String?
  priority        String                 @default("MEDIUM")
  moduleType      String                 @default("ATENDIMENTOS_SAUDE")
  createdAt       DateTime               @default(now())
  updatedAt       DateTime               @updatedAt

  protocolSimplified ProtocolSimplified? @relation("HealthAttendanceProtocol", fields: [protocolId], references: [id])

  @@index([citizenId])
  @@index([moduleType])
  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@index([moduleType, status])
  @@map("health_attendances")
}

model MedicalAppointment {
  id              String    @id @default(cuid())
  protocolId      String?
  protocol        String    @unique

  // ✅ FASE 2 - citizenId obrigatório sem duplicação
  citizenId       String
  citizen         Citizen   @relation("MedicalAppointmentCitizen", fields: [citizenId], references: [id])

  // Dados da consulta
  specialty       String
  healthUnit      String?
  preferredDate   DateTime?
  preferredShift  String?
  appointmentDate DateTime?
  appointmentTime String?

  // Status e controle
  status          String    @default("pending")
  observations    String?
  cancellationReason String?

  // Rastreabilidade
  serviceId       String?
  source          String    @default("service")
  createdBy       String?
  moduleType      String    @default("AGENDAMENTOS_MEDICOS")
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  protocolSimplified ProtocolSimplified? @relation("MedicalAppointmentProtocol", fields: [protocolId], references: [id])

  @@index([citizenId])
  @@index([moduleType])
  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("medical_appointments")
}

model HealthUnit {
  id          String   @id @default(cuid())
  name        String
  type        String
  address     String
  contact     String
  manager     String
  specialties Json?
  capacity    Int
  status      String   @default("ACTIVE")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("health_units")
}

model VaccinationCampaign {
  id             String        @id @default(cuid())
  name           String
  vaccine        String
  targetGroup    String
  targetAudience String
  startDate      DateTime
  endDate        DateTime
  locations      Json?
  goal           Int?
  achieved       Int           @default(0)
  status         String        @default("PLANNED")
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  vaccinations   Vaccination[]

  @@map("vaccination_campaigns")
}

model CampaignEnrollment {
  id            String    @id @default(cuid())
  protocolId    String?
  protocol      String    @unique
  citizenId     String
  citizen       Citizen   @relation("CampaignEnrollmentCitizen", fields: [citizenId], references: [id])
  campaignId    String?
  status        String    @default("enrolled")
  observations  String?
  serviceId     String?
  source        String    @default("service")
  createdBy     String?
  moduleType    String    @default("PROGRAMAS_SAUDE")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  protocolSimplified ProtocolSimplified? @relation("CampaignEnrollmentProtocol", fields: [protocolId], references: [id])

  @@index([citizenId])
  @@index([moduleType])
  @@index([protocolId])
  @@index([status])
  @@map("campaign_enrollments")
}

model HomeCare {
  id            String    @id @default(cuid())
  protocolId    String?
  protocol      String    @unique
  citizenId     String
  citizen       Citizen   @relation("HomeCareCitizen", fields: [citizenId], references: [id])
  careType      String
  frequency     String?
  status        String    @default("pending")
  observations  String?
  serviceId     String?
  source        String    @default("service")
  createdBy     String?
  moduleType    String    @default("ATENDIMENTO_DOMICILIAR")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  protocolSimplified ProtocolSimplified? @relation("HomeCareProtocol", fields: [protocolId], references: [id])

  @@index([citizenId])
  @@index([moduleType])
  @@index([protocolId])
  @@index([status])
  @@map("home_cares")
}

model MedicationDispensing {
  id           String    @id @default(cuid())
  protocolId   String?
  patientId    String
  pharmacistId String?
  medication   String
  dosage       String
  quantity     Int
  dispensedAt  DateTime
  prescription Json?
  status       String    @default("dispensed")
  batchNumber  String?
  expiryDate   DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  patient      Citizen   @relation(fields: [patientId], references: [id])

  @@index([patientId])
  @@index([dispensedAt])
  @@index([medication])
  @@map("medication_dispensing")
}

model MedicationDispense {
  id              String    @id @default(cuid())
  protocolId      String?
  protocol        String    @unique
  citizenId       String
  citizen         Citizen   @relation("MedicationDispenseCitizen", fields: [citizenId], references: [id])
  medicationName  String
  dosage          String?
  quantity        Int       @default(1)
  prescriptionId  String?
  unitId          String?
  status          String    @default("pending")
  observations    String?
  serviceId       String?
  source          String    @default("service")
  createdBy       String?
  moduleType      String    @default("CONTROLE_MEDICAMENTOS")
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  protocolSimplified ProtocolSimplified? @relation("MedicationDispenseProtocol", fields: [protocolId], references: [id])

  @@index([citizenId])
  @@index([moduleType])
  @@index([protocolId])
  @@index([status])
  @@map("medication_dispenses")
}

model Vaccination {
  id         String    @id @default(cuid())
  protocolId String?
  campaignId String?
  patientId  String
  vaccine    String
  dose       String
  appliedAt  DateTime
  appliedBy  String
  lotNumber  String?
  nextDose   DateTime?
  moduleType String    @default("VACINACAO")
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  protocolSimplified ProtocolSimplified?  @relation("VaccinationProtocol", fields: [protocolId], references: [id])
  patient            Citizen              @relation(fields: [patientId], references: [id])
  campaign           VaccinationCampaign? @relation(fields: [campaignId], references: [id])

  @@index([patientId])
  @@index([appliedAt])
  @@index([vaccine])
  @@index([moduleType])
  @@index([protocolId])
  @@index([createdAt])
  @@map("vaccinations")
}

model VaccinationRecord {
  id              String    @id @default(cuid())
  protocolId      String?
  protocol        String    @unique

  // ✅ FASE 2 - citizenId obrigatório sem duplicação
  citizenId       String
  citizen         Citizen   @relation("VaccinationRecordCitizen", fields: [citizenId], references: [id])

  // Dados da vacinação
  vaccine         String
  dose            String?
  healthUnit      String?
  scheduledDate   DateTime?
  scheduledTime   String?

  // Status e controle
  status          String    @default("pending")
  observations    String?
  cancellationReason String?

  // Rastreabilidade
  serviceId       String?
  source          String    @default("service")
  createdBy       String?
  moduleType      String    @default("VACINACAO")
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  protocolSimplified ProtocolSimplified? @relation("VaccinationRecordProtocol", fields: [protocolId], references: [id])

  @@index([citizenId])
  @@index([moduleType])
  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("vaccination_records")
}

model CulturalSpace {
  id             String          @id @default(cuid())
  name           String
  code           String
  description    String
  type           String
  address        Json
  coordinates    Json?
  neighborhood   String
  zipCode        String
  capacity       Int
  area           Float?
  rooms          Json?
  infrastructure Json?
  equipment      Json?
  amenities      Json?
  accessibility  Boolean         @default(false)
  manager        String
  contact        Json
  operatingHours Json
  status         String          @default("active")
  available      Boolean         @default(true)
  isActive       Boolean         @default(true)
  hourlyRate     Float?
  dailyRate      Float?
  freeUse        Boolean         @default(false)
  photos         Json?
  documents      Json?
  observations   String?
  protocol       String? // Campo adicionado
  serviceId      String? // Campo adicionado
  source         String          @default("manual") // Campo adicionado
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  events         CulturalEvent[]

  @@unique([code])
  @@index([type])
  @@index([status])
  @@index([available])
  @@index([neighborhood])
  @@map("cultural_spaces")
}

model CulturalSpaceReservation {
  id             String    @id @default(cuid())
  protocolId     String?
  spaceId        String?
  spaceName      String
  requesterName  String
  cpf            String
  phone          String
  email          String?
  eventName      String
  eventType      String
  description    String
  startDate      DateTime
  endDate        DateTime
  startTime      String
  endTime        String
  expectedPeople Int
  needsEquipment Boolean   @default(false)
  equipment      Json?
  status         String    @default("PENDING")
  requestedAt    DateTime  @default(now())
  approvedAt     DateTime?
  observations   String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  protocolSimplified ProtocolSimplified? @relation("CulturalSpaceReservationProtocol", fields: [protocolId], references: [id])

  @@map("cultural_space_reservations")
}

model CulturalEvent {
  id             String    @id @default(cuid())
  protocolId     String?
  spaceId        String?
  projectId      String?
  title          String
  description    String
  category       String
  type           String
  startDate      DateTime
  endDate        DateTime
  schedule       Json
  duration       Int?
  venue          String
  address        Json?
  coordinates    Json?
  capacity       Int
  targetAudience String
  ageRating      String?
  ticketPrice    Float?
  freeEvent      Boolean   @default(true)
  organizer      Json
  producer       String?
  contact        Json
  performers     Json?
  guests         Json?
  requirements   Json?
  setup          Json?
  technical      Json?
  status         String    @default("planned")
  approved       Boolean   @default(false)
  approvedBy     String?
  approvedAt     DateTime?
  promotion      Json?
  media          Json?
  website        String?
  socialMedia    Json?
  attendance     Int?
  revenue        Float?
  expenses       Float?
  photos         Json?
  videos         Json?
  reviews        Json?
  observations   String?
  protocol       String? // Campo adicionado
  serviceId      String? // ID do serviço que criou
  source         String    @default("manual") // Origem do registro
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  protocolSimplified ProtocolSimplified? @relation("CulturalEventProtocol", fields: [protocolId], references: [id])
  project            CulturalProject?    @relation(fields: [projectId], references: [id])
  space              CulturalSpace?      @relation(fields: [spaceId], references: [id])

  @@index([category])
  @@index([status])
  @@index([startDate])
  @@index([spaceId])
  @@index([freeEvent])
  @@index([protocolId])
  @@index([createdAt])
  @@map("cultural_events")
}

model HousingAttendance {
  id                 String                  @id @default(cuid())
  protocolId         String?
  protocol           String                  @unique
  citizenId          String?
  citizenName        String
  citizenCPF         String
  contact            String
  type               HousingAttendanceType
  status             HousingAttendanceStatus @default(PENDING)
  description        String
  observations       String?
  responsible        String?
  attachments        Json?
  program            String?
  documents          Json?
  propertyAddress    String?
  familyIncome       Float?
  familySize         Int?
  currentHousing     String?
  priority           String                  @default("MEDIUM")
  createdAt          DateTime                @default(now())
  updatedAt          DateTime                @updatedAt
  citizen            Citizen?                @relation("HousingAttendanceCitizen", fields: [citizenId], references: [id])
  protocolSimplified ProtocolSimplified?     @relation("HousingAttendanceProtocol", fields: [protocolId], references: [id])

  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("housing_attendances")
}

model HousingProgram {
  id                  String                @id @default(cuid())
  name                String
  type                String
  description         String
  requirements        Json?
  eligibilityCriteria Json?
  benefits            Json?
  maxIncome           Float?
  targetIncome        String?
  availableUnits      Int                   @default(0)
  registeredFamilies  Int                   @default(0)
  startDate           DateTime?
  endDate             DateTime?
  status              String                @default("PLANNED")
  isActive            Boolean               @default(true)
  contact             Json?
  financingOptions    Json?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  registrations       HousingRegistration[]

  @@map("housing_programs")
}

model HousingRegistration {
  id                 String              @id @default(cuid())
  protocolId         String?
  programId          String
  familyHeadName     String
  familyHeadCPF      String
  contact            String
  address            String
  familyIncome       Float
  familySize         Int
  score              Float?
  status             String              @default("REGISTERED")
  registrationDate   DateTime            @default(now())
  selectedDate       DateTime?
  observations       String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  program            HousingProgram      @relation(fields: [programId], references: [id])
  protocolSimplified ProtocolSimplified? @relation("HousingRegistrationProtocol", fields: [protocolId], references: [id])

  @@map("housing_registrations")
}

model HealthAppointment {
  id               String    @id @default(cuid())
  protocolId       String?
  patientName      String
  patientCpf       String
  patientBirthDate DateTime?
  patientPhone     String?
  appointmentDate  DateTime
  appointmentTime  String
  doctorId         String?
  speciality       String    @default("GENERAL")
  priority         String    @default("NORMAL")
  status           String    @default("SCHEDULED")
  symptoms         String?
  observations     String?
  diagnosis        String?
  treatment        String?
  followUpDate     DateTime?
  moduleType       String    @default("AGENDAMENTOS_MEDICOS")
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  protocolSimplified ProtocolSimplified? @relation("HealthAppointmentProtocol", fields: [protocolId], references: [id])
  doctor             HealthDoctor?       @relation(fields: [doctorId], references: [id])

  @@index([moduleType])
  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@index([moduleType, status])
  @@map("health_appointments")
}

model HealthDoctor {
  id           String              @id @default(cuid())
  name         String
  crm          String
  speciality   String
  phone        String?
  email        String?
  isActive     Boolean             @default(true)
  schedule     Json?
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  appointments HealthAppointment[]

  @@unique([crm])
  @@map("health_doctors")
}

model MedicalSpecialty {
  id                  String               @id @default(cuid())
  name                String
  code                String
  description         String?
  isActive            Boolean              @default(true)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  healthProfessionals HealthProfessional[]

  @@unique([code])
  @@map("medical_specialties")
}

model HealthProfessional {
  id          String           @id @default(cuid())
  name        String
  crm         String?
  specialtyId String
  phone       String?
  email       String?
  schedule    Json?
  isActive    Boolean          @default(true)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  specialty   MedicalSpecialty @relation(fields: [specialtyId], references: [id])

  @@unique([crm])
  @@map("health_professionals")
}

model Medication {
  id               String    @id @default(cuid())
  name             String
  activeIngredient String
  category         String
  dosage           String?
  currentStock     Int       @default(0)
  minimumStock     Int       @default(10)
  unitPrice        Float?
  supplier         String?
  expirationDate   DateTime?
  isActive         Boolean   @default(true)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  @@map("medications")
}

model VulnerableFamily {
  id                String              @id @default(cuid())
  protocolId        String?
  citizenId         String              @unique
  familyCode        String?
  responsibleName   String?
  memberCount       Int
  monthlyIncome     Float?
  riskLevel         String              @default("LOW")
  vulnerabilityType String
  socialWorker      String?
  status            String              @default("ACTIVE")
  observations      String?
  lastVisitDate     DateTime?
  nextVisitDate     DateTime?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  benefitRequests   BenefitRequest[]
  homeVisits        HomeVisit[]
  citizen           Citizen             @relation(fields: [citizenId], references: [id], onDelete: Cascade)
  protocol          ProtocolSimplified? @relation("VulnerableFamilyProtocol", fields: [protocolId], references: [id])

  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("vulnerable_families")
}

model BenefitRequest {
  id                String              @id @default(cuid())
  protocolId        String?
  familyId          String
  benefitType       String
  requestDate       DateTime            @default(now())
  status            String              @default("PENDING")
  urgency           String              @default("NORMAL")
  reason            String
  documentsProvided Json?
  approvedBy        String?
  approvedDate      DateTime?
  deliveredDate     DateTime?
  observations      String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  family            VulnerableFamily    @relation(fields: [familyId], references: [id])
  deliveries        EmergencyDelivery[]
  protocol          ProtocolSimplified? @relation("BenefitRequestProtocol", fields: [protocolId], references: [id])

  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("benefit_requests")
}

model EmergencyDelivery {
  id                 String              @id @default(cuid())
  protocolId         String?
  benefitRequestId   String?
  citizenId          String?
  deliveryType       String
  quantity           Int                 @default(1)
  deliveryDate       DateTime
  recipientName      String
  recipientSignature String?
  deliveredBy        String
  urgency            String?
  status             String              @default("PENDING")
  observations       String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  citizen            Citizen?            @relation("EmergencyDeliveryCitizen", fields: [citizenId], references: [id])
  benefitRequest     BenefitRequest?     @relation(fields: [benefitRequestId], references: [id])
  protocol           ProtocolSimplified? @relation("EmergencyDeliveryProtocol", fields: [protocolId], references: [id])

  @@map("emergency_deliveries")
}

model HomeVisit {
  id               String              @id @default(cuid())
  protocolId       String?
  familyId         String
  socialWorkerId   String?
  visitDate        DateTime
  socialWorker     String
  visitType        String              @default("ROUTINE")
  visitPurpose     String
  purpose          String?
  findings         String?
  recommendations  String?
  nextVisitDate    DateTime?
  status           String              @default("SCHEDULED")
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  socialWorkerUser User?               @relation("HomeVisitSocialWorker", fields: [socialWorkerId], references: [id])
  family           VulnerableFamily    @relation(fields: [familyId], references: [id])
  protocol         ProtocolSimplified? @relation("HomeVisitProtocol", fields: [protocolId], references: [id])

  @@map("home_visits")
}

model PublicWork {
  id              String              @id @default(cuid())
  protocolId      String?
  title           String
  description     String
  workType        String
  location        String
  coordinates     Json?
  contractor      String?
  startDate       DateTime?
  endDate         DateTime?
  plannedBudget   Float?
  actualBudget    Float?
  budget          Json?
  progressPercent Int                 @default(0)
  status          String              @default("PLANNED")
  priority        String              @default("MEDIUM")
  beneficiaries   Int?
  photos          Json?
  documents       Json?
  timeline        Json?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  protocol        ProtocolSimplified? @relation("PublicWorkProtocol", fields: [protocolId], references: [id])

  @@map("public_works")
}

model School {
  id            String        @id @default(cuid())
  name          String
  code          String
  address       String
  phone         String?
  email         String?
  principalName String
  capacity      Int
  type          String
  shift         String
  isActive      Boolean       @default(true)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  classes       SchoolClass[]
  events        SchoolEvent[]
  schoolMeals   SchoolMeal[]
  students      Student[]

  @@unique([code])
  @@index([createdAt])
  @@map("schools")
}

model Student {
  id          String              @id @default(cuid())
  protocolId  String?
  name        String
  birthDate   DateTime
  cpf         String?
  rg          String?
  parentName  String
  parentPhone String
  parentEmail String?
  address     String
  medicalInfo Json?
  isActive    Boolean             @default(true)
  moduleType  String              @default("MATRICULA_ALUNO")
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  schoolId    String
  incidents   SchoolIncident[]
  attendances StudentAttendance[]
  enrollments StudentEnrollment[]
  school      School              @relation(fields: [schoolId], references: [id])
  protocol    ProtocolSimplified? @relation("StudentProtocol", fields: [protocolId], references: [id])

  @@unique([cpf])
  @@index([moduleType])
  @@index([protocolId])
  @@index([createdAt])
  @@map("students")
}

model SchoolClass {
  id          String              @id @default(cuid())
  name        String
  schoolId    String
  grade       String
  shift       String
  maxStudents Int
  year        Int
  isActive    Boolean             @default(true)
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  school      School              @relation(fields: [schoolId], references: [id])
  incidents   SchoolIncident[]
  attendances StudentAttendance[]
  enrollments StudentEnrollment[]

  @@map("school_classes")
}

model StudentEnrollment {
  id             String      @id @default(cuid())
  studentId      String
  classId        String
  schoolId       String?
  grade          String?
  year           Int
  status         String      @default("ativo")
  enrollmentDate DateTime    @default(now())
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  class          SchoolClass @relation(fields: [classId], references: [id])
  student        Student     @relation(fields: [studentId], references: [id])

  @@unique([studentId, classId, year])
  @@index([status])
  @@index([createdAt])
  @@map("student_enrollments")
}

model StudentEnrollmentRequest {
  id              String    @id @default(cuid())
  protocolId      String?
  protocol        String    @unique
  citizenId       String
  citizen         Citizen   @relation("StudentEnrollmentCitizen", fields: [citizenId], references: [id])
  studentName     String
  studentBirthDate DateTime
  studentCpf      String?
  schoolId        String?
  schoolName      String?
  grade           String
  shift           String?
  year            Int
  status          String    @default("pending")
  observations    String?
  serviceId       String?
  source          String    @default("service")
  createdBy       String?
  moduleType      String    @default("MATRICULA_ALUNO")
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  protocolSimplified ProtocolSimplified? @relation("StudentEnrollmentRequestProtocol", fields: [protocolId], references: [id])

  @@index([citizenId])
  @@index([moduleType])
  @@index([protocolId])
  @@index([status])
  @@map("student_enrollment_requests")
}

// ============================================================================
// FASE 2 - EDUCAÇÃO: SOLICITAÇÕES DE SERVIÇOS
// ============================================================================

model SchoolTransportRequest {
  id              String    @id @default(cuid())
  protocolId      String?
  protocol        String    @unique
  citizenId       String
  citizen         Citizen   @relation("SchoolTransportRequestCitizen", fields: [citizenId], references: [id])
  studentName     String
  studentCpf      String?
  studentBirthDate DateTime?
  route           String?
  shift           String
  pickupAddress   String
  status          String    @default("pending")
  observations    String?
  serviceId       String?
  source          String    @default("service")
  createdBy       String
  moduleType      String    @default("TRANSPORTE_ESCOLAR_SOLICITACAO")
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  protocolSimplified ProtocolSimplified? @relation("SchoolTransportRequestProtocol", fields: [protocolId], references: [id])

  @@index([citizenId])
  @@index([moduleType])
  @@index([protocolId])
  @@index([status])
  @@map("school_transport_requests")
}

model SchoolMealRequest {
  id              String    @id @default(cuid())
  protocolId      String?
  protocol        String    @unique
  citizenId       String
  citizen         Citizen   @relation("SchoolMealRequestCitizen", fields: [citizenId], references: [id])
  studentName     String
  studentCpf      String?
  shift           String
  dietType        String
  restrictions    String?
  medicalCert     String?
  status          String    @default("pending")
  observations    String?
  serviceId       String?
  source          String    @default("service")
  createdBy       String
  moduleType      String    @default("MERENDA_DIETA_ESPECIAL")
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  protocolSimplified ProtocolSimplified? @relation("SchoolMealRequestProtocol", fields: [protocolId], references: [id])

  @@index([citizenId])
  @@index([moduleType])
  @@index([protocolId])
  @@index([status])
  @@map("school_meal_requests")
}

model SchoolTransferRequest {
  id              String    @id @default(cuid())
  protocolId      String?
  protocol        String    @unique
  citizenId       String
  citizen         Citizen   @relation("SchoolTransferRequestCitizen", fields: [citizenId], references: [id])
  studentName     String
  studentCpf      String?
  currentSchool   String?
  targetSchool    String?
  targetSchoolName String
  grade           String
  reason          String
  documents       String?
  status          String    @default("pending")
  observations    String?
  serviceId       String?
  source          String    @default("service")
  createdBy       String
  moduleType      String    @default("TRANSFERENCIA_ESCOLAR")
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  protocolSimplified ProtocolSimplified? @relation("SchoolTransferRequestProtocol", fields: [protocolId], references: [id])

  @@index([citizenId])
  @@index([moduleType])
  @@index([protocolId])
  @@index([status])
  @@map("school_transfer_requests")
}

model SchoolMaterialRequest {
  id              String    @id @default(cuid())
  protocolId      String?
  protocol        String    @unique
  citizenId       String
  citizen         Citizen   @relation("SchoolMaterialRequestCitizen", fields: [citizenId], references: [id])
  studentName     String
  studentCpf      String?
  grade           String
  schoolId        String?
  items           Json      @default("[]")
  quantity        Int       @default(1)
  status          String    @default("pending")
  observations    String?
  serviceId       String?
  source          String    @default("service")
  createdBy       String
  moduleType      String    @default("MATERIAL_ESCOLAR")
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  protocolSimplified ProtocolSimplified? @relation("SchoolMaterialRequestProtocol", fields: [protocolId], references: [id])

  @@index([citizenId])
  @@index([moduleType])
  @@index([protocolId])
  @@index([status])
  @@map("school_material_requests")
}

model StudentAttendance {
  id            String      @id @default(cuid())
  studentId     String
  classId       String
  date          DateTime
  present       Boolean
  justification String?
  createdAt     DateTime    @default(now())
  class         SchoolClass @relation(fields: [classId], references: [id])
  student       Student     @relation(fields: [studentId], references: [id])

  @@unique([studentId, classId, date])
  @@map("student_attendances")
}

model SchoolTransport {
  id         String              @id @default(cuid())
  protocolId String?
  route      String
  driver     String
  vehicle    String
  capacity   Int
  shift      String
  stops      Json?
  isActive   Boolean             @default(true)
  moduleType String              @default("TRANSPORTE_ESCOLAR")
  createdAt  DateTime            @default(now())
  updatedAt  DateTime            @updatedAt
  protocol   ProtocolSimplified? @relation("SchoolTransportProtocol", fields: [protocolId], references: [id])

  @@index([moduleType])
  @@index([protocolId])
  @@map("school_transports")
}

model SchoolMeal {
  id             String              @id @default(cuid())
  protocolId     String?
  schoolId       String?
  date           DateTime
  shift          String
  menu           Json
  studentsServed Int                 @default(0)
  cost           Float?
  moduleType     String              @default("GESTAO_MERENDA")
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  school         School?             @relation(fields: [schoolId], references: [id])
  protocol       ProtocolSimplified? @relation("SchoolMealProtocol", fields: [protocolId], references: [id])

  @@index([moduleType])
  @@index([protocolId])
  @@map("school_meals")
}

model SchoolIncident {
  id             String      @id @default(cuid())
  studentId      String
  classId        String
  type           String
  description    String
  severity       String      @default("media")
  actionTaken    String?
  parentNotified Boolean     @default(false)
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  class          SchoolClass @relation(fields: [classId], references: [id])
  student        Student     @relation(fields: [studentId], references: [id])

  @@map("school_incidents")
}

model SchoolEvent {
  id          String   @id @default(cuid())
  name        String
  title       String
  description String?
  date        DateTime
  startTime   String?
  endTime     String?
  type        String
  schoolId    String?
  isHoliday   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  school      School?  @relation(fields: [schoolId], references: [id])

  @@map("school_events")
}

model EducationAttendance {
  id                 String              @id @default(cuid())
  protocolId         String?

  // ✅ REFATORADO - citizenId obrigatório sem duplicação
  citizenId          String
  citizen            Citizen             @relation("EducationAttendanceCitizen", fields: [citizenId], references: [id])

  // Tipo de atendimento
  attendanceType     String?
  category           String?
  serviceType        String

  // Dados do estudante (dados adicionais, não do cidadão)
  studentName        String?
  studentCpf         String?
  studentBirthDate   DateTime?
  studentRelationship String?

  // Escola
  schoolId           String?
  schoolName         String?
  grade              String?
  shift              String?

  // Solicitação
  subject            String?
  description        String
  requestedServices  Json?

  // Prioridade e urgência
  priority           String              @default("NORMAL")
  urgency            String?

  // Anexos
  hasDocuments       Boolean             @default(false)
  attachments        Json?

  // Status
  status             String              @default("PENDING")
  isActive           Boolean             @default(false)

  // Responsável
  assignedToId       String?
  assignedToName     String?

  // Datas
  scheduledDate      DateTime?
  completedDate      DateTime?
  startedAt          DateTime?

  observations       String?
  moduleType         String              @default("ATENDIMENTOS_EDUCACAO")
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt

  protocol           ProtocolSimplified? @relation("EducationAttendanceProtocol", fields: [protocolId], references: [id])

  @@index([moduleType])
  @@index([protocolId])
  @@index([citizenId])
  @@map("education_attendances")
}

model SchoolDocument {
  id                      String              @id @default(cuid())
  protocolId              String?
  citizenId               String              // ✅ OBRIGATÓRIO - vincula ao cidadão solicitante

  // Dados do solicitante
  requestorName           String?
  requestorCpf            String?
  requestorPhone          String?
  requestorEmail          String?

  // Dados do estudante
  studentId               String?
  studentName             String
  studentCpf              String?
  studentBirthDate        DateTime?
  relationshipToStudent   String?

  // Escola
  schoolId                String?
  schoolName              String?
  lastGrade               String?
  lastYear                Int?

  // Tipo de documento
  documentType            String
  documentSubtype         String?

  // Quantidade
  copies                  Int                 @default(1)

  // Finalidade
  purpose                 String?
  purposeDetails          String?

  // Período/anos solicitados
  requestedYears          Json?
  requestedPeriods        Json?

  // Entrega
  deliveryMethod          String?
  deliveryAddress         String?
  pickupPersonName        String?
  pickupPersonCpf         String?
  pickupPersonRelationship String?

  // Urgência
  isUrgent                Boolean             @default(false)
  urgencyReason           String?
  expectedDeliveryDate    DateTime?

  // Taxa
  hasFee                  Boolean             @default(false)
  feeAmount               Float               @default(0)
  feeStatus               String?

  // Datas
  issueDate               DateTime            @default(now())
  validUntil              DateTime?
  approvedAt              DateTime?

  // Status
  status                  String              @default("PENDING")
  isActive                Boolean             @default(false)

  // Arquivo
  fileUrl                 String?

  observations            String?
  internalNotes           String?
  moduleType              String              @default("SOLICITACAO_DOCUMENTO_ESCOLAR")
  createdAt               DateTime            @default(now())
  updatedAt               DateTime            @updatedAt

  protocol                ProtocolSimplified? @relation("SchoolDocumentProtocol", fields: [protocolId], references: [id])
  citizen                 Citizen             @relation("SchoolDocumentCitizen", fields: [citizenId], references: [id])

  @@index([moduleType])
  @@index([protocolId])
  @@index([citizenId])
  @@map("school_documents")
}

model StudentTransfer {
  id             String              @id @default(cuid())
  protocolId     String?
  studentId      String?
  studentName    String
  currentSchool  String
  targetSchool   String
  grade          String
  transferReason String
  requestDate    DateTime            @default(now())
  transferDate   DateTime?
  status         String              @default("PENDING")
  documents      Json?
  observations   String?
  approvedBy     String?
  moduleType     String              @default("TRANSFERENCIA_ESCOLAR")
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  protocol       ProtocolSimplified? @relation("StudentTransferProtocol", fields: [protocolId], references: [id])

  @@index([moduleType])
  @@index([protocolId])
  @@map("student_transfers")
}

model AttendanceRecord {
  id                       String              @id @default(cuid())
  protocolId               String?

  // ✅ JÁ ESTAVA CORRETO - citizenId obrigatório
  citizenId                String
  citizen                  Citizen             @relation("AttendanceRecordCitizen", fields: [citizenId], references: [id])

  // Dados do estudante (pode ser diferente do cidadão solicitante)
  studentId                String?
  studentName              String
  studentCpf               String?
  schoolId                 String?
  schoolName               String?
  classId                  String?
  className                String?
  grade                    String?
  shift                    String?

  // Período
  periodType               String?             // MONTHLY, BIMESTER, etc
  referenceMonth           Int?
  referenceYear            Int?
  month                    Int
  year                     Int
  startDate                DateTime?
  endDate                  DateTime?

  // Estatísticas
  totalDays                Int
  presentDays              Int
  absentDays               Int
  justifiedAbsences        Int                 @default(0)
  unjustifiedAbsences      Int                 @default(0)
  percentage               Float
  attendancePercentage     Float?

  // Detalhes
  absenceDetails           Json?

  // Alertas
  hasLowAttendance         Boolean             @default(false)
  lowAttendanceThreshold   Float?
  requiresIntervention     Boolean             @default(false)

  // Ações
  parentNotified           Boolean             @default(false)
  parentNotificationDate   DateTime?
  interventionPlan         String?

  // Responsável
  requestedById            String?
  requestedByName          String?
  requestedByRole          String?

  // Status e observações
  status                   String              @default("ACTIVE")
  isActive                 Boolean             @default(false)
  processedAt              DateTime?
  observations             String?
  teacherNotes             String?

  moduleType               String              @default("CONSULTA_FREQUENCIA")
  createdAt                DateTime            @default(now())
  updatedAt                DateTime            @updatedAt

  protocol                 ProtocolSimplified? @relation("AttendanceRecordProtocol", fields: [protocolId], references: [id])

  @@index([moduleType])
  @@index([protocolId])
  @@index([citizenId])
  @@index([status])
  @@index([createdAt])
  @@index([moduleType, status])
  @@map("attendance_records")
}

model GradeRecord {
  id                        String              @id @default(cuid())
  protocolId                String?

  // ✅ JÁ ESTAVA CORRETO - citizenId obrigatório
  citizenId                 String
  citizen                   Citizen             @relation("GradeRecordCitizen", fields: [citizenId], references: [id])

  // Dados do estudante (pode ser diferente do cidadão solicitante)
  studentId                 String?
  studentName               String
  studentCpf                String?

  // Escola e turma
  schoolId                  String?
  schoolName                String?
  classId                   String?
  className                 String?
  gradeLevel                String?             // Série/ano escolar (ex: "5º ano")
  shift                     String?

  // Período
  periodType                String?             // BIMESTER, TRIMESTER, SEMESTER, ANNUAL
  periodNumber              Int?
  academicYear              Int?
  period                    String
  subject                   String

  // Notas (manter compatibilidade com modelo antigo)
  grade                     Float               // Nota numérica
  maxGrade                  Float               @default(10)

  // Disciplinas e notas detalhadas
  subjects                  Json?               // Array com todas as matérias

  // Estatísticas gerais
  totalSubjects             Int                 @default(0)
  averageGrade              Float?
  passedSubjects            Int                 @default(0)
  failedSubjects            Int                 @default(0)
  passingGrade              Float               @default(6.0)

  // Status do estudante
  studentStatus             String?
  isApproved                Boolean             @default(false)
  hasRecovery               Boolean             @default(false)
  recoverySubjects          Json?

  // Frequência relacionada
  overallAttendancePercentage Float?

  // Observações
  teacherComments           String?
  councilComments           String?
  teacherName               String?

  // Responsável pela consulta
  requestedById             String?
  requestedByName           String?
  requestedByRole           String?

  // Status
  status                    String              @default("APPROVED")
  isActive                  Boolean             @default(false)
  processedAt               DateTime?

  observations              String?
  internalNotes             String?
  createdAt                 DateTime            @default(now())
  updatedAt                 DateTime            @updatedAt

  protocol                  ProtocolSimplified? @relation("GradeRecordProtocol", fields: [protocolId], references: [id])

  @@index([protocolId])
  @@index([citizenId])
  @@index([status])
  @@index([createdAt])
  @@map("grade_records")
}

model SchoolManagement {
  id                        String              @id @default(cuid())
  protocolId                String?

  // ✅ REFATORADO - citizenId obrigatório sem duplicação
  citizenId                 String
  citizen                   Citizen             @relation("SchoolManagementCitizen", fields: [citizenId], references: [id])

  // Tipo de solicitação/gestão
  requestType               String?
  category                  String?
  managementType            String

  // Escola
  schoolId                  String?
  schoolName                String
  schoolType                String?

  // Assunto
  subject                   String?
  description               String

  // Área de gestão
  managementArea            String?

  // Dados específicos
  affectedPeople            Int                 @default(0)
  affectedClasses           Int                 @default(0)
  estimatedBudget           Float               @default(0)
  proposedSolution          String?

  // Recursos necessários
  requiresEquipment         Boolean             @default(false)
  requiredEquipment         Json?
  requiresStaff             Boolean             @default(false)
  requiredStaffType         String?
  requiresInfrastructure    Boolean             @default(false)
  infrastructureDetails     String?

  // Prioridade e urgência
  priority                  String              @default("NORMAL")
  urgencyLevel              String?
  expectedImplementationDate DateTime?

  // Justificativa
  justification             String?

  // Aprovações
  requiresSecretaryApproval Boolean             @default(false)
  requiresBudgetApproval    Boolean             @default(false)
  requiresCouncilApproval   Boolean             @default(false)

  // Documentação
  hasAttachments            Boolean             @default(false)
  attachments               Json?
  documents                 Json?

  // Status
  status                    String              @default("PENDING")
  isActive                  Boolean             @default(false)
  approvedAt                DateTime?

  // Responsável
  assignedToId              String?
  assignedToName            String?
  assignedTo                String?

  // Datas
  requestDate               DateTime            @default(now())
  completedDate             DateTime?

  observations              String?
  internalNotes             String?
  createdAt                 DateTime            @default(now())
  updatedAt                 DateTime            @updatedAt

  protocol                  ProtocolSimplified? @relation("SchoolManagementProtocol", fields: [protocolId], references: [id])

  @@index([citizenId])
  @@map("school_management")
}

model Athlete {
  id                 String              @id @default(cuid())
  protocolId         String?
  name               String
  birthDate          DateTime
  cpf                String?
  rg                 String?
  email              String?
  phone              String?
  address            String?
  sport              String
  category           String
  team               String?
  teamId             String?
  position           String?
  medicalInfo        Json?
  emergencyContact   Json?
  federationNumber   String?
  federationExpiry   DateTime?
  medicalCertificate Json?
  modalityId         String?
  isActive           Boolean             @default(true)
  protocol           String? // Campo adicionado
  serviceId          String? // Campo adicionado
  source             String              @default("manual") // Campo adicionado
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  modality           SportsModality?     @relation(fields: [modalityId], references: [id])
  protocolSimplified ProtocolSimplified? @relation("AthleteProtocol", fields: [protocolId], references: [id])

  @@unique([cpf])
  @@index([protocolId])
  @@index([createdAt])
  @@map("athletes")
}

model TouristAttraction {
  id            String              @id @default(cuid())
  protocolId    String?
  name          String
  type          String
  category      String?
  description   String
  address       String
  neighborhood  String?
  coordinates   Json?
  openingHours  String?
  ticketPrice   Float?
  accessibility Json?
  amenities     Json?
  images        Json?
  rating        Float?
  featured      Boolean             @default(false)
  isActive      Boolean             @default(true)
  freeEntry     Boolean             @default(false)
  protocol      String?
  city          String?
  serviceId     String?
  state         String?
  facilities    Json?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  protocolRel   ProtocolSimplified? @relation("TouristAttractionProtocol", fields: [protocolId], references: [id])

  @@index([protocolId])
  @@index([createdAt])
  @@map("tourist_attractions")
}

model HealthTransport {
  id                     String              @id @default(cuid())
  protocolId             String?

  // ✅ REFATORADO - citizenId obrigatório sem duplicação
  citizenId              String
  citizen                Citizen             @relation("HealthTransportCitizen", fields: [citizenId], references: [id])

  // Dados do transporte
  transportType          String
  transportDate          DateTime?
  transportTime          String?
  scheduledDate          DateTime

  // Origem e Destino
  origin                 String
  originAddress          String?
  originNeighborhood     String?
  originReference        String?

  destination            String
  destinationType        String?
  destinationAddress     String?
  destinationName        String?
  destinationCity        String?

  // Motivo e detalhes médicos
  reason                 String?
  urgencyLevel           String
  medicalCondition       String?
  requiresOxygen         Boolean             @default(false)
  requiresStretcher      Boolean             @default(false)
  requiresWheelchair     Boolean             @default(false)

  // Acompanhante
  hasCompanion           Boolean             @default(false)
  companionName          String?
  companionPhone         String?

  // Status
  status                 String              @default("SCHEDULED")
  isActive               Boolean             @default(false)
  confirmedAt            DateTime?

  // Observações
  observations           String?
  specialInstructions    String?

  // Responsável
  responsibleDriver      String?
  vehicleId              String?

  moduleType             String              @default("TRANSPORTE_PACIENTES")
  createdAt              DateTime            @default(now())
  updatedAt              DateTime            @updatedAt

  protocol               ProtocolSimplified? @relation("HealthTransportProtocol", fields: [protocolId], references: [id])

  @@index([moduleType])
  @@index([protocolId])
  @@index([citizenId])
  @@map("health_transports")
}

model HealthCampaign {
  id              String   @id @default(cuid())
  protocolId      String?
  name            String
  description     String
  campaignType    String
  startDate       DateTime
  endDate         DateTime
  targetAudience  String
  goals           Json
  status          String   @default("ACTIVE")
  isActive        Boolean  @default(true)
  coordinatorName String
  budget          Float?
  results         Json?
  moduleType      String   @default("CAMPANHAS_SAUDE")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  protocolSimplified ProtocolSimplified?  @relation("HealthCampaignProtocol", fields: [protocolId], references: [id])

  @@index([moduleType])
  @@index([protocolId])
  @@map("health_campaigns")
}

// Novos models de Saúde (conforme PLANO_IMPLEMENTACAO_SIMPLIFICACAO.md)
model HealthProgram {
  id              String    @id @default(cuid())
  protocolId      String?
  name            String
  description     String
  programType     String // HIPERDIA, SAUDE_MENTAL, PRENATAL, etc
  targetAudience  String
  coordinatorName String
  startDate       DateTime
  endDate         DateTime?
  status          String    @default("ACTIVE")
  goals           Json?
  participants    Int       @default(0)
  budget          Float?
  observations    String?
  moduleType      String    @default("PROGRAMAS_SAUDE")
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  protocol ProtocolSimplified? @relation("HealthProgramProtocol", fields: [protocolId], references: [id])

  @@index([moduleType])
  @@index([protocolId])
  @@map("health_programs")
}

model HealthExam {
  id            String    @id @default(cuid())
  protocolId    String?
  patientName   String
  patientCpf    String
  patientPhone  String?
  examType      String
  examName      String
  requestDate   DateTime  @default(now())
  scheduledDate DateTime?
  resultDate    DateTime?
  status        String    @default("REQUESTED") // REQUESTED, SCHEDULED, COMPLETED, CANCELLED
  priority      String    @default("NORMAL")
  requestedBy   String // Médico solicitante
  healthUnit    String?
  observations  String?
  result        String?
  attachments   Json?
  moduleType    String    @default("EXAMES")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  protocol ProtocolSimplified? @relation("HealthExamProtocol", fields: [protocolId], references: [id])

  @@index([moduleType])
  @@index([protocolId])
  @@map("health_exams")
}

model MedicalExam {
  id            String    @id @default(cuid())
  protocolId    String?
  protocol      String    @unique
  citizenId     String
  citizen       Citizen   @relation("MedicalExamCitizen", fields: [citizenId], references: [id])
  examType      String
  healthUnit    String?
  status        String    @default("pending")
  observations  String?
  serviceId     String?
  source        String    @default("service")
  createdBy     String?
  moduleType    String    @default("EXAMES")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  protocolSimplified ProtocolSimplified? @relation("MedicalExamProtocol", fields: [protocolId], references: [id])

  @@index([citizenId])
  @@index([moduleType])
  @@index([protocolId])
  @@index([status])
  @@map("medical_exams")
}

model HealthTransportRequest {
  id                     String              @id @default(cuid())
  protocolId             String?

  // ✅ REFATORADO - citizenId obrigatório sem duplicação
  citizenId              String
  citizen                Citizen             @relation("HealthTransportRequestCitizen", fields: [citizenId], references: [id])

  // Dados do encaminhamento TFD
  requestType            String?
  specialty              String?
  referringDoctor        String?
  referringUnit          String?
  destinationCity        String?
  destinationState       String?
  destinationHospital    String?

  // Detalhes médicos
  diagnosis              String?
  medicalJustification   String?
  urgencyLevel           String              @default("NORMAL")

  // Documentação
  hasMedicalReport       Boolean             @default(false)
  hasExams               Boolean             @default(false)
  hasReferral            Boolean             @default(true)

  // Acompanhante
  needsCompanion         Boolean             @default(false)
  companionName          String?
  companionCpf           String?
  companionRelationship  String?

  // Data prevista
  expectedDate           DateTime?

  // Campos de transporte
  origin                 String
  destination            String
  transportType          String
  requestDate            DateTime            @default(now())
  scheduledDate          DateTime?
  reason                 String
  responsibleDriver      String?
  vehicleId              String?
  departureTime          DateTime?
  arrivalTime            DateTime?

  // Status
  status                 String              @default("REQUESTED")
  isActive               Boolean             @default(false)
  approvedAt             DateTime?

  observations           String?
  moduleType             String              @default("ENCAMINHAMENTOS_TFD")
  createdAt              DateTime            @default(now())
  updatedAt              DateTime            @updatedAt

  protocol               ProtocolSimplified? @relation("HealthTransportRequestProtocol", fields: [protocolId], references: [id])

  @@index([moduleType])
  @@index([protocolId])
  @@index([citizenId])
  @@map("health_transport_requests")
}

model Patient {
  id                      String              @id @default(cuid())
  protocolId              String?

  // ✅ REFATORADO - citizenId obrigatório sem duplicação
  citizenId               String
  citizen                 Citizen             @relation("PatientCitizen", fields: [citizenId], references: [id])

  // Dados específicos de saúde (não duplicar dados pessoais do Citizen)
  bloodType               String?

  // Cartão SUS
  susCardNumber           String?

  // Contato de emergência
  emergencyContactName    String?
  emergencyContactPhone   String?
  emergencyContactRelationship String?

  // Dados de saúde específicos
  allergies               String?
  chronicDiseases         String?
  currentMedications      String?
  previousSurgeries       String?

  // Unidade de saúde preferencial
  preferredHealthUnitId   String?

  // Grupos de risco
  isPregnant              Boolean             @default(false)
  isDiabetic              Boolean             @default(false)
  isHypertensive          Boolean             @default(false)
  hasHeartDisease         Boolean             @default(false)
  hasRespiratoryDisease   Boolean             @default(false)

  // Status
  status                  String              @default("PENDING_APPROVAL")
  isActive                Boolean             @default(false)
  approvedAt              DateTime?

  observations            String?
  registeredBy            String
  registrationDate        DateTime            @default(now())
  moduleType              String              @default("CADASTRO_PACIENTE")
  createdAt               DateTime            @default(now())
  updatedAt               DateTime            @updatedAt

  protocol                ProtocolSimplified? @relation("PatientProtocol", fields: [protocolId], references: [id])

  @@index([moduleType])
  @@index([protocolId])
  @@index([citizenId])
  @@index([status])
  @@index([createdAt])
  @@index([moduleType, status])
  @@map("patients")
}

model CommunityHealthAgent {
  id                    String              @id @default(cuid())
  protocolId            String?

  // ✅ REFATORADO - citizenId obrigatório sem duplicação
  citizenId             String
  citizen               Citizen             @relation("ACSCitizen", fields: [citizenId], references: [id])

  // Dados profissionais
  registrationNumber    String?
  hireDate              DateTime
  contractType          String?

  // Unidade de Saúde
  healthUnitId          String?
  healthUnitName        String?

  // Área de atuação
  assignedArea          String
  neighborhoods         Json?
  microarea             String?
  estimatedFamilies     Int                 @default(0)
  estimatedPeople       Int                 @default(0)

  // Formação e capacitação
  education             String?
  hasCourseCompletion   Boolean             @default(false)
  courseCompletionDate  DateTime?
  additionalTraining    String?

  // Dados de trabalho
  workSchedule          Json?
  weeklyHours           Int                 @default(40)
  workDays              String?

  // Equipamentos
  hasTablet             Boolean             @default(false)
  hasUniform            Boolean             @default(false)
  hasBag                Boolean             @default(false)
  hasIdentificationCard Boolean             @default(false)

  // Supervisor
  supervisorId          String?
  supervisorName        String?

  // Estatísticas
  familiesServed        Int                 @default(0)

  // Status
  status                String              @default("ACTIVE")
  isActive              Boolean             @default(false)
  approvedAt            DateTime?
  terminationDate       DateTime?

  observations          String?
  moduleType            String              @default("GESTAO_ACS")
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt

  protocol              ProtocolSimplified? @relation("CommunityHealthAgentProtocol", fields: [protocolId], references: [id])

  @@index([moduleType])
  @@index([protocolId])
  @@index([citizenId])
  @@map("community_health_agents")
}

model DisciplinaryRecord {
  id                      String              @id @default(cuid())
  protocolId              String?
  citizenId               String              // ✅ OBRIGATÓRIO - vincula ao responsável

  // Dados do estudante
  studentId               String
  studentName             String?
  studentCpf              String?
  studentGrade            String?

  // Escola
  schoolId                String
  schoolName              String?

  // Tipo de ocorrência
  incidentType            String
  severity                String?

  // Data e horário
  incidentDate            DateTime
  date                    DateTime            @default(now())
  incidentTime            String?
  time                    String?
  incidentLocation        String?
  location                String?

  // Descrição
  description             String
  witnesses               String?

  // Envolvidos
  involvedStudents        Json?
  involvedStaff           Json?

  // Ação tomada
  actionTaken             String?
  actions_taken           String?
  counselingProvided      Boolean             @default(false)
  parentNotified          Boolean             @default(false)
  parentNotificationDate  DateTime?

  // Medidas disciplinares
  disciplinaryAction      String?
  measures                String
  suspensionDays          Int                 @default(0)
  suspensionStartDate     DateTime?
  suspensionEndDate       DateTime?

  // Acompanhamento
  requiresFollowUp        Boolean             @default(false)
  followUpDate            DateTime?
  followUpResponsible     String?

  // Responsável pelo registro
  reportedById            String?
  reportedByName          String?
  reportedByRole          String?
  reportedBy              String?
  responsibleTeacher      String

  // Status
  status                  String              @default("PENDING")
  isActive                Boolean             @default(false)
  resolved                Boolean             @default(false)
  reviewedAt              DateTime?

  observations            String?
  internalNotes           String?
  createdAt               DateTime            @default(now())
  updatedAt               DateTime            @updatedAt

  protocol                ProtocolSimplified? @relation("DisciplinaryRecordProtocol", fields: [protocolId], references: [id])
  citizen                 Citizen             @relation("DisciplinaryRecordCitizen", fields: [citizenId], references: [id])

  @@index([citizenId])
  @@map("disciplinary_records")
}

model SportsTeam {
  id                 String              @id @default(cuid())
  protocolId         String?
  name               String
  sport              String
  category           String
  gender             String?
  ageGroup           String
  coach              String
  coachCpf           String?
  coachPhone         String?
  foundationDate     DateTime?
  trainingSchedule   Json?
  maxPlayers         Int?
  currentPlayers     Int                 @default(0)
  status             String              @default("ACTIVE")
  homeVenue          String?
  description        String?
  achievements       Json?
  roster             Json?
  modalityId         String?
  isActive           Boolean             @default(true)
  protocol           String? // Campo adicionado
  serviceId          String? // ID do serviço que criou o time
  source             String              @default("manual")
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  modality           SportsModality?     @relation(fields: [modalityId], references: [id])
  protocolSimplified ProtocolSimplified? @relation("SportsTeamProtocol", fields: [protocolId], references: [id])

  @@map("sports_teams")
}

model Competition {
  id                 String              @id @default(cuid())
  protocolId         String?
  name               String
  sport              String
  competitionType    String
  type               String?
  startDate          DateTime
  endDate            DateTime
  category           String
  ageGroup           String
  maxTeams           Int?
  registeredTeams    Int?
  registrationFee    Float?
  entryFee           Float?
  prizes             Json?
  rules              String?
  status             String              @default("PLANNED")
  organizer          String
  venue              String?
  location           String?
  contact            Json?
  results            Json?
  modalityId         String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  modality           SportsModality?     @relation(fields: [modalityId], references: [id])
  protocolSimplified ProtocolSimplified? @relation("CompetitionProtocol", fields: [protocolId], references: [id])

  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("competitions")
}

model SportsInfrastructure {
  id                  String              @id @default(cuid())
  protocolId          String?
  name                String
  type                String
  sports              Json
  modalities          Json?
  address             String
  coordinates         Json?
  capacity            Int?
  dimensions          String?
  surface             String?
  lighting            Boolean             @default(false)
  covered             Boolean             @default(false)
  accessibility       Boolean             @default(false)
  equipment           Json?
  facilities          Json?
  operatingHours      String?
  status              String              @default("ACTIVE")
  maintenanceSchedule Json?
  lastMaintenance     DateTime?
  bookingRules        Json?
  contact             String?
  manager             String?
  isPublic            Boolean             @default(true)
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  protocolSimplified  ProtocolSimplified? @relation("SportsInfrastructureProtocol", fields: [protocolId], references: [id])

  @@map("sports_infrastructures")
}

model SportsSchool {
  id                 String              @id @default(cuid())
  protocolId         String?
  name               String
  sport              String
  description        String
  targetAge          String
  instructor         String
  instructorCpf      String?
  maxStudents        Int
  currentStudents    Int                 @default(0)
  schedule           Json
  location           String
  monthlyFee         Float?
  equipment          Json?
  requirements       String?
  startDate          DateTime
  endDate            DateTime?
  status             String              @default("ACTIVE")
  isActive           Boolean             @default(true)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  protocolSimplified ProtocolSimplified? @relation("SportsSchoolProtocol", fields: [protocolId], references: [id])

  @@map("sports_schools")
}

model SportsSchoolEnrollment {
  id                 String              @id @default(cuid())
  protocolId         String?
  sportsSchoolId     String?
  studentName        String
  studentBirthDate   DateTime
  studentCpf         String?
  studentRg          String?
  parentName         String?
  parentCpf          String?
  parentPhone        String
  parentEmail        String?
  address            String
  neighborhood       String?
  sport              String
  level              String? // iniciante, intermediário, avançado
  enrollmentDate     DateTime            @default(now())
  status             String              @default("ACTIVE") // ACTIVE, INACTIVE, COMPLETED
  medicalCertificate Json?
  emergencyContact   Json?
  observations       String?
  uniforms           Json? // uniformes fornecidos
  attendance         Json? // registro de presença
  serviceId          String?
  source             String              @default("manual")
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  protocolSimplified ProtocolSimplified? @relation("SportsSchoolEnrollmentProtocol", fields: [protocolId], references: [id])

  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("sports_school_enrollments")
}

model SportsInfrastructureReservation {
  id                 String              @id @default(cuid())
  protocolId         String?
  infrastructureId   String?
  infrastructureName String
  requesterName      String
  requesterCpf       String?
  requesterPhone     String
  requesterEmail     String?
  organization       String? // clube, escola, grupo
  sport              String
  purpose            String // treinamento, competição, evento
  date               DateTime
  startTime          String
  endTime            String
  expectedPeople     Int?
  equipment          Json? // equipamentos necessários
  status             String              @default("PENDING") // PENDING, APPROVED, REJECTED, COMPLETED
  approvedBy         String?
  approvedAt         DateTime?
  rejectionReason    String?
  observations       String?
  serviceId          String?
  source             String              @default("manual")
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  protocolSimplified ProtocolSimplified? @relation("SportsInfrastructureReservationProtocol", fields: [protocolId], references: [id])

  @@map("sports_infrastructure_reservations")
}

model CompetitionEnrollment {
  id                 String              @id @default(cuid())
  protocolId         String?
  competitionId      String?
  competitionName    String
  teamName           String
  sport              String
  category           String
  ageGroup           String
  coachName          String
  coachCpf           String?
  coachPhone         String
  coachEmail         String?
  playersCount       Int
  playersList        Json // lista de atletas com dados
  enrollmentDate     DateTime            @default(now())
  paymentStatus      String              @default("PENDING") // PENDING, PAID, EXEMPT
  paymentProof       Json?
  status             String              @default("PENDING") // PENDING, APPROVED, REJECTED
  approvedBy         String?
  approvedAt         DateTime?
  rejectionReason    String?
  observations       String?
  serviceId          String?
  source             String              @default("manual")
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  protocolSimplified ProtocolSimplified? @relation("CompetitionEnrollmentProtocol", fields: [protocolId], references: [id])

  @@map("competition_enrollments")
}

model TournamentEnrollment {
  id                 String              @id @default(cuid())
  protocolId         String?
  tournamentId       String?
  tournamentName     String
  participantType    String // TEAM, INDIVIDUAL
  teamName           String?
  athleteName        String?
  athleteCpf         String?
  sport              String
  category           String
  ageGroup           String
  coachName          String?
  coachPhone         String?
  coachEmail         String?
  playersCount       Int?
  playersList        Json? // lista de atletas (se equipe)
  enrollmentDate     DateTime            @default(now())
  paymentStatus      String              @default("PENDING")
  paymentProof       Json?
  status             String              @default("PENDING")
  approvedBy         String?
  approvedAt         DateTime?
  rejectionReason    String?
  observations       String?
  serviceId          String?
  source             String              @default("manual")
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  protocolSimplified ProtocolSimplified? @relation("TournamentEnrollmentProtocol", fields: [protocolId], references: [id])

  @@map("tournament_enrollments")
}

model SecurityOccurrence {
  id             String              @id @default(cuid())
  protocolId     String?
  protocol       String              @unique
  occurrenceType String
  type           String?
  severity       String
  description    String
  location       String
  coordinates    Json?
  reportedBy     String?
  reporterName   String?
  reporterPhone  String?
  reporterCpf    String?
  victimInfo     Json?
  officerName    String?
  dateTime       DateTime?
  occurrenceDate DateTime
  reportDate     DateTime            @default(now())
  status         String              @default("OPEN")
  evidence       Json?
  witnesses      Json?
  actions        String?
  resolution     String?
  followUp       Boolean             @default(false)
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  protocolRel    ProtocolSimplified? @relation("SecurityOccurrenceProtocol", fields: [protocolId], references: [id])

  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("security_occurrences")
}

model SecurityAlert {
  id              String              @id @default(cuid())
  protocolId      String?
  title           String
  alertType       String
  type            String?
  message         String
  description     String?
  location        String?
  targetArea      String?
  coordinates     Json?
  severity        String
  priority        String?
  isActive        Boolean             @default(true)
  status          String?
  startDate       DateTime
  endDate         DateTime?
  expiresAt       DateTime?
  validUntil      DateTime?
  targetAudience  String?
  affectedAreas   Json?
  channels        Json
  acknowledgments Int                 @default(0)
  createdBy       String
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  protocolRel     ProtocolSimplified? @relation("SecurityAlertProtocol", fields: [protocolId], references: [id])

  @@map("security_alerts")
}

model SecurityPatrol {
  id           String              @id @default(cuid())
  protocolId   String?
  patrolType   String
  route        String
  startTime    DateTime
  endTime      DateTime?
  guardId      String?
  guardName    String?
  officerName  String
  officerBadge String?
  vehicle      String?
  status       String              @default("ACTIVE")
  checkpoints  Json?
  incidents    Json?
  observations String?
  gpsTrack     Json?
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  protocolRel  ProtocolSimplified? @relation("SecurityPatrolProtocol", fields: [protocolId], references: [id])

  @@map("security_patrols")
}

model CriticalPoint {
  id                 String              @id @default(cuid())
  protocolId         String?
  name               String
  location           String
  address            String?
  coordinates        Json
  pointType          String
  riskType           Json?
  riskLevel          String
  description        String
  recommendations    String
  recommendedActions Json?
  patrolFrequency    String?
  monitoringLevel    String
  lastIncident       DateTime?
  lastIncidentDate   DateTime?
  incidentCount      Int                 @default(0)
  isActive           Boolean             @default(true)
  observations       String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  protocolRel        ProtocolSimplified? @relation("CriticalPointProtocol", fields: [protocolId], references: [id])

  @@map("critical_points")
}

model SecurityAttendance {
  id                 String              @id @default(cuid())
  protocolId         String?
  protocol           String              @unique
  citizenId          String?
  citizenName        String
  citizenCpf         String?
  contact            String
  serviceType        String
  attendanceType     String?
  subject            String
  description        String
  urgency            String              @default("NORMAL")
  location           String?
  evidence           Json?
  status             String              @default("PENDING")
  assignedOfficer    String?
  referredTo         String?
  actions            String?
  resolution         String?
  satisfactionRating Int?
  followUpDate       DateTime?
  followUpNeeded     Boolean             @default(false)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  protocolRel        ProtocolSimplified? @relation("SecurityAttendanceProtocol", fields: [protocolId], references: [id])

  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("security_attendances")
}

model LocalBusiness {
  id               String              @id @default(cuid())
  protocolId       String?
  name             String
  businessType     String
  businessInfo     Json?
  category         String
  description      String
  address          String
  neighborhood     String?
  city             String?
  state            String?
  coordinates      Json?
  contact          Json
  openingHours     Json
  services         Json?
  amenities        Json?
  priceRange       String?
  rating           Float?
  photos           Json?
  owner            String
  ownerCpf         String?
  isActive         Boolean             @default(true)
  isTourismPartner Boolean             @default(false)
  isPartner        Boolean             @default(false)
  certifications   Json?
  protocol         String?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  protocolRel      ProtocolSimplified? @relation("LocalBusinessProtocol", fields: [protocolId], references: [id])

  @@index([protocolId])
  @@index([createdAt])
  @@map("local_businesses")
}

model TourismInfo {
  id             String    @id @default(cuid())
  title          String
  infoType       String
  type           String?
  content        String
  category       String
  targetAudience String?
  location       String?
  coordinates    Json?
  validFrom      DateTime
  validUntil     DateTime?
  isActive       Boolean   @default(true)
  publication    Json?
  priority       String    @default("NORMAL")
  images         Json?
  links          Json?
  tags           Json?
  seo            Json?
  views          Int       @default(0)
  likes          Int       @default(0)
  createdBy      String
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@map("tourism_infos")
}

model TourismProgram {
  id                  String              @id @default(cuid())
  protocolId          String?
  name                String
  programType         String
  type                String?
  category            String?
  description         String
  objectives          Json
  targetAudience      String
  startDate           DateTime
  endDate             DateTime
  budget              Float?
  coordinator         String
  activities          Json
  participants        Json?
  results             Json?
  status              String              @default("PLANNED")
  isActive            Boolean             @default(true)
  evaluation          Json?
  photos              Json?
  currentParticipants Int?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  protocol            ProtocolSimplified? @relation("TourismProgramProtocol", fields: [protocolId], references: [id])

  @@map("tourism_programs")
}

model TourismAttendance {
  id             String              @id @default(cuid())
  protocolId     String?
  protocol       String              @unique
  citizenId      String?
  visitorName    String
  visitorEmail   String?
  visitorPhone   String?
  origin         String?
  serviceType    String
  subject        String
  description    String
  category       String?
  urgency        String              @default("NORMAL")
  status         String              @default("PENDING")
  assignedAgent  String?
  resolution     String?
  satisfaction   Int?
  followUpDate   DateTime?
  touristProfile Json?
  serviceId      String?
  source         String              @default("manual")
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  citizen        Citizen?            @relation("TourismAttendanceCitizen", fields: [citizenId], references: [id])
  protocolRel    ProtocolSimplified? @relation("TourismAttendanceProtocol", fields: [protocolId], references: [id])

  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("tourism_attendances")
}

model TourismGuide {
  id                String              @id @default(cuid())
  protocolId        String?
  name              String
  cpf               String
  rg                String?
  email             String?
  phone             String
  address           String?
  birthDate         DateTime?
  languages         Json
  specialties       Json?
  certifications    Json?
  licenseNumber     String?
  licenseExpiry     DateTime?
  registrationDate  DateTime            @default(now())
  status            String              @default("ACTIVE")
  experienceYears   Int?
  bio               String?
  photo             String?
  availableSchedule Json?
  rating            Float?
  totalTours        Int                 @default(0)
  isActive          Boolean             @default(true)
  emergencyContact  Json?
  bankInfo          Json?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  protocol          ProtocolSimplified? @relation("TourismGuideProtocol", fields: [protocolId], references: [id])

  @@unique([cpf])
  @@map("tourism_guides")
}

model TourismRoute {
  id              String              @id @default(cuid())
  protocolId      String?
  name            String
  routeType       String
  description     String
  duration        String
  difficulty      String
  distance        Float?
  startPoint      String
  endPoint        String
  waypoints       Json?
  attractions     Json
  services        Json?
  bestSeason      Json?
  recommendations String?
  warnings        String?
  accessibility   Json?
  photos          Json?
  mapData         Json?
  estimatedCost   Float?
  guideRequired   Boolean             @default(false)
  minimumAge      Int?
  maxGroupSize    Int?
  featured        Boolean             @default(false)
  isActive        Boolean             @default(true)
  rating          Float?
  totalViews      Int                 @default(0)
  createdBy       String?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  protocol        ProtocolSimplified? @relation("TourismRouteProtocol", fields: [protocolId], references: [id])

  @@map("tourism_routes")
}

model TourismEvent {
  id               String              @id @default(cuid())
  protocolId       String?
  name             String
  eventType        String
  category         String?
  description      String
  venue            String
  address          String
  coordinates      Json?
  startDate        DateTime
  endDate          DateTime
  startTime        String?
  endTime          String?
  duration         String?
  organizer        String
  organizerContact Json
  capacity         Int?
  registeredCount  Int                 @default(0)
  ticketPrice      Float?
  freeEntry        Boolean             @default(false)
  ageRestriction   String?
  accessibility    Json?
  amenities        Json?
  program          Json?
  speakers         Json?
  sponsors         Json?
  photos           Json?
  promotional      Json?
  status           String              @default("PLANNED")
  isPublic         Boolean             @default(true)
  featured         Boolean             @default(false)
  registrationUrl  String?
  socialMedia      Json?
  tags             Json?
  requirements     String?
  cancellationInfo String?
  createdBy        String?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  protocol         ProtocolSimplified? @relation("TourismEventProtocol", fields: [protocolId], references: [id])

  @@map("tourism_events")
}

model EnvironmentalLicense {
  id                String              @id @default(cuid())
  protocolId        String?
  licenseNumber     String              @unique
  applicantName     String
  applicantCpf      String
  applicantPhone    String? // Campo adicionado
  applicantDocument String?
  businessName      String?
  licenseType       String
  activity          String
  description       String
  location          String
  coordinates       Json?
  area              Float?
  applicationDate   DateTime
  analysisDate      DateTime?
  issueDate         DateTime?
  validFrom         DateTime? // Campo adicionado
  expiryDate        DateTime?
  status            String              @default("UNDER_ANALYSIS")
  conditions        Json?
  technicalOpinion  String?
  analyst           String?
  fee               Float?
  documents         Json?
  inspections       Json?
  observations      String?
  applicantEmail    String? // Campo adicionado
  validUntil        DateTime? // Campo adicionado
  activityType      String? // Campo adicionado
  technicalReport   Json? // Campo adicionado
  reviewedBy        String? // Campo adicionado
  reviewedAt        DateTime? // Campo adicionado
  approvedBy        String? // Campo adicionado
  approvedAt        DateTime? // Campo adicionado
  protocolNumber    String? // Campo adicionado
  serviceId         String? // Campo adicionado
  source            String              @default("manual") // Campo adicionado
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  protocol          ProtocolSimplified? @relation("EnvironmentalLicenseProtocol", fields: [protocolId], references: [id])

  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("environmental_licenses")
}

model EnvironmentalComplaint {
  id                  String              @id @default(cuid())
  protocolId          String?
  protocol            String              @unique
  reporterName        String?
  complainantName     String? // Campo adicionado (alias de reporterName)
  reporterPhone       String?
  reporterEmail       String?
  complaintType       String
  severity            String
  description         String
  location            String
  coordinates         Json?
  evidence            Json?
  occurrenceDate      DateTime
  reportDate          DateTime            @default(now())
  status              String              @default("OPEN")
  inspector           String?
  assignedTo          String? // Campo adicionado
  inspectionDate      DateTime?
  findings            String?
  actions             String?
  actionsTaken        Json? // Campo adicionado
  resolution          String?
  penalty             Float?
  followUp            Boolean             @default(false)
  isAnonymous         Boolean             @default(false)
  complainantPhone    String? // Campo adicionado
  complainantEmail    String? // Campo adicionado
  investigationDate   DateTime? // Campo adicionado
  investigatorId      String? // Campo adicionado
  investigationReport Json? // Campo adicionado
  resolvedBy          String? // Campo adicionado
  resolvedAt          DateTime? // Campo adicionado
  priority            String              @default("normal") // Campo adicionado
  serviceId           String? // Campo adicionado
  source              String              @default("manual") // Campo adicionado
  photos              Json? // Campo adicionado
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  protocolRelation    ProtocolSimplified? @relation("EnvironmentalComplaintProtocol", fields: [protocolId], references: [id])

  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("environmental_complaints")
}

model ProtectedArea {
  id              String              @id @default(cuid())
  protocolId      String?
  name            String
  areaType        String
  description     String
  location        String
  coordinates     Json
  totalArea       Float
  protectionLevel String
  legalBasis      String
  managementPlan  Json?
  biodiversity    Json?
  threats         Json?
  activities      Json?
  restrictions    Json?
  guardian        String?
  contact         String?
  visitationRules Json?
  isPublicAccess  Boolean             @default(false)
  status          String              @default("ACTIVE")
  lastInspection  DateTime?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  protocol        ProtocolSimplified? @relation("ProtectedAreaProtocol", fields: [protocolId], references: [id])

  @@map("protected_areas")
}

model EnvironmentalProgram {
  id             String              @id @default(cuid())
  protocolId     String?
  name           String
  programType    String
  description    String
  objectives     Json
  targetAudience String
  startDate      DateTime
  endDate        DateTime?
  budget         Float?
  coordinator    String
  activities     Json
  indicators     Json?
  partnerships   Json?
  beneficiaries  Int?
  results        Json?
  status         String              @default("ACTIVE")
  isActive       Boolean             @default(true)
  evaluation     Json?
  reports        Json?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  protocol       ProtocolSimplified? @relation("EnvironmentalProgramProtocol", fields: [protocolId], references: [id])

  @@map("environmental_programs")
}

model EnvironmentalAttendance {
  id               String              @id @default(cuid())
  protocolId       String?
  protocol         String              @unique
  citizenId        String?
  citizenName      String
  citizenCpf       String?
  contact          String
  serviceType      String
  subject          String
  description      String
  category         String?
  urgency          String              @default("NORMAL")
  location         String?
  evidence         Json?
  status           String              @default("PENDING")
  analyst          String?
  technicalOpinion String?
  recommendation   String?
  followUpDate     DateTime?
  resolution       String?
  satisfaction     Int?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  protocolRelation ProtocolSimplified? @relation("EnvironmentalAttendanceProtocol", fields: [protocolId], references: [id])
  citizen          Citizen?            @relation("EnvironmentalAttendanceCitizen", fields: [citizenId], references: [id])

  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("environmental_attendances")
}

model TreeCuttingAuthorization {
  id                  String              @id @default(cuid())
  protocolId          String?
  authorizationNumber String              @unique
  applicantName       String
  applicantCpf        String
  applicantPhone      String?
  applicantEmail      String?
  propertyAddress     String
  coordinates         Json?
  requestType         String // PODA, CORTE, TRANSPLANTE
  treeSpecies         String
  treeQuantity        Int                 @default(1)
  treeHeight          Float?
  trunkDiameter       Float?
  justification       String
  technicalReport     String?
  photos              Json?
  requestDate         DateTime            @default(now())
  inspectionDate      DateTime?
  inspector           String?
  inspectionReport    String?
  decision            String? // APROVADO, NEGADO, APROVADO_COM_CONDICOES
  conditions          Json?
  authorizationDate   DateTime?
  validUntil          DateTime?
  executionDate       DateTime?
  status              String              @default("UNDER_ANALYSIS")
  fee                 Float?
  observations        String?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  protocol            ProtocolSimplified? @relation("TreeCuttingAuthorizationProtocol", fields: [protocolId], references: [id])

  @@map("tree_cutting_authorizations")
}

model EnvironmentalInspection {
  id                 String              @id @default(cuid())
  protocolId         String?
  inspectionNumber   String              @unique
  inspectionType     String // LICENCIAMENTO, DENUNCIA, ROTINA, SEGUIMENTO
  subject            String
  location           String
  coordinates        Json?
  scheduledDate      DateTime
  inspectionDate     DateTime?
  inspector          String
  inspectorTeam      Json?
  findings           String?
  photos             Json?
  evidence           Json?
  nonCompliances     Json? // Lista de não conformidades
  recommendations    String?
  reportedViolations Json?
  penalties          Float?
  correctiveActions  Json?
  followUpRequired   Boolean             @default(false)
  followUpDate       DateTime?
  status             String              @default("SCHEDULED")
  priority           String              @default("NORMAL")
  report             String?
  reportDate         DateTime?
  relatedLicenseId   String?
  relatedComplaintId String?
  observations       String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  protocol           ProtocolSimplified? @relation("EnvironmentalInspectionProtocol", fields: [protocolId], references: [id])

  @@map("environmental_inspections")
}

model TechnicalAssistance {
  id               String              @id @default(cuid())
  citizenId        String              // ✅ OBRIGATÓRIO - vincula ao cidadão solicitante
  protocolId       String?             @unique
  producerId       String?             // ✅ Opcional - produtor relacionado (se existir)
  propertyId       String?             // ✅ Opcional - propriedade relacionada

  // ✅ CAMPOS DE COMPATIBILIDADE (redundantes com Citizen, mas necessários para código legado)
  applicantName    String?             // Nome do solicitante (idealmente usar citizen.name)
  applicantCpf     String?             // CPF do solicitante (idealmente usar citizen.cpf)
  applicantEmail   String?             // Email do solicitante (idealmente usar citizen.email)
  applicantPhone   String?             // Telefone do solicitante (idealmente usar citizen.phone)
  producerName     String?             // Nome do produtor (redundante)
  producerCpf      String?             // CPF do produtor (redundante)
  producerPhone    String?             // Telefone do produtor (redundante)

  // ✅ Campos ESPECÍFICOS da assistência técnica
  assistanceType   String              // Tipo de assistência (ORIENTACAO_TECNICA, ANALISE_SOLO, etc)
  subject          String              // Assunto/título
  description      String              // Descrição detalhada do problema/necessidade
  urgency          String              @default("NORMAL") // NORMAL, HIGH, CRITICAL

  // Dados da propriedade/localização
  propertyName     String?             // Nome da propriedade (se não vinculada)
  propertySize     Float?              // Tamanho da área
  propertyArea     Float?              // Área a ser atendida
  location         String?             // Localização
  coordinates      Json?               // Coordenadas GPS

  // Culturas e criações
  crop             String?             // Cultura principal (legado)
  cropTypes        Json?               // Tipos de culturas (array)
  livestock        String?             // Criações
  mainCrops        Json?               // Principais culturas

  // Agendamento e visita
  requestDate      DateTime?           @default(now()) // Data da solicitação
  preferredDate    DateTime?           // Data preferencial para visita
  scheduledDate    DateTime?           // Data agendada
  scheduledVisit   DateTime?           // Visita agendada (legado)
  visitDate        DateTime?           // Data da visita realizada

  // Técnico responsável
  technician       String?             // Nome do técnico
  technicianId     String?             // ID do técnico (User)

  // Atendimento
  findings         String?             // Constatações da visita
  recommendations  Json?               // Recomendações técnicas
  visitReport      Json?               // Relatório completo da visita
  followUpPlan     Json?               // Plano de acompanhamento
  followUpRequired Boolean             @default(false)
  followUpDate     DateTime?           // Data do próximo acompanhamento
  followUpNotes    String?             // Notas de acompanhamento
  nextVisitDate    DateTime?           // Próxima visita

  // Recursos
  materials        Json?               // Materiais utilizados/recomendados
  costs            Float?              // Custos estimados

  // Status e controle
  status           String              @default("PENDING") // PENDING, SCHEDULED, IN_PROGRESS, COMPLETED, CANCELLED
  priority         String              @default("normal") // normal, high, critical
  satisfaction     Int?                // Avaliação (1-5)
  photos           Json?               // Fotos da visita
  observations     String?             // Observações gerais

  // Metadados
  serviceId        String?             // ID do serviço
  source           String              @default("manual") // manual, online, app
  completedBy      String?             // Quem completou
  completedAt      DateTime?           // Data de conclusão
  propertyLocation String?             // Localização da propriedade (legado)

  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt

  citizen          Citizen             @relation("TechnicalAssistanceCitizen", fields: [citizenId], references: [id])
  protocol         ProtocolSimplified? @relation("TechnicalAssistanceProtocol", fields: [protocolId], references: [id])

  @@index([citizenId])
  @@index([producerId])
  @@index([protocolId])
  @@index([status])
  @@index([scheduledDate])
  @@index([createdAt])
  @@map("technical_assistances")
}

model RuralProgram {
  id                  String    @id @default(cuid())
  protocolId          String?
  name                String
  programType         String
  description         String
  objectives          Json
  targetAudience      String
  requirements        Json
  benefits            Json
  startDate           DateTime
  endDate             DateTime?
  budget              Float?
  coordinator         String
  maxParticipants     Int?
  currentParticipants Int       @default(0)
  applicationPeriod   Json?
  selectionCriteria   Json?
  partners            Json?
  results             Json?
  status              String    @default("PLANNED")
  evaluation          Json?

  // Campos customizáveis para formulário de inscrição
  customFields       Json? // Array de campos adicionais: [{id, label, type, required, options}]
  requiredDocuments  Json? // Array de documentos necessários: [{id, name, description, required}]
  enrollmentSettings Json? // Configurações: {allowMultipleEnrollments, autoApprove, sendNotifications}

  createdAt   DateTime                 @default(now())
  updatedAt   DateTime                 @updatedAt
  protocol    ProtocolSimplified?      @relation("RuralProgramProtocol", fields: [protocolId], references: [id])
  enrollments RuralProgramEnrollment[]

  @@map("rural_programs")
}

model RuralProgramEnrollment {
  id         String  @id @default(cuid())
  citizenId  String  // ✅ OBRIGATÓRIO - vincula ao cidadão inscrito
  protocolId String?
  programId  String
  producerId String? // ✅ Opcional - produtor relacionado (se existir)

  // ✅ REMOVIDOS: applicantName, applicantCpf, applicantEmail, applicantPhone, applicantAddress
  // Acessar via: enrollment.citizen.name, enrollment.citizen.cpf, etc

  // Status da inscrição
  status         String    @default("PENDING") // PENDING, APPROVED, REJECTED, CANCELLED
  enrollmentDate DateTime  @default(now())
  approvedDate   DateTime?
  rejectedDate   DateTime?
  startDate      DateTime?
  endDate        DateTime?

  // Dados customizados (resposta aos campos customFields do programa)
  customData Json?

  // Documentos enviados
  documents Json? // Array de documentos: [{id, name, url, uploadedAt}]

  // Observações e notas
  observations    String?
  adminNotes      String?
  rejectionReason String?

  // Metadados
  moduleType String   @default("INSCRICAO_PROGRAMA_RURAL")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relacionamentos
  citizen  Citizen             @relation("RuralProgramEnrollmentCitizen", fields: [citizenId], references: [id])
  program  RuralProgram        @relation(fields: [programId], references: [id])
  protocol ProtocolSimplified? @relation("RuralProgramEnrollmentProtocol", fields: [protocolId], references: [id])
  producer RuralProducer?      @relation("RuralProgramEnrollmentProducer", fields: [producerId], references: [id])

  @@index([citizenId])
  @@index([programId])
  @@index([status])
  @@index([moduleType])
  @@index([protocolId])
  @@index([createdAt])
  @@map("rural_program_enrollments")
}

model RuralTraining {
  id                  String    @id @default(cuid())
  protocolId          String?
  title               String
  trainingType        String
  description         String
  objectives          Json
  targetAudience      String
  instructor          String
  instructorBio       String?
  content             Json
  duration            Int
  maxParticipants     Int
  currentParticipants Int       @default(0)
  startDate           DateTime
  endDate             DateTime?
  schedule            Json
  location            String
  materials           Json?
  certificate         Boolean   @default(false)
  cost                Float?
  requirements        String?
  evaluation          Json?
  feedback            Json?
  photos              Json?
  status              String    @default("PLANNED")

  // Campos customizáveis para formulário de inscrição
  customFields       Json? // Array de campos adicionais
  requiredDocuments  Json? // Array de documentos necessários
  enrollmentSettings Json? // Configurações de inscrição

  createdAt   DateTime                  @default(now())
  updatedAt   DateTime                  @updatedAt
  protocol    ProtocolSimplified?       @relation("RuralTrainingProtocol", fields: [protocolId], references: [id])
  enrollments RuralTrainingEnrollment[]

  @@map("rural_trainings")
}

model RuralTrainingEnrollment {
  id         String  @id @default(cuid())
  citizenId  String  // ✅ OBRIGATÓRIO - vincula ao cidadão inscrito
  protocolId String?
  trainingId String
  producerId String? // ✅ Opcional - produtor relacionado (se existir)

  // ✅ REMOVIDOS: applicantName, applicantCpf, applicantEmail, applicantPhone, applicantAddress
  // Acessar via: enrollment.citizen.name, enrollment.citizen.cpf, etc

  // Status da inscrição
  status            String    @default("PENDING")
  enrollmentDate    DateTime  @default(now())
  approvedDate      DateTime?
  rejectedDate      DateTime?
  completionDate    DateTime?
  certificateIssued Boolean   @default(false)

  // Dados customizados
  customData Json?
  documents  Json?

  // Observações
  observations    String?
  adminNotes      String?
  rejectionReason String?

  // Metadados
  moduleType String   @default("INSCRICAO_CURSO_RURAL")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relacionamentos
  citizen  Citizen             @relation("RuralTrainingEnrollmentCitizen", fields: [citizenId], references: [id])
  training RuralTraining       @relation(fields: [trainingId], references: [id])
  protocol ProtocolSimplified? @relation("RuralTrainingEnrollmentProtocol", fields: [protocolId], references: [id])
  producer RuralProducer?      @relation("RuralTrainingEnrollmentProducer", fields: [producerId], references: [id])

  @@index([citizenId])
  @@index([trainingId])
  @@index([status])
  @@index([moduleType])
  @@index([protocolId])
  @@index([createdAt])
  @@map("rural_training_enrollments")
}

model AgricultureAttendance {
  id                 String              @id @default(cuid())
  citizenId          String              // ✅ OBRIGATÓRIO - vincula ao cidadão solicitante
  protocolId         String?             @unique
  producerId         String?             // ✅ Opcional - produtor relacionado (se existir)

  // ✅ REMOVIDOS: producerName, producerCpf, contact (já existem em Citizen)
  // Acessar via: attendance.citizen.name, attendance.citizen.cpf, attendance.citizen.phone

  // ✅ Campos ESPECÍFICOS do atendimento
  serviceType        String              // Tipo de serviço solicitado
  subject            String              // Assunto do atendimento
  description        String              // Descrição detalhada
  category           String?             // Categoria do atendimento
  urgency            String              @default("NORMAL") // NORMAL, HIGH, CRITICAL

  // Dados da propriedade
  propertyName       String?             // Nome da propriedade
  propertySize       Float?              // Tamanho da propriedade
  location           String?             // Localização
  crops              Json?               // Culturas (array)
  livestock          Json?               // Criações (array)

  // Agendamento e visita
  preferredVisitDate DateTime?           // Data preferencial para visita
  scheduledDate      DateTime?           // Data agendada
  visitDate          DateTime?           // Data da visita realizada

  // Atendimento
  technician         String?             // Técnico responsável
  findings           String?             // Constatações
  recommendations    String?             // Recomendações
  resolution         String?             // Resolução/conclusão
  followUpDate       DateTime?           // Data de acompanhamento

  // Avaliação
  satisfaction       Int?                // Satisfação (1-5)

  // Status
  status             String              @default("PENDING") // PENDING, SCHEDULED, IN_PROGRESS, COMPLETED, CANCELLED

  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt

  citizen            Citizen             @relation("AgricultureAttendanceCitizen", fields: [citizenId], references: [id])
  protocol           ProtocolSimplified? @relation("AgricultureAttendanceProtocol", fields: [protocolId], references: [id])

  @@index([citizenId])
  @@index([producerId])
  @@index([protocolId])
  @@index([status])
  @@index([scheduledDate])
  @@index([createdAt])
  @@map("agriculture_attendances")
}

model HousingApplication {
  id                 String              @id @default(cuid())
  protocolId         String?
  protocol           String              @unique
  applicantName      String
  applicantCpf       String
  contact            Json
  address            String
  familyIncome       Float
  familySize         Int
  housingType        String
  programType        String
  propertyValue      Float?
  hasProperty        Boolean             @default(false)
  isFirstHome        Boolean             @default(true)
  priorityScore      Int                 @default(0)
  documents          Json
  program            String?
  applicationDate    DateTime            @default(now())
  submissionDate     DateTime?
  analysisDate       DateTime?
  approvalDate       DateTime?
  status             String              @default("UNDER_ANALYSIS")
  analyst            String?
  observations       String?
  rejection_reason   String?
  approvedBenefit    Json?
  disbursementDate   DateTime?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  protocolSimplified ProtocolSimplified? @relation("HousingApplicationProtocol", fields: [protocolId], references: [id])

  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("housing_applications")
}

model HousingUnit {
  id                 String              @id @default(cuid())
  protocolId         String?
  unitCode           String              @unique
  unitType           String
  address            String
  coordinates        Json?
  neighborhood       String
  area               Float
  bedrooms           Int
  bathrooms          Int
  constructionYear   Int?
  propertyValue      Float?
  monthlyRent        Float?
  isOccupied         Boolean             @default(false)
  occupantName       String?
  occupantCpf        String?
  occupancyDate      DateTime?
  contractType       String?
  contractEnd        DateTime?
  program            String?
  conditions         Json?
  lastInspection     DateTime?
  needsMaintenance   Boolean             @default(false)
  maintenanceItems   Json?
  photos             Json?
  status             String              @default("AVAILABLE")
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  protocolSimplified ProtocolSimplified? @relation("HousingUnitProtocol", fields: [protocolId], references: [id])

  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("housing_units")
}

model LandRegularization {
  id                    String              @id @default(cuid())
  protocolId            String?
  protocol              String              @unique
  applicantName         String
  applicantCpf          String
  contact               Json
  propertyAddress       String
  coordinates           Json?
  propertyArea          Float
  occupationDate        DateTime?
  occupationType        String
  hasBuilding           Boolean             @default(false)
  buildingArea          Float?
  landValue             Float?
  neighbors             Json?
  accessRoads           Json?
  utilities             Json?
  legalDocuments        Json?
  technicalSurvey       Json?
  environmentalAnalysis Json?
  applicationDate       DateTime            @default(now())
  analysisStartDate     DateTime?
  fieldVisitDate        DateTime?
  publicationDate       DateTime?
  objectionPeriod       Json?
  approvalDate          DateTime?
  titleIssueDate        DateTime?
  status                String              @default("UNDER_ANALYSIS")
  analyst               String?
  observations          String?
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  protocolSimplified    ProtocolSimplified? @relation("LandRegularizationProtocol", fields: [protocolId], references: [id])

  @@map("land_regularizations")
}

model RentAssistance {
  id                  String              @id @default(cuid())
  protocolId          String?
  protocol            String              @unique
  applicantName       String
  applicantCpf        String
  contact             Json
  currentAddress      String
  monthlyRent         Float
  landlordName        String
  landlordContact     Json
  leaseContract       Json?
  familyIncome        Float
  familySize          Int
  hasEmployment       Boolean             @default(false)
  employmentDetails   Json?
  vulnerabilityReason String
  requestedAmount     Float
  requestedPeriod     Int // meses
  bankAccount         Json?
  documents           Json
  socialReport        Json?
  applicationDate     DateTime            @default(now())
  analysisDate        DateTime?
  approvalDate        DateTime?
  firstPaymentDate    DateTime?
  lastPaymentDate     DateTime?
  totalPaid           Float               @default(0)
  paymentsCount       Int                 @default(0)
  status              String              @default("UNDER_ANALYSIS")
  analyst             String?
  observations        String?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  protocolSimplified  ProtocolSimplified? @relation("RentAssistanceProtocol", fields: [protocolId], references: [id])

  @@map("rent_assistances")
}

model SocialProgram {
  id                   String    @id @default(cuid())
  name                 String
  programType          String
  description          String
  objectives           Json
  targetAudience       String
  targetGroup          String?
  requirements         Json
  benefits             Json
  benefitValue         Float?
  frequency            String?
  startDate            DateTime
  endDate              DateTime?
  budget               Float?
  maxBeneficiaries     Int?
  maxParticipants      Int?
  currentBeneficiaries Int       @default(0)
  coordinator          String
  registrationPeriod   Json?
  selectionCriteria    Json?
  partners             Json?
  results              Json?
  evaluation           Json?
  isActive             Boolean   @default(true)
  status               String    @default("ACTIVE")
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt

  @@map("social_programs")
}

model SocialAssistanceAttendance {
  id                 String              @id @default(cuid())
  protocolId         String?
  protocol           String              @unique

  // ✅ REFATORADO - citizenId obrigatório sem duplicação
  citizenId          String
  citizen            Citizen             @relation("SocialAttendanceCitizen", fields: [citizenId], references: [id])

  // Tipo de atendimento
  serviceType        String
  attendanceType     String?
  category           String?

  // Demanda social
  socialDemand       String?
  socialIssue        Json?
  vulnerabilityLevel String?
  vulnerability      String?

  // Composição familiar
  familySize         Int?
  dependents         Int                 @default(0)
  minors             Int                 @default(0)
  elderly            Int                 @default(0)
  disabledMembers    Int                 @default(0)

  // Situação econômica
  familyIncome       Float?
  monthlyIncome      Float?
  unemployed         Boolean             @default(false)
  informalWork       Boolean             @default(false)
  housingSituation   String?

  // Programas e benefícios
  hasNIS             Boolean             @default(false)
  nisNumber          String?
  hasCadUnico        Boolean             @default(false)
  cadUnicoNumber     String?
  hasBolsaFamilia    Boolean             @default(false)
  otherBenefits      Json?

  // Solicitação
  subject            String
  description        String
  requestedServices  Json?
  requestedBenefits  Json?

  // Encaminhamentos
  needsReferral      Boolean             @default(false)
  referralType       String?
  referralDestination String?
  referredBy         String?
  referrals          Json?

  // Equipamento SUAS
  crasId             String?
  crasName           String?
  creasId            String?
  creasName          String?

  // Assistente social
  socialWorker       String?
  socialWorkerId     String?
  socialWorkerName   String?

  // Avaliação e plano
  assessment         Json?
  interventionPlan   Json?
  socialWorkerNotes  String?
  actionPlan         String?

  // Acompanhamento
  followUpPlan       Json?
  followUpNeeded     Boolean             @default(false)
  followUpDate       DateTime?

  // Prioridade
  urgency            String              @default("NORMAL")
  priority           String?
  isUrgent           Boolean             @default(false)
  urgencyReason      String?

  // Status
  status             String              @default("PENDING")
  isActive           Boolean             @default(false)
  startedAt          DateTime?

  // Resultado
  resolution         String?
  nextVisitDate      DateTime?
  satisfaction       Int?

  observations       String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt

  socialWorkerUser   User?               @relation("SocialAssistanceWorker", fields: [socialWorkerId], references: [id])
  protocolSimplified ProtocolSimplified? @relation("SocialAssistanceAttendanceProtocol", fields: [protocolId], references: [id])

  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("social_assistance_attendances")
}

model SocialGroupEnrollment {
  id              String              @id @default(cuid())
  protocolId      String?
  citizenId       String?
  participantName String
  participantCpf  String?
  groupName       String
  groupType       String
  enrollmentDate  DateTime            @default(now())
  status          String              @default("ACTIVE")
  frequency       String?
  observations    String?
  instructor      String?
  schedule        Json?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  citizen         Citizen?            @relation("SocialGroupCitizen", fields: [citizenId], references: [id])
  protocol        ProtocolSimplified? @relation("SocialGroupEnrollmentProtocol", fields: [protocolId], references: [id])

  @@map("social_group_enrollments")
}

model SocialProgramEnrollment {
  id              String              @id @default(cuid())
  protocolId      String?
  protocol        String              @unique
  // ✅ REFATORADO - citizenId obrigatório sem duplicação
  citizenId       String
  citizen         Citizen             @relation("SocialProgramCitizen", fields: [citizenId], references: [id])
  programId       String?
  programName     String?
  programType     String?
  enrollmentDate  DateTime            @default(now())
  status          String              @default("pending")
  familyIncome    Float?
  familySize      Int?
  vulnerability   String?
  documents       String?
  priority        String              @default("NORMAL")
  approvedDate    DateTime?
  startDate       DateTime?
  endDate         DateTime?
  benefits        Json?
  observations    String?
  serviceId       String?
  source          String              @default("service")
  createdBy       String
  moduleType      String              @default("PROGRAMA_SOCIAL")
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  protocolSimplified ProtocolSimplified? @relation("SocialProgramEnrollmentProtocol", fields: [protocolId], references: [id])

  @@index([citizenId])
  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("social_program_enrollments")
}

// ============================================================================
// FASE 2 - ASSISTÊNCIA SOCIAL: SOLICITAÇÕES DE SERVIÇOS
// ============================================================================

model SocialBenefitRequest {
  id              String    @id @default(cuid())
  protocolId      String?
  protocol        String    @unique
  citizenId       String
  citizen         Citizen   @relation("SocialBenefitRequestCitizen", fields: [citizenId], references: [id])
  benefitType     String
  quantity        Int       @default(1)
  familyIncome    Float?
  familySize      Int?
  justification   String?
  documents       String?
  status          String    @default("pending")
  observations    String?
  serviceId       String?
  source          String    @default("service")
  createdBy       String
  moduleType      String    @default("BENEFICIO_SOCIAL")
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  protocolSimplified ProtocolSimplified? @relation("SocialBenefitRequestProtocol", fields: [protocolId], references: [id])

  @@index([citizenId])
  @@index([protocolId])
  @@index([status])
  @@map("social_benefit_requests")
}

model DocumentRequest {
  id              String    @id @default(cuid())
  protocolId      String?
  protocol        String    @unique
  citizenId       String
  citizen         Citizen   @relation("DocumentRequestCitizen", fields: [citizenId], references: [id])
  documentType    String
  reason          String
  urgency         String    @default("normal")
  status          String    @default("pending")
  observations    String?
  serviceId       String?
  source          String    @default("service")
  createdBy       String
  moduleType      String    @default("DOCUMENTO_SOCIAL")
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  protocolSimplified ProtocolSimplified? @relation("DocumentRequestProtocol", fields: [protocolId], references: [id])

  @@index([citizenId])
  @@index([protocolId])
  @@index([status])
  @@map("document_requests")
}

model FamilyRegistration {
  id              String    @id @default(cuid())
  protocolId      String?
  protocol        String    @unique
  citizenId       String
  citizen         Citizen   @relation("FamilyRegistrationCitizen", fields: [citizenId], references: [id])
  familyMembers   Json      @default("[]")
  familyIncome    Float?
  housingType     String?
  vulnerability   String?
  needsAssessment String?
  status          String    @default("pending")
  observations    String?
  serviceId       String?
  source          String    @default("service")
  createdBy       String
  moduleType      String    @default("CADASTRO_FAMILIAR")
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  protocolSimplified ProtocolSimplified? @relation("FamilyRegistrationProtocol", fields: [protocolId], references: [id])

  @@index([citizenId])
  @@index([protocolId])
  @@index([status])
  @@map("family_registrations")
}

model SocialHomeVisit {
  id              String    @id @default(cuid())
  protocolId      String?
  protocol        String    @unique
  citizenId       String
  citizen         Citizen   @relation("SocialHomeVisitCitizen", fields: [citizenId], references: [id])
  visitReason     String
  visitType       String    @default("avaliacao")
  status          String    @default("pending")
  observations    String?
  scheduledDate   DateTime?
  completedDate   DateTime?
  serviceId       String?
  source          String    @default("service")
  createdBy       String
  moduleType      String    @default("VISITA_DOMICILIAR")
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  protocolSimplified ProtocolSimplified? @relation("SocialHomeVisitProtocol", fields: [protocolId], references: [id])

  @@index([citizenId])
  @@index([protocolId])
  @@index([status])
  @@map("social_home_visits")
}

model SocialAppointment {
  id                      String              @id @default(cuid())
  protocolId              String?

  // ✅ REFATORADO - citizenId obrigatório sem duplicação
  citizenId               String
  citizen                 Citizen             @relation("SocialAppointmentCitizen", fields: [citizenId], references: [id])

  // Tipo de agendamento
  appointmentType         String
  serviceType             String?

  // Data e horário
  appointmentDate         DateTime
  appointmentTime         String?
  estimatedDuration       Int                 @default(60)

  // Local
  equipmentType           String?
  equipmentId             String?
  equipmentName           String?
  roomNumber              String?

  // Assistente social
  socialWorkerId          String?
  socialWorkerName        String?

  // Motivo do agendamento
  reason                  String?
  purpose                 String
  description             String?
  referredBy              String?
  referralReason          String?

  // Prioridade
  priority                String?
  isUrgent                Boolean             @default(false)
  urgencyJustification    String?

  // Situação do cidadão
  isFirstTime             Boolean             @default(false)
  previousAttendances     Int                 @default(0)
  hasCadUnico             Boolean             @default(false)
  vulnerabilityLevel      String?

  // Documentos necessários
  requiredDocuments       Json?
  hasAllDocuments         Boolean             @default(false)

  // Acompanhante
  hasCompanion            Boolean             @default(false)
  companionName           String?
  companionRelationship   String?

  // Acessibilidade
  needsAccessibility      Boolean             @default(false)
  accessibilityNeeds      Json?
  needsInterpreter        Boolean             @default(false)
  interpreterLanguage     String?

  // Confirmação
  confirmed               Boolean             @default(false)
  confirmationMethod      String?
  confirmedAt             DateTime?

  // Lembrete
  reminderSent            Boolean             @default(false)
  reminderDate            DateTime?

  // Status
  status                  String              @default("SCHEDULED")
  isActive                Boolean             @default(false)
  cancelledAt             DateTime?

  // Resultado
  notes                   String?
  result                  String?
  followUpNeeded          Boolean             @default(false)
  followUpDate            DateTime?

  observations            String?
  internalNotes           String?
  createdAt               DateTime            @default(now())
  updatedAt               DateTime            @updatedAt

  socialWorkerUser        User?               @relation("SocialAppointmentWorker", fields: [socialWorkerId], references: [id])
  protocol                ProtocolSimplified? @relation("SocialAppointmentProtocol", fields: [protocolId], references: [id])

  @@map("social_appointments")
}

model SocialEquipment {
  id                     String              @id @default(cuid())
  protocolId             String?

  // ✅ REFATORADO - citizenId obrigatório (coordenador)
  citizenId              String
  citizen                Citizen             @relation("SocialEquipmentCitizen", fields: [citizenId], references: [id])

  // Tipo de equipamento
  equipmentType          String
  equipmentName          String
  code                   String?
  cnpj                   String?

  // Endereço
  address                String
  addressNumber          String?
  addressComplement      String?
  neighborhood           String?
  city                   String?
  state                  String?
  zipCode                String?
  coordinates            Json?

  // Contato
  phone                  String?
  email                  String?
  website                String?

  // Horário de funcionamento
  operatingHours         Json?
  operatingDays          String?
  schedule               Json?

  // Capacidade
  capacity               Int?
  currentOccupancy       Int                 @default(0)
  maxMonthlyAttendances  Int?

  // Área de cobertura
  coverageArea           Json?
  coveragePopulation     Int?
  referenceFamilies      Int?

  // Coordenação
  coordinator            String?
  coordinatorId          String?
  coordinatorName        String?
  coordinatorPhone       String?
  coordinatorEmail       String?

  // Equipe
  socialWorkers          Int                 @default(0)
  psychologists          Int                 @default(0)
  educators              Int                 @default(0)
  supportStaff           Int                 @default(0)
  totalStaff             Int                 @default(0)

  // Serviços oferecidos
  services               Json?
  offeredServices        Json?
  programs               Json?
  groups                 Json?

  // Infraestrutura
  hasAccessibility       Boolean             @default(false)
  accessibilityFeatures  Json?
  rooms                  Int                 @default(0)
  computerLab            Boolean             @default(false)
  kitchen                Boolean             @default(false)
  playground             Boolean             @default(false)
  sportsArea             Boolean             @default(false)

  // Transporte
  hasVehicle             Boolean             @default(false)
  vehicleType            String?
  vehiclePlate           String?

  // Documentação
  municipalDecree        String?
  creationDate           DateTime?
  lastInspectionDate     DateTime?

  // Status
  status                 String              @default("ACTIVE")
  isActive               Boolean             @default(true)
  operationStatus        String?
  approvedAt             DateTime?

  observations           String?
  internalNotes          String?
  createdAt              DateTime            @default(now())
  updatedAt              DateTime            @updatedAt

  coordinatorUser        User?               @relation("SocialEquipmentCoordinator", fields: [coordinatorId], references: [id])
  protocol               ProtocolSimplified? @relation("SocialEquipmentProtocol", fields: [protocolId], references: [id])

  @@map("social_equipments")
}

model WorkInspection {
  id              String              @id @default(cuid())
  protocolId      String?
  protocol        String              @unique
  workName        String
  workType        String
  contractor      String
  location        String
  coordinates     Json?
  inspectionDate  DateTime
  inspector       String
  inspectionType  String
  findings        Json
  compliance      String
  violations      Json?
  recommendations Json?
  photos          Json?
  documents       Json?
  deadline        DateTime?
  followUpDate    DateTime?
  nextInspection  DateTime?
  status          String              @default("COMPLETED")
  observations    String?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  protocolRel     ProtocolSimplified? @relation("WorkInspectionProtocol", fields: [protocolId], references: [id])

  @@map("work_inspections")
}

model PublicWorksAttendance {
  id               String              @id @default(cuid())
  protocolId       String?
  protocol         String              @unique
  citizenName      String
  citizenCpf       String?
  contact          Json
  serviceType      String
  subject          String
  description      String
  workType         String?
  location         String
  coordinates      Json?
  urgency          String              @default("NORMAL")
  photos           Json?
  estimatedCost    Float?
  priority         String              @default("MEDIUM")
  feasibility      String?
  technicalOpinion String?
  engineer         String?
  scheduledDate    DateTime?
  completionDate   DateTime?
  status           String              @default("PENDING")
  resolution       String?
  satisfaction     Int?
  followUpDate     DateTime?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  protocolRel      ProtocolSimplified? @relation("PublicWorksAttendanceProtocol", fields: [protocolId], references: [id])

  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("public_works_attendances")
}

model RoadRepairRequest {
  id             String              @id @default(cuid())
  protocolId     String?
  protocol       String              @unique
  citizenName    String
  citizenCpf     String?
  contact        Json
  roadName       String
  location       String
  coordinates    Json?
  problemType    String
  severity       String              @default("MEDIUM")
  description    String
  photos         Json?
  affectedArea   Float?
  trafficImpact  String?
  urgency        String              @default("NORMAL")
  estimatedCost  Float?
  priority       String              @default("MEDIUM")
  assignedTeam   String?
  scheduledDate  DateTime?
  completionDate DateTime?
  status         String              @default("PENDING")
  resolution     String?
  materialsUsed  Json?
  workDuration   Int?
  satisfaction   Int?
  observations   String?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  protocolRel    ProtocolSimplified? @relation("RoadRepairRequestProtocol", fields: [protocolId], references: [id])

  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("road_repair_requests")
}

model TechnicalInspection {
  id                String              @id @default(cuid())
  protocolId        String?
  protocol          String              @unique
  requestorName     String
  requestorCpf      String?
  contact           Json
  inspectionType    String
  subject           String
  description       String
  location          String
  coordinates       Json?
  propertyType      String?
  constructionStage String?
  documents         Json?
  photos            Json?
  urgency           String              @default("NORMAL")
  scheduledDate     DateTime?
  inspectionDate    DateTime?
  inspector         String?
  findings          Json?
  technicalOpinion  String?
  approved          Boolean?
  conditions        Json?
  validUntil        DateTime?
  status            String              @default("PENDING")
  resolution        String?
  followUpDate      DateTime?
  observations      String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  protocolRel       ProtocolSimplified? @relation("TechnicalInspectionProtocol", fields: [protocolId], references: [id])

  @@map("technical_inspections")
}

model PublicServiceRequest {
  id                 String              @id @default(cuid())
  protocolId         String?
  protocol           String              @unique
  requestorName      String
  requestorCpf       String?
  contact            Json
  serviceType        String
  category           String
  description        String
  location           String
  coordinates        Json?
  requestDate        DateTime            @default(now())
  preferredDate      DateTime?
  urgency            String              @default("NORMAL")
  priority           String?
  photos             Json?
  assignedTeam       String?
  scheduledDate      DateTime?
  expectedDate       DateTime?
  completionDate     DateTime?
  materials          Json?
  workDetails        String?
  cost               Float?
  estimatedCost      Float?
  status             String              @default("PENDING")
  resolution         String?
  satisfaction       Int?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  protocolSimplified ProtocolSimplified? @relation("PublicServiceRequestProtocol", fields: [protocolId], references: [id])

  @@map("public_service_requests")
}

model CleaningSchedule {
  id                String              @id @default(cuid())
  protocolId        String?
  area              String
  cleaningType      String
  frequency         String
  dayOfWeek         Int?
  dayOfMonth        Int?
  startTime         String
  duration          Int
  estimatedDuration Int?
  teamSize          Int
  equipment         Json?
  responsibleTeam   String
  team              String?
  vehicle           String?
  observations      String?
  isActive          Boolean             @default(true)
  lastExecution     DateTime?
  nextExecution     DateTime
  executionHistory  Json?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  protocol          ProtocolSimplified? @relation("CleaningScheduleProtocol", fields: [protocolId], references: [id])

  @@map("cleaning_schedules")
}

model StreetLighting {
  id                 String              @id @default(cuid())
  protocolId         String?
  pointCode          String              @unique
  streetName         String
  neighborhood       String
  coordinates        Json
  poleType           String
  lampType           String
  power              Int
  height             Float
  installDate        DateTime?
  lastMaintenance    DateTime?
  nextMaintenance    DateTime?
  condition          String              @default("GOOD")
  status             String?
  issues             Json?
  maintenanceHistory Json?
  energyConsumption  Float?
  isActive           Boolean             @default(true)
  photos             Json?
  observations       String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  protocol           ProtocolSimplified? @relation("StreetLightingProtocol", fields: [protocolId], references: [id])

  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("street_lightings")
}

model SpecialCollection {
  id              String              @id @default(cuid())
  protocolId      String?
  citizenId       String?
  collectionType  String
  requestorName   String
  requestorCpf    String?
  contact         Json
  address         String
  coordinates     Json?
  description     String
  estimatedVolume Float?
  quantity        Int?
  unit            String?
  photos          Json?
  requestDate     DateTime            @default(now())
  preferredDate   DateTime?
  scheduledDate   DateTime?
  timeSlot        String?
  collectionDate  DateTime?
  teamAssigned    String?
  vehicle         String?
  actualVolume    Float?
  destination     String?
  cost            Float?
  status          String              @default("REQUESTED")
  observations    String?
  satisfaction    Int?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  protocol        ProtocolSimplified? @relation("SpecialCollectionProtocol", fields: [protocolId], references: [id])
  citizen         Citizen?            @relation("SpecialCollectionCitizen", fields: [citizenId], references: [id])

  @@map("special_collections")
}

model PublicProblemReport {
  id                 String              @id @default(cuid())
  protocolId         String?
  citizenId          String?
  protocol           String              @unique
  reporterName       String?
  reporterPhone      String?
  reporterEmail      String?
  problemType        String
  title              String?
  severity           String
  riskLevel          String?
  affectedPeople     Int?
  description        String
  location           String
  coordinates        Json?
  landmark           String?
  photos             Json?
  reportDate         DateTime            @default(now())
  status             String              @default("REPORTED")
  assignedDepartment String?
  assignedTeam       String?
  priority           String              @default("MEDIUM")
  estimatedCost      Float?
  scheduledDate      DateTime?
  completionDate     DateTime?
  resolution         String?
  materials          Json?
  workHours          Float?
  isAnonymous        Boolean             @default(false)
  followUp           Boolean             @default(false)
  satisfaction       Int?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  protocolSimplified ProtocolSimplified? @relation("PublicProblemReportProtocol", fields: [protocolId], references: [id])
  citizen            Citizen?            @relation("PublicProblemReportCitizen", fields: [citizenId], references: [id])

  @@map("public_problem_reports")
}

model TeamSchedule {
  id           String              @id @default(cuid())
  protocolId   String?
  teamName     String
  teamType     String
  shift        String
  shiftStart   String?
  shiftEnd     String?
  workDays     Json
  startTime    String
  endTime      String
  breakTime    Json?
  teamLead     String
  members      Json
  equipment    Json?
  vehicles     Json?
  workAreas    Json
  dailyTasks   Json
  weeklyTasks  Json?
  monthlyTasks Json?
  productivity Json?
  isActive     Boolean             @default(true)
  observations String?
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  protocol     ProtocolSimplified? @relation("TeamScheduleProtocol", fields: [protocolId], references: [id])

  @@map("team_schedules")
}

model WeedingRequest {
  id             String              @id @default(cuid())
  protocolId     String?
  citizenId      String?
  requestorName  String
  requestorCpf   String?
  contact        Json
  location       String
  address        String
  coordinates    Json?
  areaSize       Float?
  terrainType    String
  accessType     String
  description    String
  photos         Json?
  urgency        String              @default("NORMAL")
  requestDate    DateTime            @default(now())
  preferredDate  DateTime?
  scheduledDate  DateTime?
  completionDate DateTime?
  assignedTeam   String?
  status         String              @default("REQUESTED")
  workDetails    String?
  equipmentUsed  Json?
  workHours      Float?
  observations   String?
  satisfaction   Int?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  protocol       ProtocolSimplified? @relation("WeedingRequestProtocol", fields: [protocolId], references: [id])
  citizen        Citizen?            @relation("WeedingRequestCitizen", fields: [citizenId], references: [id])

  @@map("weeding_requests")
}

model DrainageRequest {
  id             String              @id @default(cuid())
  protocolId     String?
  citizenId      String?
  requestorName  String
  requestorCpf   String?
  contact        Json
  location       String
  address        String
  coordinates    Json?
  problemType    String
  severity       String
  description    String
  photos         Json?
  waterLevel     String?
  affectedArea   Float?
  urgency        String              @default("HIGH")
  requestDate    DateTime            @default(now())
  preferredDate  DateTime?
  scheduledDate  DateTime?
  completionDate DateTime?
  assignedTeam   String?
  status         String              @default("REQUESTED")
  workDetails    String?
  equipmentUsed  Json?
  materialsUsed  Json?
  workHours      Float?
  observations   String?
  satisfaction   Int?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  protocol       ProtocolSimplified? @relation("DrainageRequestProtocol", fields: [protocolId], references: [id])
  citizen        Citizen?            @relation("DrainageRequestCitizen", fields: [citizenId], references: [id])

  @@map("drainage_requests")
}

model TreePruningRequest {
  id              String              @id @default(cuid())
  protocolId      String?
  citizenId       String?
  requestorName   String
  requestorCpf    String?
  contact         Json
  location        String
  address         String
  coordinates     Json?
  treeSpecies     String?
  treeHeight      Float?
  trunkDiameter   Float?
  pruningType     String
  reason          String
  description     String
  photos          Json?
  riskLevel       String?
  urgency         String              @default("NORMAL")
  requestDate     DateTime            @default(now())
  preferredDate   DateTime?
  scheduledDate   DateTime?
  completionDate  DateTime?
  assignedTeam    String?
  technicalVisit  Boolean             @default(false)
  visitDate       DateTime?
  approved        Boolean?
  approvalNotes   String?
  status          String              @default("REQUESTED")
  workDetails     String?
  equipmentUsed   Json?
  materialRemoved Float?
  workHours       Float?
  observations    String?
  satisfaction    Int?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  protocol        ProtocolSimplified? @relation("TreePruningRequestProtocol", fields: [protocolId], references: [id])
  citizen         Citizen?            @relation("TreePruningRequestCitizen", fields: [citizenId], references: [id])

  @@map("tree_pruning_requests")
}

model UrbanCleaning {
  id             String              @id @default(cuid())
  protocolId     String?
  serviceType    String
  location       String
  address        String
  neighborhood   String?
  coordinates    Json?
  description    String
  areaSize       Float?
  cleaningType   String
  frequency      String?
  requestDate    DateTime            @default(now())
  scheduledDate  DateTime?
  completionDate DateTime?
  assignedTeam   String?
  teamLeader     String?
  workers        Json?
  equipmentUsed  Json?
  vehiclesUsed   Json?
  wasteCollected Float?
  wasteType      Json?
  photos         Json?
  status         String              @default("SCHEDULED")
  priority       String              @default("NORMAL")
  cost           Float?
  workHours      Float?
  observations   String?
  satisfaction   Int?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  protocol       ProtocolSimplified? @relation("UrbanCleaningProtocol", fields: [protocolId], references: [id])

  @@map("urban_cleanings")
}

model ServiceTeam {
  id             String              @id @default(cuid())
  protocolId     String?
  teamCode       String              @unique
  teamName       String
  teamType       String
  department     String
  leader         String
  leaderContact  Json?
  members        Json
  totalMembers   Int
  specialization String?
  workShift      String
  shiftStart     String
  shiftEnd       String
  workDays       Json
  breakTime      Json?
  equipment      Json?
  vehicles       Json?
  workArea       String?
  coverage       Json?
  productivity   Json?
  performance    Json?
  status         String              @default("ACTIVE")
  isActive       Boolean             @default(true)
  hireDate       DateTime?
  observations   String?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  protocol       ProtocolSimplified? @relation("ServiceTeamProtocol", fields: [protocolId], references: [id])

  @@map("service_teams")
}

model PublicServiceAttendance {
  id             String              @id @default(cuid())
  protocolId     String?
  citizenId      String?
  citizenName    String
  citizenCpf     String?
  citizenPhone   String?
  citizenEmail   String?
  serviceType    String
  requestType    String
  description    String
  location       String?
  address        String?
  coordinates    Json?
  urgency        String              @default("NORMAL")
  priority       String              @default("MEDIUM")
  requestDate    DateTime            @default(now())
  scheduledDate  DateTime?
  completionDate DateTime?
  status         String              @default("PENDING")
  assignedTeam   String?
  assignedTo     String?
  resolution     String?
  photos         Json?
  documents      Json?
  cost           Float?
  satisfaction   Int?
  observations   String?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  protocol       ProtocolSimplified? @relation("PublicServiceAttendanceProtocol", fields: [protocolId], references: [id])
  citizen        Citizen?            @relation("PublicServiceAttendanceCitizen", fields: [citizenId], references: [id])

  @@index([protocolId])
  @@index([status])
  @@index([createdAt])
  @@map("public_service_attendances")
}

model SpecializedPage {
  id                 String              @id @default(cuid())
  pageKey            String
  code               String
  name               String
  secretaria         String
  pageType           String
  title              String
  description        String?
  content            Json
  sections           Json
  services           Json?
  contacts           Json?
  documents          Json?
  links              Json?
  images             Json?
  isPublished        Boolean             @default(false)
  isActive           Boolean             @default(true)
  departmentId       String?
  functions          Json?
  publishDate        DateTime?
  lastModified       DateTime            @default(now())
  modifiedBy         String
  version            Int                 @default(1)
  template           String?
  metadata           Json?
  analytics          Json?
  customCss          String?
  customJs           String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  pageConfigurations PageConfiguration[]
  pageMetrics        PageMetrics[]

  @@unique([pageKey])
  @@unique([code])
  @@map("specialized_pages")
}

model PageMetrics {
  id              String          @id @default(cuid())
  pageId          String
  pageKey         String?
  date            DateTime
  metricDate      DateTime
  pageViews       Int             @default(0)
  uniqueVisitors  Int             @default(0)
  averageTime     Float?
  bounceRate      Float?
  downloads       Int             @default(0)
  formSubmissions Int             @default(0)
  clickEvents     Json?
  searchTerms     Json?
  referrers       Json?
  devices         Json?
  browsers        Json?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  page            SpecializedPage @relation(fields: [pageId], references: [id])

  @@unique([pageId, date])
  @@map("page_metrics")
}

model PageConfiguration {
  id           String          @id @default(cuid())
  pageId       String
  key          String
  value        Json
  type         String
  category     String?
  description  String?
  isRequired   Boolean         @default(false)
  isActive     Boolean         @default(true)
  priority     Int             @default(0)
  conditions   Json?
  schedule     Json?
  version      String          @default("1.0")
  createdBy    String
  modifiedBy   String?
  approvedBy   String?
  approvalDate DateTime?
  rollbackData Json?
  notes        String?
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  page         SpecializedPage @relation(fields: [pageId], references: [id])

  @@unique([pageId, key])
  @@map("page_configurations")
}

model AgendaEvent {
  id             String   @id @default(cuid())
  tipo           String
  titulo         String
  descricao      String?
  dataHoraInicio DateTime
  dataHoraFim    DateTime
  local          String?
  participantes  String?
  status         String   @default("AGENDADO")
  observacoes    String?
  anexos         String?
  createdById    String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  createdBy      User     @relation("AgendaEventCreator", fields: [createdById], references: [id])

  @@index([dataHoraInicio])
  @@index([status])
  @@map("agenda_events")
}

enum UserRole {
  GUEST
  USER
  COORDINATOR
  MANAGER
  ADMIN
  SUPER_ADMIN
}

enum ProtocolStatus {
  VINCULADO
  PROGRESSO
  ATUALIZACAO
  CONCLUIDO
  PENDENCIA
  CANCELADO
}

enum ServiceType {
  INFORMATIVO // Apenas acompanhamento
  COM_DADOS // Captura dados para módulo
}

enum TenantStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  TRIAL
  EXPIRED
  CANCELLED
}

enum Plan {
  STARTER
  PROFESSIONAL
  ENTERPRISE
}

enum InvoiceStatus {
  PENDING
  PAID
  OVERDUE
  CANCELLED
  FAILED
}

enum LeadSource {
  DEMO_REQUEST
  TRIAL_SIGNUP
  NEWSLETTER
  CONTACT_FORM
}

enum ReportType {
  OPERATIONAL
  MANAGERIAL
  EXECUTIVE
  CUSTOM
}

enum ReportExecutionStatus {
  PENDING
  GENERATING
  COMPLETED
  FAILED
  CANCELLED
}

enum ReportFormat {
  PDF
  EXCEL
  CSV
  JSON
}

enum AlertType {
  DEADLINE_OVERDUE
  LOW_PERFORMANCE
  HIGH_DEMAND
  LOW_SATISFACTION
  SYSTEM_OVERLOAD
  BUDGET_ALERT
}

enum AlertFrequency {
  REALTIME
  DAILY
  WEEKLY
  MONTHLY
}

enum EmailStatus {
  QUEUED
  PROCESSING
  SENT
  DELIVERED
  FAILED
  BOUNCED
  COMPLAINED
  UNSUBSCRIBED
}

enum EmailEventType {
  SENT
  DELIVERED
  OPENED
  CLICKED
  BOUNCED
  COMPLAINED
  UNSUBSCRIBED
  FAILED
}

enum LogLevel {
  DEBUG
  INFO
  WARN
  ERROR
}

enum EmailPlan {
  NONE
  BASIC
  STANDARD
  PREMIUM
  ENTERPRISE
}

enum VerificationStatus {
  PENDING // Bronze - Cadastro pendente de verificação
  VERIFIED // Prata - Cadastro verificado pelo admin
  GOLD // Ouro - Cadastro completo com documentação adicional
  REJECTED // Rejeitado
}

enum CulturalAttendanceType {
  AUTHORIZATION_EVENT
  ARTIST_REGISTRATION
  PUBLIC_NOTICE_REGISTRATION
  CULTURAL_SPACE_USE
  PROJECT_SUPPORT
  ARTISTIC_SUPPORT
  INFORMATION
  GENERAL_INFORMATION
  OTHERS
  inscricao_projeto
  reserva_espaco
  informacoes
  cadastro_grupo
  apoio_cultural
  denuncia
  inscricao_oficina
}

enum CulturalAttendanceStatus {
  PENDING
  UNDER_ANALYSIS
  APPROVED
  REJECTED
  COMPLETED
  CANCELLED
  OPEN
}

enum SportsAttendanceType {
  EVENT_AUTHORIZATION
  CLUB_REGISTRATION
  ATHLETE_REGISTRATION
  FACILITY_USE
  PROJECT_SUPPORT
  EQUIPMENT_REQUEST
  TOURNAMENT_REQUEST
  GENERAL_INFORMATION
  OTHERS
}

enum SportsAttendanceStatus {
  PENDING
  UNDER_ANALYSIS
  APPROVED
  REJECTED
  COMPLETED
  CANCELLED
}

enum HealthAttendanceType {
  APPOINTMENT_REQUEST
  EXAM_REQUEST
  MEDICATION_REQUEST
  HOME_VISIT
  VACCINATION
  HEALTH_CERTIFICATE
  COMPLAINT
  GENERAL_INFORMATION
  OTHERS
}

enum HealthAttendanceStatus {
  PENDING
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  REFERRED
}

enum HousingAttendanceType {
  PROGRAM_REGISTRATION
  LOT_REQUEST
  HOUSING_REFORM
  DOCUMENTATION
  COMPLAINT
  CONSULTATION
  GENERAL_INFORMATION
  OTHERS
}

enum HousingAttendanceStatus {
  PENDING
  UNDER_ANALYSIS
  APPROVED
  REJECTED
  COMPLETED
  WAITING_DOCUMENTATION
}

// ============================================================================
// FASE 4: SECRETARIAS DE INFRAESTRUTURA
// ============================================================================

model InfrastructureProblem {
  id String @id @default(cuid())

  // Tipo de problema
  type        String // "pothole", "lighting", "leak", "sewer", "pavement", "sidewalk", "accessibility", "signage"
  description String
  location    String
  coordinates Json? // { lat: -23.123, lng: -46.123 }
  photos      Json? // Array de URLs de fotos

  // Status e prioridade
  status   String @default("pending") // "pending", "in_progress", "resolved", "cancelled"
  priority String @default("normal") // "low", "normal", "high", "urgent"

  // Vínculo com protocolo (origem: portal)
  protocol  String?
  serviceId String?
  source    String  @default("manual") // "portal", "manual", "mobile"

  // Resolução
  resolvedAt      DateTime?
  resolvedBy      String? // userId
  resolutionNotes String?

  // Metadados adicionais
  metadata Json? // Dados específicos por tipo (tamanho, profundidade, etc.)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([type])
  @@index([status])
  @@map("infrastructure_problems")
}

model UrbanMaintenanceRequest {
  id String @id @default(cuid())

  // Tipo de serviço
  type        String // "tree_pruning", "waste_removal", "pest_control", "cleaning", "garbage_collection"
  description String
  location    String
  coordinates Json?
  photos      Json?

  // Detalhes específicos
  details Json? // Dados específicos por tipo de serviço

  // Status e prioridade
  status   String @default("pending")
  priority String @default("normal")

  // Vínculo com protocolo
  protocol  String?
  serviceId String?
  source    String  @default("manual")

  // Agendamento e execução
  scheduledFor    DateTime?
  completedAt     DateTime?
  completedBy     String?
  completionNotes String?

  // Equipe designada
  assignedTeam String?
  assignedTo   String? // userId

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([type])
  @@index([status])
  @@map("urban_maintenance_requests")
}

model HousingRequest {
  id String @id @default(cuid())

  // Tipo de solicitação
  type String // "housing_program", "lot_application", "regularization", "housing_aid"

  // Dados do solicitante
  citizenName String
  citizenCpf  String
  citizenRg   String?
  phone       String
  email       String?

  // Composição familiar
  familySize    Int
  monthlyIncome Float?
  familyData    Json? // Detalhes da composição familiar

  // Dados da solicitação
  currentAddress   String?
  currentSituation String? // "aluguel", "casa_cedida", "situacao_rua", etc.
  requestDetails   Json? // Dados específicos por tipo

  // Status e análise
  status        String  @default("pending") // "pending", "under_review", "approved", "rejected", "completed"
  priority      String  @default("normal")
  analysisNotes String?

  // Vínculo com protocolo
  protocol  String?
  serviceId String?
  source    String  @default("manual")

  // Aprovação/Rejeição
  reviewedAt      DateTime?
  reviewedBy      String? // userId
  rejectionReason String?

  // Documentos
  documents Json? // Array de documentos anexados

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([type])
  @@index([status])
  @@index([citizenCpf])
  @@map("housing_requests")
}

// ============================================================================
// FASE 5: SECRETARIAS CULTURAIS
// ============================================================================

model SportsModality {
  id         String  @id @default(cuid())
  protocolId String?

  name        String
  description String?
  category    String // "individual", "coletivo"
  isActive    Boolean @default(true)

  teams        SportsTeam[]
  competitions Competition[]
  athletes     Athlete[]

  // Campos consolidados do antigo SportModality
  equipment Json?
  rules     String?
  minAge    Int?
  maxAge    Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  protocolSimplified ProtocolSimplified? @relation("SportsModalityProtocol", fields: [protocolId], references: [id])

  @@map("sports_modalities")
}

// ============================================================================
// FASE 6: SECRETARIAS AMBIENTAIS
// ============================================================================

model TreeAuthorization {
  id String @id @default(cuid())

  // Dados do requerente
  applicantName  String
  applicantCpf   String
  applicantPhone String

  // Tipo de autorização
  authorizationType String // "pruning" (poda), "removal" (supressão)
  reason            String

  // Localização
  location    String
  coordinates Json?
  photos      Json?

  // Dados da(s) árvore(s)
  treeCount   Int   @default(1)
  treeSpecies Json? // Array com espécies
  treeData    Json? // Dados detalhados (altura, CAP, etc)

  // Status
  status String @default("pending") // pending, inspected, approved, rejected, executed

  // Análise técnica
  inspectionDate  DateTime?
  technicalReport Json?
  inspectorId     String?

  // Compensação (se supressão)
  requiresCompensation Boolean @default(false)
  compensationPlan     Json?

  // Vínculo com protocolo
  protocol  String?
  serviceId String?
  source    String  @default("manual")

  // Auditoria
  approvedBy String?
  approvedAt DateTime?
  executedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([protocol])
  @@index([status])
  @@map("tree_authorizations")
}

model OrganicCertification {
  id String @id @default(cuid())

  // Dados do produtor
  producerName  String
  producerCpf   String
  producerPhone String
  producerEmail String?

  // Dados da propriedade
  propertyName     String?
  propertyLocation String
  propertyArea     Float // em hectares
  coordinates      Json?

  // Produtos/culturas
  products         Json // Array de produtos cultivados
  productionSystem String // "organic", "in_transition", "agroecological"

  // Status
  status              String  @default("pending") // pending, inspected, approved, rejected, suspended
  certificationNumber String? @unique

  // Validade
  validFrom  DateTime?
  validUntil DateTime?

  // Inspeções
  inspections        Json? // Histórico de inspeções
  lastInspectionDate DateTime?
  nextInspectionDate DateTime?

  // Documentação
  documents       Json?
  technicalReport Json?

  // Vínculo com protocolo
  protocol  String?
  serviceId String?
  source    String  @default("manual")

  // Auditoria
  inspectorId String?
  approvedBy  String?
  approvedAt  DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([protocol])
  @@index([status])
  @@map("organic_certifications")
}

model SeedDistribution {
  id String @id @default(cuid())

  // Dados do produtor
  producerName     String
  producerCpf      String
  producerPhone    String
  propertyLocation String
  propertyArea     Float?

  // Solicitação
  requestType String // "seeds", "seedlings", "both"
  items       Json // Array com itens solicitados [{type, species, quantity}]
  purpose     String // "commercial", "subsistence", "agroforestry"

  // Status
  status String @default("pending") // pending, approved, ready, delivered, cancelled

  // Aprovação
  approvedQuantity Json? // Quantidade aprovada (pode diferir da solicitada)
  approvalNotes    String?

  // Entrega
  deliveryDate   DateTime?
  deliveredBy    String?
  deliveredItems Json? // Itens efetivamente entregues
  receivedBy     String? // Nome de quem recebeu

  // Vínculo com protocolo
  protocol  String?
  serviceId String?
  source    String  @default("manual")

  // Auditoria
  approvedBy String?
  approvedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([protocol])
  @@index([status])
  @@map("seed_distributions")
}

model SoilAnalysis {
  id String @id @default(cuid())

  // Dados do produtor
  producerName  String
  producerCpf   String
  producerPhone String

  // Dados da propriedade
  propertyLocation String
  propertyArea     Float?
  coordinates      Json?

  // Solicitação
  analysisType String // "basic", "complete", "specific"
  purpose      String // Objetivo da análise
  cropIntended String? // Cultura pretendida

  // Coleta de amostras
  sampleCount     Int       @default(1)
  collectionDate  DateTime?
  collectedBy     String?
  sampleLocations Json?

  // Status
  status String @default("pending") // pending, collected, lab, completed

  // Resultados
  labId       String?
  labSentDate DateTime?
  resultsDate DateTime?
  results     Json? // Resultados laboratoriais

  // Recomendações
  recommendations Json? // Correção, adubação, etc
  technicalReport String?

  // Vínculo com protocolo
  protocol  String?
  serviceId String?
  source    String  @default("manual")

  // Auditoria
  analyzedBy String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([protocol])
  @@index([status])
  @@map("soil_analyses")
}

model FarmerMarketRegistration {
  id String @id @default(cuid())

  // Dados do produtor
  producerName  String
  producerCpf   String
  producerPhone String
  producerEmail String?

  // Dados da propriedade
  propertyLocation String
  propertyArea     Float?

  // Produtos
  products        Json // Array de produtos que pretende vender
  productionType  String // "organic", "conventional", "agroecological"
  hasOrganicCert  Boolean @default(false)
  certificationId String? // Ref à certificação orgânica

  // Status
  status             String  @default("pending") // pending, approved, active, suspended, cancelled
  registrationNumber String? @unique

  // Infraestrutura
  needsStall      Boolean @default(false)
  stallPreference String? // Tipo/tamanho de barraca preferida

  // Documentação
  documents Json?

  // Validade
  validFrom  DateTime?
  validUntil DateTime?

  // Vínculo com protocolo
  protocol  String?
  serviceId String?
  source    String  @default("manual")

  // Auditoria
  inspectedBy    String?
  inspectionDate DateTime?
  approvedBy     String?
  approvedAt     DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([protocol])
  @@index([status])
  @@map("farmer_market_registrations")
}

model UrbanCertificate {
  id String @id @default(cuid())

  // Dados do requerente
  applicantName  String
  applicantCpf   String
  applicantPhone String
  applicantEmail String?

  // Tipo de certidão
  certificateType String // "zoning", "alignment", "land_use", "building_code", "tax_clearance"
  purpose         String // Finalidade da certidão

  // Dados do imóvel
  propertyAddress String
  propertyNumber  String?
  neighborhood    String
  lotNumber       String?
  blockNumber     String?
  cadastralNumber String?

  // Status
  status            String  @default("pending") // pending, under_review, issued, rejected
  certificateNumber String? @unique

  // Informações técnicas
  zoning       String? // Zoneamento
  landUse      String? // Uso do solo
  restrictions Json? // Restrições aplicáveis
  observations String?

  // Validade
  issuedDate DateTime?
  validUntil DateTime? // Algumas certidões têm validade

  // Documentação
  documents Json?

  // Vínculo com protocolo
  protocol  String?
  serviceId String?
  source    String  @default("manual")

  // Auditoria
  issuedBy   String?
  verifiedBy String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([protocol])
  @@index([status])
  @@index([certificateType])
  @@map("urban_certificates")
}

model PropertyNumbering {
  id String @id @default(cuid())

  // Dados do requerente
  applicantName  String
  applicantCpf   String
  applicantPhone String

  // Dados do imóvel
  propertyAddress String
  neighborhood    String
  reference       String? // Ponto de referência
  coordinates     Json?

  // Tipo de numeração
  numberingType String // "new", "change", "additional"
  reason        String

  // Numeração atual (se alteração)
  currentNumber String?

  // Status
  status String @default("pending") // pending, inspected, approved, assigned

  // Inspeção
  inspectionDate   DateTime?
  inspectorId      String?
  inspectionReport Json?
  photos           Json?

  // Numeração atribuída
  assignedNumber String?
  assignmentDate DateTime?

  // Vínculo com protocolo
  protocol  String?
  serviceId String?
  source    String  @default("manual")

  // Auditoria
  approvedBy String?
  approvedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([protocol])
  @@index([status])
  @@map("property_numbering")
}

model LotSubdivision {
  id String @id @default(cuid())

  // Dados do proprietário
  ownerName  String
  ownerCpf   String
  ownerPhone String
  ownerEmail String?

  // Dados do lote original
  originalAddress     String
  originalLotNumber   String?
  originalBlockNumber String?
  originalArea        Float // em m²
  cadastralNumber     String?

  // Desmembramento proposto
  newLotsCount Int
  newLotsData  Json // Array com dados de cada novo lote

  // Status
  status String @default("pending") // pending, under_review, approved, rejected, registered

  // Análise técnica
  technicalAnalysis Json?
  meetsRequirements Boolean?
  observations      String?

  // Documentação
  documents   Json?
  surveyPlans Json? // Plantas, memoriais descritivos

  // Responsável técnico
  surveyorName String?
  surveyorCrea String?

  // Aprovação
  approvalNumber String?
  approvedDate   DateTime?

  // Registro cartorial
  registryNumber String?
  registryDate   DateTime?

  // Vínculo com protocolo
  protocol  String?
  serviceId String?
  source    String  @default("manual")

  // Auditoria
  reviewedBy String?
  reviewedAt DateTime?
  approvedBy String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([protocol])
  @@index([status])
  @@map("lot_subdivisions")
}

// ============================================================================
// FASE 7: SECRETARIA DE SEGURANÇA PÚBLICA
// ============================================================================

model PoliceReport {
  id String @id @default(cuid())

  // Informações do relato
  type           String // "theft", "vandalism", "disturbance", "traffic", "other"
  description    String
  location       String
  coordinates    Json? // { lat, lng }
  occurrenceDate DateTime
  occurrenceTime String?

  // Envolvidos
  reporterName  String?
  reporterPhone String?
  reporterEmail String?
  witnessInfo   Json? // Array de testemunhas
  suspectInfo   Json? // Informações do suspeito

  // Evidências
  photos    Json? // Array de URLs de fotos
  videos    Json? // Array de URLs de vídeos
  documents Json? // Documentos anexos

  // Status e acompanhamento
  reportNumber String  @unique // Número do BO
  status       String  @default("registered") // "registered", "investigating", "resolved", "archived"
  priority     String  @default("normal") // "low", "normal", "high", "urgent"
  category     String? // Categoria específica

  // Atendimento
  assignedTo         String? // ID do agente
  assignedAt         DateTime?
  investigationNotes Json? // Notas da investigação
  resolution         String?
  resolvedAt         DateTime?

  // Vínculo com protocolo
  protocol  String?
  serviceId String?
  source    String  @default("manual") // "service", "manual", "emergency"

  // Metadados
  metadata    Json?
  isAnonymous Boolean  @default(false)
  createdBy   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([status])
  @@index([type])
  @@index([reportNumber])
  @@index([occurrenceDate])
  @@map("police_reports")
}

model PatrolRequest {
  id         String  @id @default(cuid())
  protocolId String?

  // Informações da solicitação
  type        String // "preventive", "monitoring", "event", "complaint"
  reason      String
  location    String
  coordinates Json? // { lat, lng }
  area        String? // Bairro/região

  // Período solicitado
  requestedDate DateTime?
  requestedTime String?
  frequency     String? // "once", "daily", "weekly", "monthly"
  duration      String? // Duração estimada

  // Solicitante
  requesterName    String
  requesterPhone   String
  requesterEmail   String?
  requesterAddress String?

  // Detalhes
  description    String
  concerns       Json? // Preocupações específicas
  additionalInfo String?

  // Status e atendimento
  status   String @default("pending") // "pending", "scheduled", "in_progress", "completed", "cancelled"
  priority String @default("normal") // "low", "normal", "high"

  // Programação
  scheduledDate    DateTime?
  scheduledTime    String?
  assignedUnit     String? // Viatura/unidade designada
  assignedOfficers Json? // Agentes designados

  // Execução
  patrolLog    Json? // Log das rondas realizadas
  observations String?
  completedAt  DateTime?

  // Vínculo com protocolo
  protocol    String?
  serviceId   String?
  source      String              @default("manual") // "service", "manual", "phone"
  protocolRel ProtocolSimplified? @relation("PatrolRequestProtocol", fields: [protocolId], references: [id])

  // Metadados
  metadata  Json?
  createdBy String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
  @@index([type])
  @@index([requestedDate])
  @@map("patrol_requests")
}

model CameraRequest {
  id         String  @id @default(cuid())
  protocolId String?

  // Tipo de solicitação
  type    String // "installation", "maintenance", "footage", "relocation"
  purpose String

  // Localização
  location    String
  coordinates Json? // { lat, lng }
  area        String? // Bairro
  address     String?

  // Detalhes da solicitação
  cameraType    String? // "fixed", "ptz", "dome", "speed"
  quantity      Int?    @default(1)
  justification String

  // Para solicitação de imagens
  incidentDate        DateTime?
  incidentTime        String?
  timeRange           Json? // { start, end }
  incidentDescription String?

  // Análise técnica
  feasibilityStatus String? // "pending", "approved", "denied", "needs_study"
  technicalNotes    String?
  estimatedCost     Float?

  // Solicitante
  requesterName     String
  requesterPhone    String
  requesterEmail    String?
  requesterDocument String?
  requesterType     String? // "citizen", "business", "institution", "police"

  // Status
  status   String @default("pending") // "pending", "analysis", "approved", "in_installation", "completed", "denied"
  priority String @default("normal")

  // Instalação/Execução
  scheduledDate    DateTime?
  installedDate    DateTime?
  installationTeam String?
  cameraIds        Json? // IDs das câmeras instaladas

  // Entrega de imagens
  footageDelivered    Boolean?  @default(false)
  footageDeliveryDate DateTime?
  footageNotes        String?

  // Vínculo com protocolo
  protocol    String?
  serviceId   String?
  source      String              @default("manual")
  protocolRel ProtocolSimplified? @relation("CameraRequestProtocol", fields: [protocolId], references: [id])

  // Metadados
  metadata  Json?
  createdBy String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
  @@index([type])
  @@map("camera_requests")
}

model AnonymousTip {
  id         String  @id @default(cuid())
  protocolId String?

  // Tipo de denúncia
  type     String // "drug_trafficking", "theft", "violence", "vandalism", "corruption", "other"
  category String? // Subcategoria

  // Informações da denúncia
  description String
  location    String?
  coordinates Json? // { lat, lng }

  // Detalhes
  suspectInfo Json? // Informações do suspeito (sem identificação pessoal)
  vehicleInfo Json? // Informações de veículos
  timeframe   String? // Quando ocorre/ocorreu
  frequency   String? // "once", "occasional", "frequent", "daily"

  // Evidências (anônimas)
  hasEvidence   Boolean @default(false)
  evidenceType  Json? // Tipos de evidência disponível
  evidenceNotes String?

  // Urgência
  isUrgent    Boolean @default(false)
  dangerLevel String? // "low", "medium", "high", "critical"

  // Status e acompanhamento
  tipNumber String @unique // Número da denúncia para acompanhamento
  status    String @default("received") // "received", "analyzing", "investigating", "action_taken", "archived"
  priority  String @default("normal")

  // Investigação
  assignedTo       String?
  assignedAt       DateTime?
  investigationLog Json? // Log de ações (sem expor identidade do denunciante)
  actionTaken      String?
  outcome          String?
  closedAt         DateTime?

  // Feedback ao denunciante
  feedbackCode  String? @unique // Código para acompanhamento
  publicUpdates Json? // Updates que podem ser vistos com o código

  // Vínculo com protocolo (se não for anônimo)
  protocol    String?
  serviceId   String?
  source      String              @default("manual") // "service", "hotline", "web", "app"
  protocolRel ProtocolSimplified? @relation("AnonymousTipProtocol", fields: [protocolId], references: [id])

  // Segurança e anonimato
  isAnonymous    Boolean @default(true)
  anonymityLevel String  @default("full") // "full", "partial", "none"
  ipHash         String? // Hash do IP (não o IP real)

  // Metadados
  metadata  Json?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
  @@index([type])
  @@index([tipNumber])
  @@index([feedbackCode])
  @@map("anonymous_tips")
}

model MunicipalGuard {
  id         String  @id @default(cuid())
  protocolId String?

  // Informações do guarda
  name      String
  badge     String    @unique
  cpf       String?
  rg        String?
  birthDate DateTime?

  // Contato
  phone   String
  email   String?
  address String?

  // Dados profissionais
  position      String // "guard", "sergeant", "lieutenant", "captain"
  admissionDate DateTime
  status        String   @default("active") // "active", "on_leave", "suspended", "retired"

  // Especialização
  specialties    Json? // ["patrol", "traffic", "school_security", "event_security"]
  certifications Json? // Certificações e treinamentos

  // Equipamentos
  assignedVehicle String?
  assignedRadio   String?
  assignedBadge   String?
  equipment       Json?

  // Escalas e disponibilidade
  shift        String? // "morning", "afternoon", "night", "rotating"
  workSchedule Json? // Escala de trabalho
  availability String  @default("available") // "available", "on_patrol", "off_duty", "unavailable"

  // Histórico e performance
  patrolsCount   Int   @default(0)
  incidentsCount Int   @default(0)
  commendations  Json? // Elogios e reconhecimentos
  disciplinary   Json? // Advertências e suspensões

  // Observações
  notes            String?
  emergencyContact Json?

  // Metadados
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  protocolRel ProtocolSimplified? @relation("MunicipalGuardProtocol", fields: [protocolId], references: [id])

  @@index([status])
  @@index([badge])
  @@map("municipal_guards")
}

model SurveillanceSystem {
  id         String  @id @default(cuid())
  protocolId String?

  // Identificação do sistema
  systemName String
  systemCode String @unique
  type       String // "camera", "alarm", "sensor", "integrated"

  // Localização
  location    String
  address     String?
  coordinates Json? // { lat, lng }
  area        String? // Bairro/região
  zone        String? // Zona de cobertura

  // Detalhes técnicos
  manufacturer     String?
  model            String?
  installationDate DateTime?
  warrantyExpires  DateTime?

  // Câmeras (se aplicável)
  cameraType     String? // "fixed", "ptz", "dome", "speed"
  resolution     String? // "720p", "1080p", "4K"
  hasNightVision Boolean @default(false)
  hasAudio       Boolean @default(false)
  recordingDays  Int? // Dias de retenção de gravação

  // Status operacional
  status          String    @default("operational") // "operational", "maintenance", "offline", "damaged"
  lastMaintenance DateTime?
  nextMaintenance DateTime?

  // Cobertura e capacidade
  coverageArea String? // Descrição da área coberta
  viewAngle    String? // Ângulo de visão
  range        String? // Alcance em metros

  // Conectividade
  ipAddress      String?
  connectionType String? // "wired", "wireless", "hybrid"
  bandwidth      String?

  // Monitoramento
  isMonitored      Boolean @default(true)
  monitoringCenter String? // Central de monitoramento
  alerts           Json? // Configurações de alertas

  // Incidentes e manutenções
  incidentsDetected  Int    @default(0)
  maintenanceHistory Json?
  downtimeHours      Float? @default(0)

  // Integração
  integratedWith Json? // Outros sistemas integrados
  apiAccess      Boolean @default(false)

  // Observações e notas
  notes          String?
  technicalSpecs Json?

  // Metadados
  isActive  Boolean  @default(true)
  createdBy String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  protocolRel ProtocolSimplified? @relation("SurveillanceSystemProtocol", fields: [protocolId], references: [id])

  @@index([status])
  @@index([type])
  @@index([systemCode])
  @@map("surveillance_systems")
}

model EventAuthorization {
  id String @id @default(cuid())

  // Informações do evento
  eventName   String
  eventType   String // "concert", "parade", "sports", "festival", "fair", "other"
  description String

  // Data e horário
  eventDate    DateTime
  startTime    String
  endTime      String
  setupDate    DateTime?
  setupTime    String?
  teardownTime String?

  // Local
  location      String
  address       String
  coordinates   Json?
  venue         String? // Nome do local
  isPublicSpace Boolean @default(true)

  // Estimativas
  expectedAttendees Int?
  hasAlcohol        Boolean @default(false)
  hasSound          Boolean @default(false)
  soundLevel        String? // "low", "medium", "high"

  // Organizador
  organizerName     String
  organizerDocument String
  organizerPhone    String
  organizerEmail    String?
  organizerType     String? // "person", "company", "institution"

  // Requisitos de segurança
  securityPlan         String?
  privateSecurityCount Int?    @default(0)
  needsPoliceSupport   Boolean @default(false)
  requestedOfficers    Int?    @default(0)

  // Análise e aprovação
  status        String  @default("pending") // "pending", "analysis", "approved", "denied", "cancelled"
  analysisNotes String?
  requirements  Json? // Requisitos adicionais
  conditions    String?

  // Designação de recursos
  assignedOfficers   Int?    @default(0)
  assignedUnits      Json? // Viaturas/unidades
  coordinatorOfficer String?

  // Documentação
  documents Json? // Documentos anexos
  insurance Json? // Seguro do evento

  // Vínculo com protocolo
  protocol  String?
  serviceId String?
  source    String  @default("manual")

  // Metadados
  approvedBy   String?
  approvedAt   DateTime?
  deniedReason String?
  metadata     Json?
  createdBy    String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@index([status])
  @@index([eventDate])
  @@map("event_authorizations")
}

model LostAndFound {
  id String @id @default(cuid())

  // Tipo de registro
  type String // "lost", "found"

  // Informações do objeto
  itemType         String // "documents", "electronics", "keys", "wallet", "phone", "jewelry", "clothing", "other"
  itemDescription  String
  brand            String?
  model            String?
  color            String?
  distinctiveMarks String?

  // Local e data
  location      String
  lostFoundDate DateTime
  lostFoundTime String?

  // Fotos
  photos Json?

  // Informações da pessoa
  personName     String
  personDocument String?
  personPhone    String
  personEmail    String?
  personAddress  String?

  // Status
  status String @default("active") // "active", "matched", "returned", "archived"

  // Match entre perdido e achado
  matchedWith String? // ID do registro correspondente
  matchedAt   DateTime?

  // Devolução
  returnedTo  String?
  returnedAt  DateTime?
  returnNotes String?

  // Armazenamento (para achados)
  storageLocation String?
  storedBy        String?
  storedAt        DateTime?

  // Vínculo com protocolo
  protocol  String?
  serviceId String?
  source    String  @default("manual")

  // Metadados
  metadata  Json?
  createdBy String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([type])
  @@index([status])
  @@index([itemType])
  @@index([lostFoundDate])
  @@map("lost_and_found")
}

// ============================================================================
// FASE 8: RECURSOS INTELIGENTES (Intelligent Features)
// ============================================================================
// Modelos para recursos avançados de serviços

// ========== 1. MÓDULOS CUSTOMIZADOS ==========

// Tabela customizada (metadados)
model CustomDataTable {
  id          String  @id @default(cuid())
  tableName   String // Nome único da tabela
  displayName String // Nome amigável
  description String?

  // Estrutura da tabela (schema)
  fields Json // Array de definições de campos

  // Configurações
  allowCreate Boolean @default(true)
  allowUpdate Boolean @default(true)
  allowDelete Boolean @default(true)

  // Audit
  moduleType String? // Campo adicionado
  schema     Json? // Campo adicionado
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relações
  records CustomDataRecord[]

  @@unique([tableName])
  @@map("custom_data_tables")
}

// Registro de dados customizados
model CustomDataRecord {
  id      String          @id @default(cuid())
  tableId String
  table   CustomDataTable @relation(fields: [tableId], references: [id], onDelete: Cascade)

  // Dados (JSON flexível)
  data Json

  // Vínculo com protocolo
  protocol  String?
  serviceId String?

  // Audit
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String? // userId

  @@index([tableId])
  @@index([protocol])
  @@index([serviceId])
  @@map("custom_data_records")
}

// ============================================================================
// FASE 3: PLANEJAMENTO, OBRAS E SERVIÇOS PÚBLICOS
// ============================================================================

// ========================================
// PLANEJAMENTO URBANO (7 MÓDULOS)
// ========================================

// 1. ATENDIMENTOS_PLANEJAMENTO
model UrbanPlanningAttendance {
  id                String              @id @default(cuid())
  protocolId        String              @unique
  protocol          ProtocolSimplified  @relation(fields: [protocolId], references: [id])

  citizenName       String
  citizenCpf        String
  citizenPhone      String
  citizenEmail      String?

  subject           String
  description       String
  attendanceType    String              // INFORMACAO, CONSULTA, SOLICITACAO, RECLAMACAO
  category          String?             // ALVARA, CERTIDAO, PROJETO, FISCALIZACAO
  priority          String              @default("NORMAL")

  status            String              @default("OPEN")
  resolution        String?
  resolvedAt        DateTime?

  isActive          Boolean             @default(true)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  @@index([citizenCpf])
  @@index([status])
  @@index([attendanceType])
  @@map("urban_planning_attendance")
}

// 2. APROVACAO_PROJETO (Arquitetônico)
model ProjectApproval {
  id                  String              @id @default(cuid())
  protocolId          String              @unique
  protocol            ProtocolSimplified  @relation(fields: [protocolId], references: [id])

  ownerName           String
  ownerCpf            String
  ownerPhone          String
  ownerEmail          String?

  propertyAddress     String
  propertyNumber      String?
  neighborhood        String
  lotNumber           String?
  block               String?
  subdivision         String?
  registryNumber      String?

  projectType         String              // RESIDENTIAL, COMMERCIAL, INDUSTRIAL, MIXED
  projectCategory     String              // NEW, MODIFICATION, REGULARIZATION
  constructionArea    Float
  totalArea           Float
  floors              Int
  units               Int?

  architectName       String
  architectCau        String
  architectPhone      String
  rrtNumber           String?

  technicalOpinion    String?
  observations        String?

  status              String              @default("ANALYSIS")
  analysisStartedAt   DateTime?
  approvedAt          DateTime?
  rejectedAt          DateTime?
  rejectionReason     String?

  buildingPermits     BuildingPermit[]

  isActive            Boolean             @default(true)
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt

  @@index([ownerCpf])
  @@index([status])
  @@map("project_approvals")
}

// 3. ALVARA_CONSTRUCAO
model BuildingPermit {
  id                  String              @id @default(cuid())
  protocolId          String              @unique
  protocol            ProtocolSimplified  @relation(fields: [protocolId], references: [id])

  ownerName           String
  ownerCpf            String
  ownerPhone          String
  ownerEmail          String?

  propertyAddress     String
  propertyNumber      String?
  neighborhood        String
  lotNumber           String?
  block               String?
  subdivision         String?
  registryNumber      String?

  projectType         String
  constructionArea    Float
  totalArea           Float
  floors              Int
  rooms               Int?
  parking             Int?

  engineerName        String
  engineerCrea        String
  engineerPhone       String
  artNumber           String?

  projectApprovalId   String?
  projectApproval     ProjectApproval?    @relation(fields: [projectApprovalId], references: [id])

  status              String              @default("ANALYSIS")
  analysisStartedAt   DateTime?
  approvedAt          DateTime?
  issuedAt            DateTime?
  expiresAt           DateTime?

  observations        String?
  rejectionReason     String?

  isActive            Boolean             @default(true)
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt

  @@index([ownerCpf])
  @@index([status])
  @@index([expiresAt])
  @@map("building_permits")
}

// 4. ALVARA_FUNCIONAMENTO
model OperatingLicense {
  id                  String              @id @default(cuid())
  protocolId          String              @unique
  protocol            ProtocolSimplified  @relation(fields: [protocolId], references: [id])

  companyName         String
  tradeName           String?
  cnpj                String
  ownerName           String
  ownerCpf            String
  phone               String
  email               String?

  address             String
  number              String?
  neighborhood        String
  complement          String?
  zipCode             String?

  activityType        String
  cnae                String?
  businessArea        Float?
  employees           Int?
  operatingHours      String?

  hasFireSafety       Boolean             @default(false)
  hasSanitaryLicense  Boolean             @default(false)
  hasEnvironmentalLic Boolean             @default(false)

  status              String              @default("ANALYSIS")
  issuedAt            DateTime?
  expiresAt           DateTime?
  renewalDate         DateTime?

  observations        String?
  rejectionReason     String?

  isActive            Boolean             @default(true)
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt

  @@index([cnpj])
  @@index([ownerCpf])
  @@index([status])
  @@index([expiresAt])
  @@map("operating_licenses")
}

// 5. SOLICITACAO_CERTIDAO
model CertificateRequest {
  id                  String              @id @default(cuid())
  protocolId          String              @unique
  protocol            ProtocolSimplified  @relation(fields: [protocolId], references: [id])

  requesterName       String
  requesterCpf        String
  requesterPhone      String
  requesterEmail      String?

  certificateType     String              // USO_SOLO, LOCALIZACAO, NUMERACAO, REGULARIDADE, OUTROS
  purpose             String?
  propertyAddress     String?
  propertyRegistration String?
  lotNumber           String?
  block               String?

  urgency             Boolean             @default(false)

  status              String              @default("PENDING")
  issuedAt            DateTime?
  validUntil          DateTime?
  certificateNumber   String?

  observations        String?
  rejectionReason     String?

  isActive            Boolean             @default(true)
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt

  @@index([requesterCpf])
  @@index([status])
  @@index([certificateType])
  @@map("certificate_requests")
}

// 6. DENUNCIA_CONSTRUCAO_IRREGULAR
model IllegalConstructionReport {
  id                  String              @id @default(cuid())
  protocolId          String              @unique
  protocol            ProtocolSimplified  @relation(fields: [protocolId], references: [id])

  reporterName        String?
  reporterCpf         String?
  reporterPhone       String?
  isAnonymous         Boolean             @default(false)

  address             String
  number              String?
  neighborhood        String
  reference           String?
  coordinates         String?

  violationType       String              // SEM_ALVARA, AREA_EXCEDIDA, RECUO_IRREGULAR, ALTURA_IRREGULAR
  description         String
  hasPhotos           Boolean             @default(false)
  photoUrls           Json?

  inspectionScheduled DateTime?
  inspectedAt         DateTime?
  inspectorNotes      String?

  status              String              @default("RECEIVED")
  resolution          String?
  resolvedAt          DateTime?

  isActive            Boolean             @default(true)
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt

  @@index([status])
  @@index([neighborhood])
  @@map("illegal_construction_reports")
}

// 7. CADASTRO_LOTEAMENTO
model SubdivisionRegistration {
  id                  String              @id @default(cuid())
  protocolId          String              @unique
  protocol            ProtocolSimplified  @relation(fields: [protocolId], references: [id])

  subdivisionName     String
  ownerName           String
  ownerCpf            String?
  ownerCnpj           String?
  phone               String
  email               String?

  location            String
  neighborhood        String
  totalArea           Float
  totalLots           Int
  publicAreaPercent   Float?
  greenAreaPercent    Float?

  hasInfrastructure   Boolean             @default(false)
  hasPavement         Boolean             @default(false)
  hasWater            Boolean             @default(false)
  hasSewage           Boolean             @default(false)
  hasElectricity      Boolean             @default(false)

  engineerName        String
  engineerCrea        String
  artNumber           String?

  approvalDate        DateTime?
  registrationNumber  String?

  status              String              @default("ANALYSIS")
  observations        String?

  isActive            Boolean             @default(true)
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt

  @@index([status])
  @@index([subdivisionName])
  @@map("subdivision_registrations")
}

// ========================================
// OBRAS PÚBLICAS (5 MÓDULOS)
// ========================================

// 1. ATENDIMENTOS_OBRAS
model PublicWorksAttendancePhase3 {
  id                String              @id @default(cuid())
  protocolId        String              @unique
  protocol          ProtocolSimplified  @relation(fields: [protocolId], references: [id])

  citizenName       String
  citizenCpf        String
  citizenPhone      String
  citizenEmail      String?

  subject           String
  description       String
  attendanceType    String              // SOLICITACAO, RECLAMACAO, SUGESTAO, INFORMACAO
  category          String?             // PAVIMENTACAO, DRENAGEM, PONTE, CALCADA
  priority          String              @default("NORMAL")

  location          String?
  neighborhood      String?
  reference         String?

  status            String              @default("OPEN")
  resolution        String?
  resolvedAt        DateTime?

  isActive          Boolean             @default(true)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  @@index([citizenCpf])
  @@index([status])
  @@map("public_works_attendance_phase3")
}

// 2. SOLICITACAO_REPARO_VIA
model RoadRepairRequestPhase3 {
  id                String              @id @default(cuid())
  protocolId        String              @unique
  protocol          ProtocolSimplified  @relation(fields: [protocolId], references: [id])

  requesterName     String
  requesterCpf      String?
  requesterPhone    String
  requesterEmail    String?

  address           String
  number            String?
  neighborhood      String
  reference         String?
  coordinates       String?

  problemType       String              // BURACO, RACHADURA, AFUNDAMENTO, QUEBRA_CALÇADA
  severity          String              // BAIXA, MEDIA, ALTA, CRITICA
  description       String
  affectedArea      Float?

  hasPhotos         Boolean             @default(false)
  photoUrls         Json?

  inspectionDate    DateTime?
  repairScheduled   DateTime?
  repairedAt        DateTime?

  status            String              @default("PENDING")
  priority          String              @default("NORMAL")

  observations      String?

  isActive          Boolean             @default(true)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  @@index([status])
  @@index([neighborhood])
  @@index([problemType])
  @@map("road_repair_requests_phase3")
}

// 3. VISTORIA_TECNICA_OBRAS
model TechnicalInspectionPhase3 {
  id                String              @id @default(cuid())
  protocolId        String              @unique
  protocol          ProtocolSimplified  @relation(fields: [protocolId], references: [id])

  requesterName     String
  requesterCpf      String?
  requesterCnpj     String?
  phone             String
  email             String?

  inspectionType    String              // OBRA_PUBLICA, OBRA_PARTICULAR, SINISTRO, LAUDO
  purpose           String

  address           String
  neighborhood      String
  reference         String?

  preferredDate     DateTime?
  urgency           Boolean             @default(false)

  inspectionDate    DateTime?
  inspectorName     String?
  findings          String?
  recommendations   String?

  status            String              @default("REQUESTED")
  reportIssued      Boolean             @default(false)
  reportUrl         String?

  observations      String?

  isActive          Boolean             @default(true)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  @@index([status])
  @@index([inspectionType])
  @@map("technical_inspections_phase3")
}

// 4. CADASTRO_OBRA_PUBLICA
model PublicWorkRegistration {
  id                String              @id @default(cuid())
  protocolId        String              @unique
  protocol          ProtocolSimplified  @relation(fields: [protocolId], references: [id])

  workName          String
  workType          String              // PAVIMENTACAO, DRENAGEM, PONTE, ESCOLA, POSTO_SAUDE
  description       String

  location          String
  neighborhood      String
  address           String?

  budget            Float?
  contractedCompany String?
  cnpj              String?
  contractNumber    String?

  startDate         DateTime?
  expectedEndDate   DateTime?
  actualEndDate     DateTime?

  engineerName      String?
  engineerCrea      String?

  progress          Float               @default(0)
  status            String              @default("PLANNED")

  observations      String?

  isActive          Boolean             @default(true)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  @@index([status])
  @@index([workType])
  @@index([neighborhood])
  @@map("public_work_registrations")
}

// 5. INSPECAO_OBRA
model WorkInspectionPhase3 {
  id                String              @id @default(cuid())
  protocolId        String              @unique
  protocol          ProtocolSimplified  @relation(fields: [protocolId], references: [id])

  workName          String
  workLocation      String
  contractNumber    String?

  inspectionDate    DateTime
  inspectorName     String
  inspectorRole     String?

  progressPercent   Float
  qualityRating     String              // EXCELENTE, BOM, REGULAR, RUIM

  findings          String
  nonCompliances    Json?
  recommendations   String?

  hasPhotos         Boolean             @default(false)
  photoUrls         Json?

  requiresAction    Boolean             @default(false)
  actionDeadline    DateTime?

  nextInspection    DateTime?

  status            String              @default("COMPLETED")

  observations      String?

  isActive          Boolean             @default(true)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  @@index([workName])
  @@index([inspectionDate])
  @@map("work_inspections_phase3")
}

// ========================================
// SERVIÇOS PÚBLICOS (7 MÓDULOS)
// ========================================

// 1. ATENDIMENTOS_SERVICOS_PUBLICOS
model PublicServiceAttendancePhase3 {
  id                String              @id @default(cuid())
  protocolId        String              @unique
  protocol          ProtocolSimplified  @relation(fields: [protocolId], references: [id])

  citizenName       String
  citizenCpf        String
  citizenPhone      String
  citizenEmail      String?

  subject           String
  description       String
  attendanceType    String              // SOLICITACAO, RECLAMACAO, SUGESTAO
  category          String?             // ILUMINACAO, LIMPEZA, CAPINA, PODA
  priority          String              @default("NORMAL")

  location          String?
  neighborhood      String?

  status            String              @default("OPEN")
  resolution        String?
  resolvedAt        DateTime?

  isActive          Boolean             @default(true)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  @@index([citizenCpf])
  @@index([status])
  @@map("public_service_attendance_phase3")
}

// 2. ILUMINACAO_PUBLICA
model PublicLightingRequest {
  id                String              @id @default(cuid())
  protocolId        String              @unique
  protocol          ProtocolSimplified  @relation(fields: [protocolId], references: [id])

  requesterName     String
  requesterCpf      String?
  requesterPhone    String
  requesterEmail    String?

  requestType       String              // MANUTENCAO, INSTALACAO, AMPLIACAO
  problemType       String?             // LAMPADA_APAGADA, LAMPADA_PISCANDO, POSTE_DANIFICADO

  address           String
  number            String?
  neighborhood      String
  reference         String?
  coordinates       String?

  description       String
  urgency           Boolean             @default(false)

  hasPhotos         Boolean             @default(false)
  photoUrls         Json?

  inspectionDate    DateTime?
  repairScheduled   DateTime?
  repairedAt        DateTime?

  status            String              @default("PENDING")

  observations      String?

  isActive          Boolean             @default(true)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  @@index([status])
  @@index([neighborhood])
  @@index([requestType])
  @@map("public_lighting_requests")
}

// 3. LIMPEZA_URBANA
model UrbanCleaningRequest {
  id                String              @id @default(cuid())
  protocolId        String              @unique
  protocol          ProtocolSimplified  @relation(fields: [protocolId], references: [id])

  requesterName     String
  requesterCpf      String?
  requesterPhone    String
  requesterEmail    String?

  cleaningType      String              // VARRIÇÃO, LIMPEZA_TERRENO, COLETA_LIXO

  address           String
  neighborhood      String
  reference         String?
  coordinates       String?

  description       String
  estimatedArea     Float?

  hasPhotos         Boolean             @default(false)
  photoUrls         Json?

  scheduledDate     DateTime?
  completedAt       DateTime?

  status            String              @default("PENDING")

  observations      String?

  isActive          Boolean             @default(true)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  @@index([status])
  @@index([neighborhood])
  @@index([cleaningType])
  @@map("urban_cleaning_requests")
}

// 4. COLETA_ESPECIAL
model SpecialCollectionRequest {
  id                String              @id @default(cuid())
  protocolId        String              @unique
  protocol          ProtocolSimplified  @relation(fields: [protocolId], references: [id])

  requesterName     String
  requesterCpf      String?
  requesterPhone    String
  requesterEmail    String?

  collectionType    String              // ENTULHO, MOVEIS, ELETRONICOS, PODAS

  address           String
  number            String?
  neighborhood      String
  reference         String?

  itemDescription   String
  estimatedVolume   String?             // PEQUENO, MEDIO, GRANDE
  itemQuantity      Int?

  preferredDate     DateTime?
  scheduledDate     DateTime?
  collectedAt       DateTime?

  status            String              @default("PENDING")

  observations      String?

  isActive          Boolean             @default(true)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  @@index([status])
  @@index([neighborhood])
  @@index([collectionType])
  @@map("special_collection_requests")
}

// 5. SOLICITACAO_CAPINA
model WeedingRequestPhase3 {
  id                String              @id @default(cuid())
  protocolId        String              @unique
  protocol          ProtocolSimplified  @relation(fields: [protocolId], references: [id])

  requesterName     String
  requesterCpf      String?
  requesterPhone    String
  requesterEmail    String?

  address           String
  neighborhood      String
  reference         String?
  coordinates       String?

  areaType          String              // CALCADA, TERRENO, PRACA, RUA
  estimatedArea     Float?
  description       String

  hasPhotos         Boolean             @default(false)
  photoUrls         Json?

  scheduledDate     DateTime?
  completedAt       DateTime?

  status            String              @default("PENDING")
  priority          String              @default("NORMAL")

  observations      String?

  isActive          Boolean             @default(true)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  @@index([status])
  @@index([neighborhood])
  @@map("weeding_requests_phase3")
}

// 6. SOLICITACAO_DESOBSTRUCAO
model DrainageUnblockRequest {
  id                String              @id @default(cuid())
  protocolId        String              @unique
  protocol          ProtocolSimplified  @relation(fields: [protocolId], references: [id])

  requesterName     String
  requesterCpf      String?
  requesterPhone    String
  requesterEmail    String?

  address           String
  neighborhood      String
  reference         String?
  coordinates       String?

  obstructionType   String              // BUEIRO, GALERIA, SARJETA, CÓRREGO
  severity          String              // PARCIAL, TOTAL
  description       String
  causingFlooding   Boolean             @default(false)

  hasPhotos         Boolean             @default(false)
  photoUrls         Json?

  inspectionDate    DateTime?
  scheduledDate     DateTime?
  completedAt       DateTime?

  status            String              @default("PENDING")
  priority          String              @default("NORMAL")

  observations      String?

  isActive          Boolean             @default(true)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  @@index([status])
  @@index([neighborhood])
  @@index([causingFlooding])
  @@map("drainage_unblock_requests")
}

// 7. SOLICITACAO_PODA
model TreePruningRequestPhase3 {
  id                String              @id @default(cuid())
  protocolId        String              @unique
  protocol          ProtocolSimplified  @relation(fields: [protocolId], references: [id])

  requesterName     String
  requesterCpf      String?
  requesterPhone    String
  requesterEmail    String?

  address           String
  neighborhood      String
  reference         String?
  coordinates       String?

  treeType          String?
  treeHeight        String?             // PEQUENA, MEDIA, GRANDE
  pruningReason     String              // RISCO_QUEDA, BLOQUEIO_FIO, BLOQUEIO_VIA, MANUTENCAO

  urgency           Boolean             @default(false)
  nearPowerLines    Boolean             @default(false)

  hasPhotos         Boolean             @default(false)
  photoUrls         Json?

  inspectionDate    DateTime?
  scheduledDate     DateTime?
  completedAt       DateTime?

  status            String              @default("PENDING")
  priority          String              @default("NORMAL")

  observations      String?

  isActive          Boolean             @default(true)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  @@index([status])
  @@index([neighborhood])
  @@index([urgency])
  @@map("tree_pruning_requests_phase3")
}
